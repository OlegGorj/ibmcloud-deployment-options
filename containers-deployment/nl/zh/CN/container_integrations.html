<!DOCTYPE html><html lang="zh-cn">
<head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="UTF-8">
<meta name="dcterms.date" content="2017-11-10">
<meta name="dcterms.rights" content="© Copyright IBM Corporation 2014, 2017">

<meta name="description" content="您可以将 Bluemix“目录”中的各种服务用于 IBM Bluemix Container Service。许多 Bluemix 服务可帮助您为容器中部署的应用程序添加额外的功能。此外，有些 Bluemix 服务可用于帮助您管理容器。">
<meta name="keywords" content="IBM Containers, 容器, 服务, Bluemix, 集成, 绑定, 警报通知, 策略, 通知, Delivery Pipeline, 管道, 持续交付, 单个容器, 映像, 构建, 漏洞顾问程序, 安全性, 映像清除, 环境属性, 容器组, Devops Services, 部署">
<meta name="geo.country" content="ZZ">
<script>
    digitalData = {
      page: {
        pageInfo: {
  language: "zh-cn",

  version: "v18",
  ibm: {
  country: "ZZ",
  type: "CT701"
  
         }
       }
     }
   };
  </script><link rel="stylesheet" type="text/css" href="./ibmdita.css">
<title>集成服务以与 单个和可扩展容器 一起使用</title>
</head>
<body><main role="main"><div><article class="nested0" role="article" aria-labelledby="d58943e6" id="container_integrations"><h1 class="topictitle1" id="d58943e6"><span class="ph" id="title">将服务与<span class="ph">单个和可扩展容器</span>集成</span></h1>
<div class="body conbody"><div class="abstract"><div class="shortdesc"><span class="ph" id="shortdesc">您可以将 <span class="keyword">Bluemix®</span>“<span class="keyword wintitle">目录</span>”中的各种服务用于 <span class="keyword">IBM®
Bluemix Container Service</span>。许多 <span class="keyword">Bluemix</span> 服务可帮助您为容器中部署的应用程序添加额外的功能。此外，有些 <span class="keyword">Bluemix</span> 服务可用于帮助您管理容器。</span></div>


<div class="p"><div class="note attention"><span class="attentiontitle">注意：</span> <span class="ph"><span class="ph">单个和可扩展容器</span> 的免费试用版不可用。
<a href="cs_ov.html" title="IBM Bluemix Container Service 将 Docker 和 Kubernetes 相组合，以提供功能强大的工具、直观的用户体验以及内置安全性和隔离，可使用 Kubernetes API 通过独立计算主机的集群，自动对容器化应用程序进行部署、操作、扩展和监视。">了解有关集群管理和在 <span class="keyword">Bluemix</span> Public 上迁移至 <span class="keyword">IBM
Bluemix Container Service</span> 中的 Kubernetes 的信息。</a></span></div>
</div>


<div class="p">在此页面中：<div class="lines">&nbsp;&nbsp;&nbsp;&nbsp; • <a href="container_integrations.html#container_integrations__data">数据分析和存储服务</a><br>
&nbsp;&nbsp;&nbsp;&nbsp; • <a href="container_integrations.html#container_integrations__devops">DevOps Services</a><br>
&nbsp;&nbsp;&nbsp;&nbsp; • <a href="container_integrations.html#container_integrations__integrate">集成服务</a><br>
&nbsp;&nbsp;&nbsp;&nbsp; • <a href="container_integrations.html#container_integrations__network">网络服务</a><br>
&nbsp;&nbsp;&nbsp;&nbsp; • <a href="container_integrations.html#container_integrations__security">安全服务</a><br>
&nbsp;&nbsp;&nbsp;&nbsp; • <a href="container_integrations.html#container_integrations_binding" title="IBM Bluemix 具有一个服务列表，它会代表开发者来管理这些服务。要添加 Bluemix 服务以供容器使用，必须请求此服务的实例，然后将此服务绑定到容器。">通过 Bluemix GUI 绑定服务</a><br>
&nbsp;&nbsp;&nbsp;&nbsp; • <a href="container_integrations.html#container_integrations_binding_cli" title="IBM Bluemix 具有一个服务列表，它会代表开发者来管理这些服务。要添加 Bluemix 服务以供容器使用，必须请求此服务的实例，然后将此服务绑定到容器。">从 CLI 将服务绑定到容器</a><br>
&nbsp;&nbsp;&nbsp;&nbsp; • <a href="container_integrations.html#container_alertnotification" title="配置应用程序，以在满足特定条件时发送通知，并使用Alert Notification服务来管理警报通知。 使用Alert Notification服务，您可以创建定制通知策略，以过滤您感兴趣的警报。 可根据需要优化策略过滤器，以将个人或组指定为警报收件人，还可以指定首选通知方法和频率。">使用 Alert Notification 为容器中部署的应用程序配置警报</a><br>
&nbsp;&nbsp;&nbsp;&nbsp; • <a href="container_integrations.html#container_pipeline_ov" title="使用作为 IBM Bluemix Continuous Delivery 一部分的 Delivery Pipeline，对 Bluemix 自动执行应用程序构建和容器部署。">使用 Continuous Delivery 服务中的 Delivery Pipeline 自动部署容器</a><br>
&nbsp;&nbsp;&nbsp;&nbsp; • <a href="container_integrations.html#container_cfapp_tutorial_intro" title="您可以采用先前通过 Cloud Foundry 部署的应用程序，并使用 IBM Bluemix Container Service 将其部署在容器中。">教程：在容器中部署 Cloud Foundry Node.js 应用程序</a></div>
</div>
</div>
<section role="region" aria-labelledby="d58943e219" id="container_integrations__data"><h2 class="sectiontitle" id="d58943e219">数据分析和存储服务</h2>
<div class="p"><dl><dt class="dlterm"><span class="keyword">Object Storage</span></dt>
<dd><p>存储在多个存储节点之间复制的持久数据以进行备份。</p>

<div class="p"><ul><li>有关 <span class="keyword">Object Storage</span> 服务的常规信息，请参阅 <a href="../services/ObjectStorage/index.html"><span class="keyword">Object Storage</span> 服务入门</a>。</li>
</ul>
</div>
</dd>
</dl>
</div>
</section><section role="region" aria-labelledby="d58943e245" id="container_integrations__devops"><h2 class="sectiontitle" id="d58943e245">DevOps Services</h2>
<div class="p"><dl><dt class="dlterm"><span class="keyword">Active Deploy</span></dt>
<dd><p>无需停机时间就可更新正在运行的容器组，并在需要时快速还原为原始版本。<span class="keyword">IBM Active
Deploy for Bluemix</span> 服务使用分段方法进行部署，使您有时间在生产环境中测试并验证已更新的应用程序。</p>
</dd>
<dd class="ddexpand"><div class="p">有关更新正在运行的容器组的信息，请参阅：<ul><li><a href="../services/ActiveDeploy/updatingapps.html#updatingappscli" rel="external" target="_blank" title="（在新的选项卡或窗口中打开）">使用 Active Deploy 服务更新应用程序或容器组 (CLI)</a></li>
<li><a href="../services/ActiveDeploy/updatingapps.html#updatingappsgui" rel="external" target="_blank" title="（在新的选项卡或窗口中打开）">使用 Active Deploy 服务更新应用程序或容器组 (GUI)</a></li>
</ul>
</div>
</dd>
<dt class="dlterm"><span class="keyword">Alert Notification</span></dt>
<dd><p>设置通知策略，以仅过滤出您有兴趣从应用程序获取的警报。可根据需要优化策略过滤器，以将个人或组指定为警报收件人，还可以指定首选通知方法和频率。</p>

<div class="p"><ul><li>有关将容器与 <span class="keyword">Alert Notification</span> 配合使用的更多信息，请参阅<a href="container_integrations.html#container_alertnotification" title="配置应用程序，以在满足特定条件时发送通知，并使用Alert Notification服务来管理警报通知。 使用Alert Notification服务，您可以创建定制通知策略，以过滤您感兴趣的警报。 可根据需要优化策略过滤器，以将个人或组指定为警报收件人，还可以指定首选通知方法和频率。">使用 Alert Notification 为容器中部署的应用程序配置警报</a>。</li>
<li>有关 <span class="keyword">Alert Notification</span> 服务的常规信息，请参阅 <a href="../services/AlertNotification/index.html"><span class="keyword">Alert Notification</span>入门</a>。</li>
</ul>
</div>
</dd>
<dt class="dlterm"><span class="keyword">Delivery Pipeline</span></dt>
<dd><p>使用作为 <span class="keyword">IBM
Bluemix Continuous Delivery</span> 一部分的 <span class="keyword">Delivery Pipeline</span>，对 <span class="keyword">Bluemix</span> 自动执行应用程序构建和容器部署。</p>

<div class="p"><ul><li>有关将容器与管道一起使用的更多信息，请参阅<a href="container_integrations.html#container_pipeline_ov" title="使用作为 IBM Bluemix Continuous Delivery 一部分的 Delivery Pipeline，对 Bluemix 自动执行应用程序构建和容器部署。">使用 Continuous Delivery 服务中的 Delivery Pipeline 自动部署容器</a>。</li>
<li>有关 <span class="keyword">Delivery Pipeline</span> 服务的常规信息，请参阅 <a href="../services/ContinuousDelivery/pipeline_about.html">Delivery Pipeline 入门</a>。</li>
</ul>
</div>
</dd>
<dt class="dlterm">UrbanCode Deploy</dt>
<dd><p>通过 IBM UrbanCode Deploy 管理发行版，并自动执行容器部署。此服务提供了多种工具，可用于查看您在各个环境中的部署。您可以使用此服务来替代 <span class="keyword">Delivery Pipeline</span> 服务。</p>

<ul><li>有关采购信息，请参阅 <a href="http://www.ibm.com/software/products/en/ucdep" rel="external" target="_blank" title="（在新的选项卡或窗口中打开）">IBM UrbanCode 部署</a>的产品页面。</li>
<li>有关 UrbanCode Deploy 的常规信息，请参阅 <a href="http://www.ibm.com/support/knowledgecenter/SS4GSP/ucd_welcome.html" rel="external" target="_blank" title="（在新的选项卡或窗口中打开）">IBM Knowledge Center</a>。</li>
</ul>
</dd>
</dl>
</div>
</section><section role="region" aria-labelledby="d58943e389" id="container_integrations__integrate"><h2 class="sectiontitle" id="d58943e389">集成服务</h2>
<div class="p"><dl><dt class="dlterm">Istio</dt>
<dd><p>在 <span class="keyword">IBM
Bluemix Container Service</span> 中为应用程序或服务管理微服务。<span class="ph">要了解有关信息或要参与 Istio 开放式源代码项目，请参阅 <a href="https://istio.io/" rel="external" target="_blank" title="（在新的选项卡或窗口中打开）">https://istio.io/</a>。</span></p>
</dd>
<dt class="dlterm"><span class="keyword">Secure Gateway</span></dt>
<dd><p>安全地将 <span class="keyword">Bluemix</span> 应用程序连接到内部部署或云中的远程位置。</p>

<div class="p"><ul><li>有关将 <span class="keyword">IBM
Bluemix Container Service</span> 与 <span class="keyword">Secure Gateway</span> 配合使用的信息，请参阅<a href="../services/SecureGateway/sg_003.html#sg_003">将 Docker 用作客户机</a>。</li>
<li>有关 <span class="keyword">Secure Gateway</span> 服务的常规信息，请参阅 <a href="../services/SecureGateway/secure_gateway.html"><span class="keyword">Secure Gateway</span> 服务入门</a>。</li>
</ul>
</div>

</dd>
</dl>
</div>
</section><section role="region" aria-labelledby="d58943e456" id="container_integrations__network"><h2 class="sectiontitle" id="d58943e456">网络服务</h2>
<div class="p"><dl><dt class="dlterm">VPN</dt>
<dd><p>允许容器在 <span class="keyword">Bluemix</span> 空间与内部网服务器之间相互通信。</p>

<div class="p"><ul><li>有关 <span class="keyword">IBM
VPN</span> 服务的常规信息，请参阅 <a href="../services/vpn/index.html"><span class="keyword">IBM
VPN</span> 服务入门</a>。</li>
</ul>
</div>
</dd>
</dl>
</div>
</section><section role="region" aria-labelledby="d58943e489" id="container_integrations__security"><h2 class="sectiontitle" id="d58943e489">安全服务</h2>
<div class="p"><dl><dt class="dlterm"><span class="keyword">Activity Tracker</span></dt>
<dd><p>审计 API 调用，用于查看是否有任何类型的异常活动，以及帮助您符合监管审计需求。</p>
</dd>
<dd class="ddexpand"><div class="p"><ul><li>有关 <span class="keyword">Activity Tracker</span> 服务的常规信息，请参阅 <a href="../services/AccessTrail/index.html"><span class="keyword">Activity Tracker</span> 服务入门</a>。</li>
</ul>
</div>
</dd>
</dl>
</div>
</section></div>
<article class="topic concept nested1" role="article" aria-labelledby="d58943e515" id="rellinks"><h2 class="topictitle2" id="d58943e515">相关链接</h2>
<aside role="complementary" aria-labelledby="d58943e515">
<div class="linklist" id="general"><h3 class="linklistlabel">相关链接</h3>
<ul><li><img src="./sout.gif" alt=""><a href="https://wiki.eclipse.org/Linux_Tools_Project/Docker_Tooling" rel="external" target="_blank" title="（在新的选项卡或窗口中打开）">Docker Tooling for Eclipse</a></li>
</ul></div>
</aside></article><article class="topic task nested1" role="article" aria-labelledby="d58943e525" lang="zh-cn" id="container_integrations_binding"><h2 class="topictitle2" id="d58943e525">通过 <span class="keyword">Bluemix</span> GUI 绑定服务</h2>
<div class="body taskbody"><p class="shortdesc"><span class="keyword">IBM
Bluemix</span> 具有一个服务列表，它会代表开发者来管理这些服务。要添加 <span class="keyword">Bluemix</span> 服务以供容器使用，必须请求此服务的实例，然后将此服务绑定到容器。</p>
<div class="section prereq">开始之前，请将服务添加到 <span class="keyword">Bluemix</span> 空间。有关更多信息，请参阅<a href="../services/reqnsi.html#req_instance">请求新服务实例</a>。</div><div class="section context"><div class="note restriction" id="container_integrations_binding__restriction"><span class="restrictiontitle">限制：</span> 某些 <span class="keyword">Bluemix</span> 服务不支持直接绑定到容器，且会在创建容器期间导致失败。在此情况下，请先将 <span class="keyword">Bluemix</span> 服务绑定到 Cloud Foundry 应用程序，然后再将该应用程序绑定到容器。
此应用程序用作服务和容器之间的桥梁。有关更多信息，请参阅<a href="container_troubleshoot.html#ts_bridge_app">Bluemix 服务未直接绑定到容器</a>。</div>
</div><ol class="steps"><li class="step"><span class="cmd">在 <span class="keyword">Bluemix</span>“<span class="keyword wintitle">目录</span>”中，单击<span class="ph uicontrol">容器</span>。</span></li>
<li class="step"><span class="cmd">单击容器映像。</span></li>
<li class="step"><span class="cmd">展开<span class="ph uicontrol">高级选项</span>，然后在<span class="ph uicontrol">选择服务</span>中选择某个可用的 <span class="keyword">Bluemix</span> 服务。</span></li>
<li class="step"><span class="cmd">单击<span class="ph uicontrol">添加</span>。</span> 该 <span class="keyword">Bluemix</span> 服务将显示在<span class="ph uicontrol">已绑定到容器</span>字段中。</li>
<li class="step"><span class="cmd">填写其他字段，然后单击<span class="ph uicontrol">创建</span>。</span></li>
<li class="step"><span class="cmd">创建容器时，验证是否显示 VCAP_SERVICES 信息。</span> 在容器的“概述”选项卡中，找到绑定的服务，然后单击<span class="ph uicontrol">查看凭证</span>。所显示的信息为 VCAP_SERVICES。</li>
</ol>
</div>
</article><article class="topic task nested1" role="article" aria-labelledby="d58943e684" lang="zh-cn" id="container_integrations_binding_cli"><h2 class="topictitle2" id="d58943e684">从 CLI 将服务绑定到容器</h2>
<div class="body taskbody"><p class="shortdesc"><span class="keyword">IBM
Bluemix</span> 具有一个服务列表，它会代表开发者来管理这些服务。要添加 <span class="keyword">Bluemix</span> 服务以供容器使用，必须请求此服务的实例，然后将此服务绑定到容器。</p>
<div class="section prereq">开始之前，请将服务添加到 <span class="keyword">Bluemix</span> 空间。有关更多信息，请参阅<a href="../services/reqnsi.html#req_instance">请求新服务实例</a>。</div><div class="section context"><div class="note restriction" id="container_integrations_binding_cli__restriction"><span class="restrictiontitle">限制：</span> 某些 <span class="keyword">Bluemix</span> 服务不支持直接绑定到容器，且会在创建容器期间导致失败。在此情况下，请先将 <span class="keyword">Bluemix</span> 服务绑定到 Cloud Foundry 应用程序，然后再将该应用程序绑定到容器。
此应用程序用作服务和容器之间的桥梁。有关更多信息，请参阅<a href="container_troubleshoot.html#ts_bridge_app">Bluemix 服务未直接绑定到容器</a>。</div>
</div><ol class="steps"><li class="step stepexpand"><span class="cmd">使用以下某个命令将 <span class="keyword">Bluemix</span> 服务实例绑定到新容器。</span> <div class="note tip"><span class="tiptitle">提示：</span> <span class="ph">运行 <samp class="ph codeph"><span class="ph">bx ic</span> namespace-get</samp> 来检索您的名称空间，并将 <var class="keyword varname">&lt;my_namespace&gt;</var> 替换为您的名称空间信息。</span></div>
<ul class="ul choices"><li class="li choice">如果您要创建单个容器，请使用以下命令。<pre class="codeblock"><code><span class="ph"><samp class="ph codeph">bx ic</samp></span> run --name <var class="keyword varname">container_name</var> -e "<var class="keyword varname">CCS_BIND_SRV</var>=<var class="keyword varname">service_instance1</var>,<var class="keyword varname">service_instance2</var>" registry.<span class="keyword" data-hd-keyref="DomainName">DomainName</span>/<var class="keyword varname">&lt;my_namespace&gt;</var>/<var class="keyword varname">image_name</var></code></pre>
</li>
<li class="li choice">如果您要创建容器组，请使用以下命令。<pre class="codeblock"><code><span class="ph"><samp class="ph codeph">bx ic</samp></span> group-create --name <var class="keyword varname">container_group_name</var> -e "<var class="keyword varname">CCS_BIND_SRV</var>=<var class="keyword varname">service_instance1</var>,<var class="keyword varname">service_instance2</var>" registry.<span class="keyword" data-hd-keyref="DomainName">DomainName</span>/<var class="keyword varname">&lt;my_namespace&gt;</var>/<var class="keyword varname">image_name</var></code></pre>
</li>
<li class="li choice">如果您将服务绑定到已在运行的容器组，请使用以下命令。
此命令仅可用于容器组。
一次只能绑定一个服务。
<pre class="codeblock"><code><span class="ph"><samp class="ph codeph">bx ic</samp></span> service-bind <var class="keyword varname">container_group_name</var> <var class="keyword varname">service_instance</var></code></pre>
</li>
</ul>
</li>
<li class="step stepexpand"><span class="cmd">使用以下某个命令，验证服务实例已绑定到容器。</span> <ul class="ul choices"><li class="li choice">对于单个容器，请使用以下命令。<pre class="codeblock"><code><span class="ph"><samp class="ph codeph">bx ic</samp></span> inspect CONTAINER</code></pre>
</li>
<li class="li choice">对于容器组，请使用以下命令。<pre class="codeblock"><code><span class="ph"><samp class="ph codeph">bx ic</samp></span> group-inspect GROUP</code></pre>
</li>
</ul>
验证已显示服务的 VCAP_SERVICES 信息。
<pre class="codeblock"><code>{
 "VCAP_SERVICES": {
  "&lt;service_name&gt;": [
   {
    "credentials": {
     "hostname": "&lt;hostname_id&gt;",
     "jdbcUrl": "&lt;jdbc_URL&gt;",
     "name": "&lt;encoded_name&gt;",
     "password": "&lt;encoded_password&gt;",
     "port": "&lt;port_number&gt;",
     "uri": "&lt;service_URI&gt;",
     "username": "&lt;encoded_username&gt;"
    },
    "label": "&lt;service_name&gt;",
    "name": "&lt;service_instance&gt;",
    "plan": "&lt;plan_name&gt;",
    "tags": [
     "&lt;tag1&gt;",
     "&lt;tag2&gt;",
     "&lt;tag3&gt;"
    ]
   } </code></pre>
</li>
</ol>
</div>
</article><article class="topic task nested1" role="article" aria-labelledby="d58943e883" lang="zh-cn" id="container_alertnotification"><h2 class="topictitle2" id="d58943e883">使用 <span class="keyword">Alert Notification</span> 为容器中部署的应用程序配置警报</h2>
<div class="body taskbody"><p class="shortdesc">配置应用程序，以在满足特定条件时发送通知，并使用<span class="keyword">Alert Notification</span>服务来管理警报通知。
使用<span class="keyword">Alert Notification</span>服务，您可以创建定制通知策略，以过滤您感兴趣的警报。
可根据需要优化策略过滤器，以将个人或组指定为警报收件人，还可以指定首选通知方法和频率。</p>
<div class="section prereq">开始之前，请先查看<a href="../services/reqnsi.html#req_instance">请求新服务实例</a>主题，并在 <span class="keyword">Bluemix</span> 空间中创建 <span class="keyword">Alert Notification</span> 服务的实例。</div><div class="section context"><p>以下步骤显示如何创建运行样本<span class="keyword">Alert Notification</span>节点应用程序的容器。您可以将测试警报发送到<span class="keyword">Alert Notification</span>服务，并在“警报查看器”工具中对它们进行复查。</p>
</div><ol class="steps"><li class="step stepexpand"><span class="cmd">将样本<a href="https://github.com/IBM-Bluemix/alert-notification-helloworld" rel="external" target="_blank" title="（在新的选项卡或窗口中打开）">警报通知应用程序</a>下载并克隆到您的本地计算机。</span> <pre class="codeblock"><code>git clone <span class="ph filepath">https://github.com/IBM-Bluemix/alert-notification-helloworld.git</span></code></pre>


<div class="steps note"><span class="notetitle">注：</span> 当您克隆 Git 项目时，会在您的本地计算机上创建名为 <span class="ph filepath">alert-notification-helloworld</span> 的新文件夹。</div>
</li>
<li class="step stepexpand"><span class="cmd">构建包含样本警报通知应用程序的容器映像，然后将其推送到专用 <span class="keyword">Bluemix</span> 映像注册表。</span> <ol type="a" class="ol substeps"><li class="li substep substepexpand"><span class="cmd"><a href="container_cli_cfic_install.html#container_cli_login" title="安装 CLI 后，需要登录才能使用。">登录到 <span class="keyword">IBM
Bluemix Container Service</span> CLI</a>。</span></li>
<li class="li substep substepexpand"><span class="cmd">浏览到 <span class="ph filepath">alert-notification-helloworld</span> 目录。</span></li>
<li class="li substep substepexpand"><span class="cmd">创建容器映像，然后将其推送到专用 <span class="keyword">Bluemix</span> 映像注册表。运行 <samp class="ph codeph"><span class="ph"><samp class="ph codeph">bx ic</samp></span> namespace-get</samp> 来检索您的名称空间信息，然后将 <var class="keyword varname">&lt;my_namespace&gt;</var> 替换为您的名称空间。</span> <pre class="codeblock"><code><span class="ph"><samp class="ph codeph">bx ic</samp></span> build -t registry.<span class="keyword" data-hd-keyref="DomainName">DomainName</span>/<var class="keyword varname">&lt;my_namespace&gt;</var>/alert</code></pre>
</li>
<li class="li substep substepexpand"><span class="cmd">验证是否已成功创建和推送容器映像。</span> <pre class="codeblock"><code><span class="ph"><samp class="ph codeph">bx ic</samp></span> images</code></pre>
</li>
</ol>
</li>
<li class="step stepexpand"><span class="cmd">从映像创建容器，并将<span class="keyword">Alert Notification</span>服务与其进行绑定。将 <var class="keyword varname">&lt;my_namespace&gt;</var> 替换为您的名称空间信息，将 <var class="keyword varname">&lt;my_alert&gt;</var> 替换为您在开始创建的警报通知服务实例的名称。</span> <pre class="codeblock"><code><span class="ph"><samp class="ph codeph">bx ic</samp></span> run --name alertcontainer -p 8080 -e "CCS_BIND_SRV=<var class="keyword varname">&lt;my_alert&gt;</var>" registry.<span class="keyword" data-hd-keyref="DomainName">DomainName</span>/<var class="keyword varname">&lt;my_namespace&gt;</var>/alert</code></pre>
</li>
<li class="step stepexpand"><span class="cmd">验证容器是否在运行。</span> <pre class="codeblock"><code><span class="ph"><samp class="ph codeph">bx ic</samp></span>ps</code></pre>
</li>
<li class="step stepexpand"><span class="cmd">将公共 IP 地址绑定到容器。</span> <ol type="a" class="ol substeps"><li class="li substep substepexpand"><span class="cmd">列出空间中可用的公共 IP 地址，并记下您要使用的 IP 地址。</span> <pre class="codeblock"><code><span class="ph"><samp class="ph codeph">bx ic</samp></span> ips</code></pre>


<div class="note tip"><span class="tiptitle">提示：</span> 如果空间中没有可用的公共 IP 地址，请运行 <samp class="ph codeph"><span class="ph"><samp class="ph codeph">bx ic</samp></span> ip-request</samp>，以请求新的 IP 地址。
您还可以运行 <samp class="ph codeph"><span class="ph"><samp class="ph codeph">bx ic</samp></span> unbind <var class="keyword varname">&lt;IP_ADDRESS&gt;</var>
<var class="keyword varname">&lt;CONTAINER&gt;</var></samp> 命令，将已使用的 IP 地址与容器取消绑定。</div>
</li>
<li class="li substep substepexpand"><span class="cmd">将公共 IP 地址绑定到容器。将 <var class="keyword varname">&lt;IP_ADDRESS&gt;</var> 替换为上一步中记下的 IP 地址。</span> <pre class="codeblock"><code><span class="ph"><samp class="ph codeph">bx ic</samp></span> ip-bind <var class="keyword varname">&lt;IP_ADDRESS&gt;</var> alertcontainer</code></pre>
</li>
</ol>
</li>
<li class="step stepexpand"><span class="cmd">创建测试警报。</span> <ol type="a" class="ol substeps"><li class="li substep substepexpand"><span class="cmd">打开 Web 浏览器。</span></li>
<li class="li substep substepexpand"><span class="cmd">在 Web 浏览器中输入 IP 地址和端口，如下所示：<samp class="ph codeph"><var class="keyword varname">&lt;IP_ADDRESS&gt;</var>:8080</samp>。</span> 此时将打开<span class="keyword">Alert Notification</span> Web 应用程序的欢迎页面。
<p><img src="images/alertapp.png" width="400" alt="测试警报通知 Web 应用程序"></p>
</li>
<li class="li substep substepexpand"><span class="cmd">单击<span class="ph uicontrol">发送样本警报</span>按钮，以将测试警报发送到“警报查看器”。</span></li>
</ol>
</li>
<li class="step stepexpand"><span class="cmd">打开“<span class="keyword wintitle">警报查看器</span>”并复查测试警报。</span> <ol type="a" class="ol substeps"><li class="li substep"><span class="cmd">在 <span class="keyword">Bluemix</span> GUI 中，选择正在运行的容器实例。</span></li>
<li class="li substep"><span class="cmd">单击<span class="ph uicontrol">绑定的服务</span>下的<span class="keyword">Alert Notification</span>服务。</span></li>
<li class="li substep"><span class="cmd">单击<span class="ph uicontrol">启动</span>以打开“警报查看器”。</span></li>
<li class="li substep"><span class="cmd">复查测试警报。</span></li>
</ol>
</li>
<li class="step stepexpand"><span class="cmd">浏览<span class="keyword">Alert Notification</span>服务的功能。</span> 复查<span class="keyword">Alert Notification</span>文档，以查找如何<a href="../services/AlertNotification/alert_configuring.html" rel="external" target="_blank" title="（在新的选项卡或窗口中打开）">创建通知策略</a>和<a href="../services/AlertNotification/alert_viewer.html" rel="external" target="_blank" title="（在新的选项卡或窗口中打开）">管理警报</a>的更多信息。</li>
</ol>
</div>
</article><article class="topic concept nested1" role="article" aria-labelledby="d58943e1213" lang="zh-cn" id="container_pipeline_ov"><h2 class="topictitle2" id="d58943e1213">使用 <span class="keyword">Continuous Delivery</span> 服务中的 <span class="keyword">Delivery Pipeline</span> 自动部署容器</h2>
<div class="body conbody"><p class="shortdesc">使用作为 <span class="keyword">IBM
Bluemix Continuous Delivery</span> 一部分的 <span class="keyword">Delivery Pipeline</span>，对 <span class="keyword">Bluemix</span> 自动执行应用程序构建和容器部署。</p>
<div class="p"><span class="keyword">Delivery Pipeline</span> 支持：<ul><li>构建 Docker 映像</li>
<li>将容器中的映像部署到 <span class="keyword">Bluemix</span></li>
</ul>
</div>
<div><p>使用 <span class="keyword">Delivery Pipeline</span> 部署容器的快速入门指南：</p>

<ol><li>创建用于包含代码的 Git 存储库。</li>
<li>在存储库的根目录中包含一个 <samp class="ph codeph">Dockerfile</samp>。</li>
<li>在菜单中，单击<span class="ph menucascade"><span class="ph uicontrol">服务</span> &gt; <span class="ph uicontrol">DevOps</span></span>，然后单击<span class="ph uicontrol">管道</span>。</li>
<li>单击<span class="ph menucascade"><span class="ph uicontrol">创建管道</span> &gt; <span class="ph uicontrol"><span class="keyword">Delivery Pipeline</span></span></span>。</li>
<li>单击<span class="ph uicontrol">创建</span>。</li>
<li>将 Git 存储库添加到工具链。<ol type="a" id="container_pipeline_ov__ol_mvk_s3v_vz"><li>单击<span class="ph uicontrol">添加工具</span>。</li>
<li>单击用于托管存储库的 Git 服务的类型。</li>
<li>提供存储库的配置详细信息。</li>
<li>单击<span class="ph uicontrol">创建集成</span>。</li>
</ol>
</li>
<li>在工具链的“概述”页面中，单击 <span class="ph uicontrol"><span class="keyword">Delivery Pipeline</span></span>。</li>
<li>创建包含构建作业的构建阶段。<ol type="a" id="container_pipeline_ov__ol_pds_x3v_vz"><li>单击<span class="ph uicontrol">添加阶段</span>。</li>
<li>在<span class="ph uicontrol">输入</span>选项卡上，对于<span class="ph uicontrol">输入类型</span>，选择 <span class="ph uicontrol">Git 存储库</span>。</li>
<li>在<span class="ph uicontrol">作业</span>选项卡上，添加构建作业。对于<span class="ph uicontrol">构建程序类型</span>，选择 <span class="ph uicontrol"><span class="keyword">Bluemix</span> 上的 IBM Containers</span>。</li>
</ol>
</li>
<li>创建包含部署作业的部署阶段。<ol type="a" id="container_pipeline_ov__ol_ahk_djv_vz"><li>在<span class="ph uicontrol">输入</span>选项卡上，对于<span class="ph uicontrol">输入类型</span>，选择<span class="ph uicontrol">构建工件</span>。</li>
<li>在<span class="ph uicontrol">作业</span>选项卡上，对于<span class="ph uicontrol">部署程序类型</span>，选择 <span class="ph uicontrol">IBM Container Service for Bluemix</span>。</li>
</ol>
</li>
<li>通过推送代码更改或单击 <span class="keyword">Delivery Pipeline</span> 的构建阶段上的“运行阶段”图标来运行部署。</li>
</ol>
</div><div>需要了解更多信息？请查看以下主题。<ul><li><a href="container_integrations.html#container_single_pipeline_ov" title="使用 Delivery Pipeline 自动构建和部署单个容器。">使用 Delivery Pipeline 创建单个容器</a></li>
<li><a href="container_integrations.html#container_group_pipeline_ov" title="使用 Delivery Pipeline 自动构建和部署容器组。">使用 Delivery Pipeline 创建容器组</a></li>
</ul>
</div></div>
<article class="topic task nested2" role="article" aria-labelledby="d58943e1448" lang="zh-cn" id="container_single_pipeline_ov"><h3 class="topictitle3" id="d58943e1448">使用 <span class="keyword">Delivery Pipeline</span> 创建单个容器</h3>
<div class="body taskbody"><p class="shortdesc">使用 <span class="keyword">Delivery Pipeline</span> 自动构建和部署单个容器。</p>
</div>
<article class="topic task nested3" role="article" aria-labelledby="d58943e1510" lang="zh-cn" id="container_single_pipeline_build"><h4 class="topictitle4" id="d58943e1510">使用 <span class="keyword">Delivery Pipeline</span> 创建容器的构建阶段</h4>
<div class="body taskbody"><p class="shortdesc"><span class="keyword">IBM
Bluemix Container Service</span> 包含构建服务，此构建服务接收源代码，然后会构建 Docker 映像并将其发布到容器注册表。作为 <span class="keyword">IBM
Bluemix Continuous Delivery</span> 一部分的 <span class="keyword">Delivery Pipeline</span> 提供了使用容器构建服务的构建作业。此构建作业采用存储库中的源代码，通过该代码构建 Docker 映像，对此映像进行版本控制（标记）以匹配构建号，然后将生成的映像推送到组织的 <span class="keyword">Bluemix</span> 上的 <span class="keyword">IBM
Bluemix Container Service</span> 注册表。
之后，组织的成员可将生成的映像部署到组织中的空间。</p>
<div class="section prereq" id="container_single_pipeline_build__prereq"> <div class="p">开始之前，请考虑以下信息。<ul><li>要了解有关构建、阶段和基本管道功能的更多信息，请参阅 <span class="keyword">Continuous Delivery</span> 文档中的<a href="../services/ContinuousDelivery/pipeline_about.html">关于 <span class="keyword">Delivery Pipeline</span></a> 主题。</li>
<li>通过检查 <span class="keyword">Bluemix</span>“<span class="keyword wintitle">目录</span>”，确定要在容器中使用组织专用映像注册表中的哪个现有映像。</li>
<li>如果您确定需要将服务绑定到容器，请创建应用程序以充当桥梁。有关更多信息，请参阅<a href="container_integrations.html#unique_2124940809" title="服务不能直接绑定到容器。可以改为将服务绑定到应用程序，然后通过在管道阶段配置环境属性来将该应用程序绑定到容器。该应用程序将用作服务和容器之间的桥梁。">使用 <span class="keyword">Delivery Pipeline</span> 将服务绑定到容器</a>。</li>
</ul>
</div>
 </div><p class="li stepsection">在 <span class="keyword">Delivery Pipeline</span> 中构建 Docker 映像。</p><ol class="steps" id="container_single_pipeline_build__steps"><li class="step stepexpand"><span class="cmd">在与工具链关联的 Git 存储库的根目录中创建 Dockerfile，然后将其落实到存储库。</span></li>
<li class="step stepexpand"><span class="cmd">在工具链的“概述”页面中，单击 <span class="ph uicontrol"><span class="keyword">Delivery Pipeline</span></span>。</span></li>
<li class="step stepexpand"><span class="cmd">创建构建阶段。</span> <ol type="a" class="ol substeps"><li class="li substep"><span class="cmd">单击<span class="ph uicontrol">添加阶段</span>。</span></li>
<li class="li substep"><span class="cmd">命名阶段。</span> 例如，<samp class="ph codeph"><var class="keyword varname">Build</var></samp>。</li>
<li class="li substep"><span class="cmd">对于<span class="ph uicontrol">输入类型</span>，选择 <span class="ph uicontrol">Git 存储库</span>。</span></li>
<li class="li substep"><span class="cmd">针对其他字段，验证值并根据需要进行更新。</span></li>
<li class="li substep"><span class="cmd">单击<span class="ph uicontrol">作业</span>选项卡。</span></li>
</ol>
</li>
<li class="step stepexpand"><span class="cmd">在构建阶段中，创建构建作业。</span> <ol type="a" class="ol substeps"><li class="li substep substepexpand"><span class="cmd">在<span class="ph uicontrol">作业</span>选项卡中，单击<span class="ph uicontrol">添加作业</span>。</span></li>
<li class="li substep substepexpand"><span class="cmd">选择<span class="ph uicontrol">构建</span>作业类型。</span></li>
<li class="li substep substepexpand"><span class="cmd">对于<span class="ph uicontrol">构建程序类型</span>，选择 <span class="ph uicontrol"><span class="keyword">Bluemix</span> 上的 IBM Containers</span>。</span></li>
<li class="li substep substepexpand"><span class="cmd">根据需要，更新 <span class="keyword">Bluemix</span> 目标、组织和空间。</span></li>
<li class="li substep substepexpand"><span class="cmd">对于<span class="ph uicontrol">使用高速缓存的层</span>，如果必须强制刷新层以从其他源动态拉取内容，请清除此字段。</span> <p>例如，如果 <samp class="ph codeph">Dockerfile</samp> 包含 <samp class="ph codeph">apt-get install</samp> 或 <samp class="ph codeph">wget</samp> 命令，请确保通过清除<span class="ph uicontrol">使用高速缓存的层</span>复选框来为每个构建收集这些动态依赖项。</p>
 <div class="steps note"><span class="notetitle">注：</span> 如果<span class="ph uicontrol">使用高速缓存的层</span>字段已清除，那么由于构建映像时未使用高速缓存的层，因此构建时间会更长。</div>
</li>
<li class="li substep substepexpand"><span class="cmd">在<span class="ph uicontrol">映像名称</span>字段中，输入要构建的映像的名称。为了满足 Docker 命名约定，请只使用小写字母、数字和连字符 (-)。</span> 构建映像时，将使用映像名称和构建号标记该映像。 例如，如果输入映像名称 <samp class="ph codeph">myappimage</samp>，那么针对构建号 4，生成的映像将名为 <samp class="ph codeph">myappimage:4</samp>。</li>
<li class="li substep substepexpand"><span class="cmd">如果在项目的根目录中找不到 Dockerfile，请在“构建脚本”部分的以下各个位置中，添加 Dockerfile 的路径。</span> <ol type="i"><li>请在“运行单元测试”部分的前面用更改目录命令来添加文件夹名称。<div class="p"><pre class="codeblock"><code>cd <var class="keyword varname">&lt;folder&gt;</var></code></pre>
</div>
</li>
<li>在显示 <var class="keyword varname">${WORKSPACE}</var> 变量的所有位置，附加文件夹名称。<var class="keyword varname">${WORKSPACE}</var> 变量会自动为您检测项目的根目录。<div class="p">示例<pre class="codeblock"><code>BUILD_COMMAND="build --pull --tag ${FULL_REPOSITORY_NAME} ${WORKSPACE}/<var class="keyword varname">&lt;folder&gt;</var>"</code></pre>
</div>
</li>
</ol>
</li>
</ol>
</li>
<li class="step stepexpand"><span class="cmd">单击<span class="ph uicontrol">保存</span>。</span></li>
<li class="step stepexpand"><span class="cmd">单击<span class="ph uicontrol">运行阶段</span>图标，以验证该阶段在构建时是否没有任何错误。</span> 如果构建失败，请查看日志并更正错误。如果该阶段成功，请检查组织的映像注册表，并验证映像是否已构建。</li>
</ol>
</div>
</article><article class="topic task nested3" role="article" aria-labelledby="d58943e1813" lang="zh-cn" id="container_pipeline_vulnerability"><h4 class="topictitle4" id="d58943e1813">（可选）在管道执行过程中检查映像安全性</h4>
<div class="body taskbody"><div class="abstract"><span class="shortdesc">在部署容器之前，使用漏洞顾问程序在映像中查找安全性或配置问题。</span>
</div>
<div class="section context"><div class="p">包含此扫描的常见管道设置：<ul><li>用于构建源文件的构建阶段</li>
<li>包含以下作业的处理阶段：<ul><li>用于运行容器构建的构建作业</li>
<li>用于对映像运行漏洞顾问程序的测试作业</li>
</ul>
</li>
<li>用于部署容器的部署阶段</li>
</ul>
</div>

<div class="note tip"><span class="tiptitle">提示：</span> 此任务概述了如何在不同于构建容器映像的作业的阶段中，为漏洞顾问程序创建测试作业。或者，也可以使用构建容器映像的作业所在的阶段。如果决定创建单独的阶段，那么无需设置环境变量。</div>
</div><p class="li stepsection">创建漏洞顾问程序扫描。</p><ol class="steps" id="container_pipeline_vulnerability__steps"><li class="step stepexpand"><span class="cmd">创建处理阶段。</span> <ol type="a" class="ol substeps"><li class="li substep"><span class="cmd">单击<span class="ph uicontrol">添加阶段</span>。</span></li>
<li class="li substep"><span class="cmd">命名阶段。</span> 例如，<samp class="ph codeph"><var class="keyword varname">Processing</var></samp>。</li>
<li class="li substep"><span class="cmd">对于“输入类型”，选择<span class="ph uicontrol">构建工件</span>。</span></li>
<li class="li substep"><span class="cmd">针对阶段和作业，验证值并根据需要进行更新。</span></li>
<li class="li substep"><span class="cmd">单击<span class="ph uicontrol">作业</span>选项卡。</span></li>
</ol>
</li>
<li class="step stepexpand"><span class="cmd">在处理阶段中，添加测试作业以运行代码扫描。</span> <ol type="a" class="ol substeps"><li class="li substep substepexpand"><span class="cmd">在<span class="ph uicontrol">作业</span>选项卡上，单击<span class="ph uicontrol">添加作业</span>。</span></li>
<li class="li substep substepexpand"><span class="cmd">对于作业类型，选择<span class="ph uicontrol">测试</span>。</span></li>
<li class="li substep substepexpand"><span class="cmd">针对<span class="ph uicontrol">测试器类型</span>，选择 <span class="ph uicontrol">IBM 漏洞顾问程序</span>。</span></li>
<li class="li substep substepexpand"><span class="cmd">根据需要，更新 <span class="keyword">Bluemix</span> 目标、组织和空间。</span></li>
<li class="li substep substepexpand"><span class="cmd">针对<span class="ph uicontrol">等待分析完成的时间（分钟）</span>，输入值 0 到 59 分钟。</span> 缺省值为 <var class="keyword varname">5</var> 分钟。作业结束时，控制台日志中会提供仪表板的 URL。<p>如果此时间结束之前扫描未完成，那么作业会失败，但扫描分析会继续运行，且可在仪表板上进行查看。扫描完成后，如果重新运行作业，那么不会重新提交扫描请求，且管道作业可成功完成。或者，可将管道配置为在出现成功扫描结果时不阻止，这会在下一个步骤中进行描述。</p>
</li>
<li class="li substep substepexpand"><span class="cmd">要确定超时行为，请选中或清除<span class="ph uicontrol">此作业失败时停止运行此阶段</span>复选框。</span> <p>您可以将作业配置为在此作业失败时阻止阶段中后续作业以及后续阶段运行，也可以将阶段配置为继续执行而不阻止后续作业和阶段。作业的状态取决于是否存在重大安全问题。</p>


<p>重大安全问题会导致作业失败。根据针对<span class="ph uicontrol">此作业失败时停止运行此阶段</span>所做的选择，失败的作业会阻止阶段和管道继续执行，或者会允许它们继续执行。如果您知道此报告包含许多要处理的问题，那么您可以将阶段配置为继续执行，因为扫描需要很长时间。在此情况下，您可能不希望仅仅因为扫描需要花很长时间而停止剩余的作业和阶段。</p>
</li>
</ol>
</li>
<li class="step stepexpand"><span class="cmd">如果该作业位于与构建作业相同的阶段中，请设置存储库名称的环境变量。</span> <ol type="a" class="ol substeps"><li class="li substep"><span class="cmd">单击<span class="ph uicontrol">环境属性</span>选项卡。</span></li>
<li class="li substep"><span class="cmd">单击<span class="ph uicontrol">添加属性</span>，然后选择<span class="ph uicontrol">文本属性</span>。</span></li>
<li class="li substep"><span class="cmd">在<span class="ph uicontrol">名称</span>字段中，输入 <samp class="ph codeph">FULL_REPOSITORY_NAME</samp>。</span></li>
<li class="li substep"><span class="cmd">在<span class="ph uicontrol">值</span>字段中，不要输入任何内容。</span> 容器构建作业中指定的映像名称会通过此环境变量传递。</li>
</ol>
</li>
<li class="step stepexpand"><span class="cmd">单击<span class="ph uicontrol">保存</span>。</span></li>
<li class="step stepexpand"><span class="cmd">单击<span class="ph uicontrol">运行阶段</span>图标，以验证该阶段在构建时是否没有任何错误。</span></li>
</ol>
<div class="section result"><div class="p">要查看漏洞顾问程序扫描的结果，请在作业完成后，单击<span class="ph uicontrol">查看结果和历史记录</span>。在<span class="ph uicontrol">日志</span>选项卡上，查找以下部分：<pre class="pre msgblock"><code>image registry.<span class="keyword" data-hd-keyref="DomainName">DomainName</span>/<var class="keyword varname">namespace</var>/<var class="keyword varname">image</var> vulnerability results found</code></pre>
</div>

<p>这会列出有漏洞的包、安全问题和建议的改进措施的列表，如“漏洞顾问程序”主题<a href="va/va_index.html#va_reviewing">查看映像报告</a>中所述。<a href="va/va_index.html#va_report">解决映像中的问题</a>中提供了 Dockerfile 代码以用于解决一些常见问题。</p>
</div></div>
</article><article class="topic task nested3" role="article" aria-labelledby="d58943e2093" lang="zh-cn" id="container_pipeline_cleanup"><h4 class="topictitle4" id="d58943e2093">（可选）使用 <span class="keyword">Delivery Pipeline</span> 清除映像</h4>
<div class="body taskbody"><p class="shortdesc"><span class="keyword">IBM
Bluemix Container Service</span> 构建作业会自动清除未使用的映像版本。不会除去正在使用的映像。可以指定多个映像版本进行保存，也可以禁用映像清除。</p>
<p class="li stepsection">要更改为项目保留的映像版本数，请执行以下操作：</p><ol class="steps"><li class="step"><span class="cmd">在管道中，打开构建阶段的配置。</span></li>
<li class="step"><span class="cmd">在<span class="ph uicontrol">环境属性</span>选项卡上，单击<span class="ph uicontrol">添加属性</span>。</span></li>
<li class="step"><span class="cmd">选择<span class="ph uicontrol">文本属性</span>。</span></li>
<li class="step"><span class="cmd">在<span class="ph uicontrol">名称</span>字段中，输入 <samp class="ph codeph">IMAGE_LIMIT</samp> 命令。</span></li>
<li class="step"><span class="cmd">在<span class="ph uicontrol">值</span>字段中，输入此项目要在注册表中保留的映像版本数。缺省情况下，将保留项目的最近 5 个映像版本。要禁用映像清除并保留所有映像版本，请将此值设置为 <samp class="ph codeph">-1</samp>。</span></li>
<li class="step"><span class="cmd">单击<span class="ph uicontrol">保存</span>。</span></li>
</ol>
</div>
</article><article class="topic task nested3" role="article" aria-labelledby="d58943e2229" lang="zh-cn" id="container_binding_pipeline"><h4 class="topictitle4" id="d58943e2229">（可选）使用 <span class="keyword">Delivery Pipeline</span> 将服务绑定到容器</h4>
<div class="body taskbody"><p class="shortdesc">服务不能直接绑定到容器。可以改为将服务绑定到应用程序，然后通过在管道阶段配置环境属性来将该应用程序绑定到容器。该应用程序将用作服务和容器之间的桥梁。</p>
<div class="section prereq"><p id="container_binding_pipeline__context"><span class="keyword">Bluemix</span> 提供了一组环境变量，用于定义与应用程序绑定的服务的名称和详细信息（例如，ClearDB MySQL Database 或 Question and Answer 服务）。这些环境变量称为 <samp class="ph codeph">VCAP_SERVICES</samp>。将容器绑定到服务时，会通过在容器与服务之间充当桥梁的应用程序将 <samp class="ph codeph">VCAP_SERVICES</samp> 作为环境变量传递到该容器。然后，该容器可以从该服务查找信息，例如端点、用户和密码。</p>

<p>配置环境属性之前，请指定一个已绑定了服务的现有应用程序，或者使用 <span class="keyword">Bluemix</span> GUI 或命令行来创建一个应用程序。有关更多信息，请参阅<a href="container_troubleshoot.html#ts_bridge_app">Bluemix 服务未直接绑定到容器</a>。</p>
</div><p class="li stepsection">将桥接应用程序绑定到容器。</p><ol class="steps"><li class="step"><span class="cmd">在工具链的“概述”页面中，单击 <span class="ph uicontrol"><span class="keyword">Delivery Pipeline</span></span>。</span></li>
<li class="step"><span class="cmd">打开管道阶段，然后单击<span class="ph uicontrol">环境属性</span>选项卡。</span></li>
<li class="step"><span class="cmd">单击<span class="ph uicontrol">添加属性</span>，然后选择<span class="ph uicontrol">文本属性</span>。</span></li>
<li class="step"><span class="cmd">在<span class="ph uicontrol">名称</span>字段中，输入命令 <kbd class="ph userinput">BIND_TO</kbd>。</span></li>
<li class="step"><span class="cmd">在<span class="ph uicontrol">值</span>字段中，输入桥接应用程序的名称，例如 <var class="keyword varname">pipeline_bridge_app</var>。</span></li>
<li class="step"><span class="cmd">单击<span class="ph uicontrol">保存</span>。</span></li>
<li class="step"><span class="cmd">通过运行管道测试配置。</span></li>
</ol>
<div class="section postreq"><div class="note tip"><span class="tiptitle">提示：</span> 将桥接应用程序绑定到容器后，请不要删除该桥接应用程序。如果删除绑定的桥接应用程序，那么容器会暂挂。请先删除容器以及正在使用桥接应用程序的任何其他容器，再删除该桥接应用程序。</div>
</div></div>
</article><article class="topic task nested3" role="article" aria-labelledby="d58943e2390" lang="zh-cn" id="container_single_pipeline_deploy"><h4 class="topictitle4" id="d58943e2390">使用 <span class="keyword">Delivery Pipeline</span> 创建容器的部署阶段</h4>
<div class="body taskbody"><p class="shortdesc">您可以使用 <span class="keyword">Delivery Pipeline</span> 为容器创建部署阶段。</p>
<div class="section prereq"><div class="p">开始之前：<ul><li><a href="container_integrations.html#container_single_pipeline_build" title="IBM Bluemix Container Service 包含构建服务，此构建服务接收源代码，然后会构建 Docker 映像并将其发布到容器注册表。作为 IBM Bluemix Continuous Delivery 一部分的 Delivery Pipeline 提供了使用容器构建服务的构建作业。此构建作业采用存储库中的源代码，通过该代码构建 Docker 映像，对此映像进行版本控制（标记）以匹配构建号，然后将生成的映像推送到组织的 Bluemix 上的 IBM Bluemix Container Service 注册表。 之后，组织的成员可将生成的映像部署到组织中的空间。">创建构建阶段</a>。</li>
<li><a href="https://github.com/Osthanes/deployscripts/blob/master/deploycontainer.sh" rel="external" target="_blank" title="（在新的选项卡或窗口中打开）">复查单个容器的缺省部署脚本</a>。您可以派生缺省脚本并对其进行编辑，或者创建自己的脚本以替代使用。</li>
<li><a href="../services/ContinuousDelivery/pipeline_deploy_var.html">复查 <span class="keyword">Delivery Pipeline</span> 服务所提供的可用环境变量的列表</a>。</li>
</ul>
</div>
</div><ol class="steps"><li class="step stepexpand"><span class="cmd">在工具链的“概述”页面中，单击 <span class="ph uicontrol"><span class="keyword">Delivery Pipeline</span></span>。</span></li>
<li class="step stepexpand" id="container_single_pipeline_deploy__deploy_stage"><span class="cmd">创建部署阶段。</span> <ol type="a" class="ol substeps"><li class="li substep"><span class="cmd">单击<span class="ph uicontrol">添加阶段</span>。</span></li>
<li class="li substep"><span class="cmd">命名阶段。</span> 例如，<samp class="ph codeph"><var class="keyword varname">Deploy</var></samp>。</li>
<li class="li substep"><span class="cmd">对于“输入类型”，选择<span class="ph uicontrol">构建工件</span>。</span></li>
</ol>
</li>
<li class="step stepexpand" id="container_single_pipeline_deploy__deployment_job"><span class="cmd">在阶段中创建部署作业。</span> <ol type="a" class="ol substeps"><li class="li substep substepexpand"><span class="cmd">在<span class="ph uicontrol">作业</span>选项卡上，单击<span class="ph uicontrol">添加作业</span>。</span></li>
<li class="li substep substepexpand"><span class="cmd">对于“作业类型”，选择<span class="ph uicontrol">部署</span>。</span></li>
<li class="li substep substepexpand"><span class="cmd">对于“部署程序类型”，选择 <span class="ph uicontrol"><span class="keyword">Bluemix</span> 上的 IBM Container Service</span>。</span></li>
<li class="li substep substepexpand"><span class="cmd">针对组织和空间，视需要验证值并更新。</span></li>
<li class="li substep substepexpand"><span class="cmd">在<span class="ph uicontrol">部署策略</span>字段中，输入以下某个值。</span> <ul><li><span class="ph uicontrol">red_black</span> - 部署应用程序的新版本。如果部署成功，将会除去应用程序的先前部署，并会将 IP 地址或路径映射到新版本。</li>
<li><span class="ph uicontrol">clean</span> - 除去应用程序的所有先前部署。</li>
</ul>
 <div class="note tip"><span class="tiptitle">提示：</span> <samp class="ph codeph">CONCURRENT_VERSIONS</samp> 环境属性设置要保持活动的应用程序部署的版本数目。缺省值为 1 个版本。例如，如果 <samp class="ph codeph">CONCURRENT_VERSIONS</samp> 设置为 2 且您正在使用 IP 地址，那么会将最新部署绑定到该 IP
地址，但仍会部署先前版本以将其用作快速备用项。<p>要从<span class="ph uicontrol">环境属性</span>选项卡中永远除去该应用程序的所有部署，可将 <samp class="ph codeph">CONCURRENT_VERSIONS</samp> 设置为 <samp class="ph codeph">0</samp>。</p>
</div>
</li>
<li class="li substep substepexpand"><span class="cmd">在<span class="ph uicontrol">名称</span>字段中，输入要部署的容器的名称。</span></li>
<li class="li substep substepexpand"><span class="cmd">对于“端口”，请输入容器的已发布端口。</span> 使用逗号 (,) 分隔多个端口。<div class="note tip" id="container_single_pipeline_deploy__private_container"><span class="tiptitle">提示：</span> 如果未指定端口且您使用缺省部署脚本，那么会自动发布端口 80。要使用缺省部署脚本使容器为专用容器，请完成以下步骤。
<ol type="i"><li>对于“部署策略”，请输入 <kbd class="ph userinput">simple</kbd>。</li>
<li> 将<span class="ph uicontrol">端口</span>字段保留为空白。</li>
<li>由于简单的部署不会清除之前的部署，因此您可以创建另一个部署阶段以将它们清除。
在第二个部署阶段中，将<span class="ph uicontrol">部署策略</span>设置为 <kbd class="ph userinput">clean</kbd>。</li>
</ol>
</div>
</li>
<li class="li substep substepexpand"><span class="cmd">如果您有任何可选的部署自变量，请进行输入。</span> 例如，如果应用程序需要用于后端数据库位置的环境变量，可包含以下行：

<pre class="codeblock"><code>--env MY_DB_HOSTNAME_PROPERTY=<var class="keyword varname">mydbhostname</var></code></pre>
</li>
</ol>
</li>
<li class="step stepexpand"><span class="cmd">如果您已创建自己的部署脚本，请编辑<span class="ph uicontrol">部署者脚本</span>部分，以对其加以使用。</span> <ol type="a" class="ol substeps"><li class="li substep substepexpand"><span class="cmd">复制以下行，并对其进行更新以使用您的存储库。</span> <pre class="pre screen"><code>git_retry clone https://github.com/Osthanes/deployscripts.git deployscripts</code></pre>
</li>
<li class="li substep substepexpand"><span class="cmd">编辑以下行以使用您的脚本。</span> <pre class="pre screen"><code>/bin/bash deployscripts/deploycontainer.sh</code></pre>
</li>
</ol>
</li>
<li class="step stepexpand"><span class="cmd">单击<span class="ph uicontrol">保存</span>。</span></li>
</ol>
</div>
</article></article><article class="topic task nested2" role="article" aria-labelledby="d58943e2668" lang="zh-cn" id="container_group_pipeline_ov"><h3 class="topictitle3" id="d58943e2668">使用 <span class="keyword">Delivery Pipeline</span> 创建容器组</h3>
<div class="body taskbody"><p class="shortdesc">使用 <span class="keyword">Delivery Pipeline</span> 自动构建和部署容器组。</p>
</div>
<article class="topic task nested3" role="article" aria-labelledby="d58943e2736" lang="zh-cn" id="container_group_pipeline_build"><h4 class="topictitle4" id="d58943e2736">使用 <span class="keyword">Delivery Pipeline</span> 创建容器组的构建阶段</h4>
<div class="body taskbody"><p class="shortdesc"><span class="keyword">IBM
Bluemix Container Service</span> 包含构建服务，此构建服务接收源代码，然后会构建 Docker 映像并将其发布到容器注册表。作为 <span class="keyword">IBM
Bluemix Continuous Delivery</span> 一部分的 <span class="keyword">Delivery Pipeline</span> 提供了使用容器构建服务的构建作业。此构建作业采用存储库中的源代码，通过该代码构建 Docker 映像，对此映像进行版本控制（标记）以匹配构建号，然后将生成的映像推送到组织的 <span class="keyword">Bluemix</span> 上的 <span class="keyword">IBM
Bluemix Container Service</span> 注册表。
之后，组织的成员可将生成的映像部署到组织中的空间。</p>
<div class="section prereq"> <div class="p">开始之前，请考虑以下信息。<ul><li>要了解有关构建、阶段和基本管道功能的更多信息，请参阅 <span class="keyword">Continuous Delivery</span> 文档中的<a href="../services/ContinuousDelivery/pipeline_about.html">关于 <span class="keyword">Delivery Pipeline</span></a> 主题。</li>
<li>通过检查 <span class="keyword">Bluemix</span>“<span class="keyword wintitle">目录</span>”，确定要在容器中使用组织专用映像注册表中的哪个现有映像。</li>
<li>如果您确定需要将服务绑定到容器，请创建应用程序以充当桥梁。有关更多信息，请参阅<a href="container_integrations.html#unique_2124940809" title="服务不能直接绑定到容器。可以改为将服务绑定到应用程序，然后通过在管道阶段配置环境属性来将该应用程序绑定到容器。该应用程序将用作服务和容器之间的桥梁。">使用 <span class="keyword">Delivery Pipeline</span> 将服务绑定到容器</a>。</li>
</ul>
</div>
 </div><p class="li stepsection">在 <span class="keyword">Delivery Pipeline</span> 中构建 Docker 映像。</p><ol class="steps"><li class="step stepexpand"><span class="cmd">在与工具链关联的 Git 存储库的根目录中创建 Dockerfile，然后将其落实到存储库。</span></li>
<li class="step stepexpand"><span class="cmd">在工具链的“概述”页面中，单击 <span class="ph uicontrol"><span class="keyword">Delivery Pipeline</span></span>。</span></li>
<li class="step stepexpand"><span class="cmd">创建构建阶段。</span> <ol type="a" class="ol substeps"><li class="li substep"><span class="cmd">单击<span class="ph uicontrol">添加阶段</span>。</span></li>
<li class="li substep"><span class="cmd">命名阶段。</span> 例如，<samp class="ph codeph"><var class="keyword varname">Build</var></samp>。</li>
<li class="li substep"><span class="cmd">对于<span class="ph uicontrol">输入类型</span>，选择 <span class="ph uicontrol">Git 存储库</span>。</span></li>
<li class="li substep"><span class="cmd">针对其他字段，验证值并根据需要进行更新。</span></li>
<li class="li substep"><span class="cmd">单击<span class="ph uicontrol">作业</span>选项卡。</span></li>
</ol>
</li>
<li class="step stepexpand"><span class="cmd">在构建阶段中，创建构建作业。</span> <ol type="a" class="ol substeps"><li class="li substep substepexpand"><span class="cmd">在<span class="ph uicontrol">作业</span>选项卡中，单击<span class="ph uicontrol">添加作业</span>。</span></li>
<li class="li substep substepexpand"><span class="cmd">选择<span class="ph uicontrol">构建</span>作业类型。</span></li>
<li class="li substep substepexpand"><span class="cmd">对于<span class="ph uicontrol">构建程序类型</span>，选择 <span class="ph uicontrol"><span class="keyword">Bluemix</span> 上的 IBM Containers</span>。</span></li>
<li class="li substep substepexpand"><span class="cmd">根据需要，更新 <span class="keyword">Bluemix</span> 目标、组织和空间。</span></li>
<li class="li substep substepexpand"><span class="cmd">对于<span class="ph uicontrol">使用高速缓存的层</span>，如果必须强制刷新层以从其他源动态拉取内容，请清除此字段。</span> <p>例如，如果 <samp class="ph codeph">Dockerfile</samp> 包含 <samp class="ph codeph">apt-get install</samp> 或 <samp class="ph codeph">wget</samp> 命令，请确保通过清除<span class="ph uicontrol">使用高速缓存的层</span>复选框来为每个构建收集这些动态依赖项。</p>
 <div class="steps note"><span class="notetitle">注：</span> 如果<span class="ph uicontrol">使用高速缓存的层</span>字段已清除，那么由于构建映像时未使用高速缓存的层，因此构建时间会更长。</div>
</li>
<li class="li substep substepexpand"><span class="cmd">在<span class="ph uicontrol">映像名称</span>字段中，输入要构建的映像的名称。为了满足 Docker 命名约定，请只使用小写字母、数字和连字符 (-)。</span> 构建映像时，将使用映像名称和构建号标记该映像。 例如，如果输入映像名称 <samp class="ph codeph">myappimage</samp>，那么针对构建号 4，生成的映像将名为 <samp class="ph codeph">myappimage:4</samp>。</li>
<li class="li substep substepexpand"><span class="cmd">如果在项目的根目录中找不到 Dockerfile，请在“构建脚本”部分的以下各个位置中，添加 Dockerfile 的路径。</span> <ol type="i"><li>请在“运行单元测试”部分的前面用更改目录命令来添加文件夹名称。<div class="p"><pre class="codeblock"><code>cd <var class="keyword varname">&lt;folder&gt;</var></code></pre>
</div>
</li>
<li>在显示 <var class="keyword varname">${WORKSPACE}</var> 变量的所有位置，附加文件夹名称。<var class="keyword varname">${WORKSPACE}</var> 变量会自动为您检测项目的根目录。<div class="p">示例<pre class="codeblock"><code>BUILD_COMMAND="build --pull --tag ${FULL_REPOSITORY_NAME} ${WORKSPACE}/<var class="keyword varname">&lt;folder&gt;</var>"</code></pre>
</div>
</li>
</ol>
</li>
</ol>
</li>
<li class="step stepexpand"><span class="cmd">单击<span class="ph uicontrol">保存</span>。</span></li>
<li class="step stepexpand"><span class="cmd">单击<span class="ph uicontrol">运行阶段</span>图标，以验证该阶段在构建时是否没有任何错误。</span> 如果构建失败，请查看日志并更正错误。如果该阶段成功，请检查组织的映像注册表，并验证映像是否已构建。</li>
</ol>
</div>
</article><article class="topic task nested3" role="article" aria-labelledby="d58943e3043" lang="zh-cn" id="unique_721312450"><h4 class="topictitle4" id="d58943e3043">（可选）在管道执行过程中检查映像安全性</h4>
<div class="body taskbody"><div class="abstract"><span class="shortdesc">在部署容器之前，使用漏洞顾问程序在映像中查找安全性或配置问题。</span>
</div>
<div class="section context"><div class="p">包含此扫描的常见管道设置：<ul><li>用于构建源文件的构建阶段</li>
<li>包含以下作业的处理阶段：<ul><li>用于运行容器构建的构建作业</li>
<li>用于对映像运行漏洞顾问程序的测试作业</li>
</ul>
</li>
<li>用于部署容器的部署阶段</li>
</ul>
</div>

<div class="note tip"><span class="tiptitle">提示：</span> 此任务概述了如何在不同于构建容器映像的作业的阶段中，为漏洞顾问程序创建测试作业。或者，也可以使用构建容器映像的作业所在的阶段。如果决定创建单独的阶段，那么无需设置环境变量。</div>
</div><p class="li stepsection">创建漏洞顾问程序扫描。</p><ol class="steps" id="unique_721312450__steps"><li class="step stepexpand"><span class="cmd">创建处理阶段。</span> <ol type="a" class="ol substeps"><li class="li substep"><span class="cmd">单击<span class="ph uicontrol">添加阶段</span>。</span></li>
<li class="li substep"><span class="cmd">命名阶段。</span> 例如，<samp class="ph codeph"><var class="keyword varname">Processing</var></samp>。</li>
<li class="li substep"><span class="cmd">对于“输入类型”，选择<span class="ph uicontrol">构建工件</span>。</span></li>
<li class="li substep"><span class="cmd">针对阶段和作业，验证值并根据需要进行更新。</span></li>
<li class="li substep"><span class="cmd">单击<span class="ph uicontrol">作业</span>选项卡。</span></li>
</ol>
</li>
<li class="step stepexpand"><span class="cmd">在处理阶段中，添加测试作业以运行代码扫描。</span> <ol type="a" class="ol substeps"><li class="li substep substepexpand"><span class="cmd">在<span class="ph uicontrol">作业</span>选项卡上，单击<span class="ph uicontrol">添加作业</span>。</span></li>
<li class="li substep substepexpand"><span class="cmd">对于作业类型，选择<span class="ph uicontrol">测试</span>。</span></li>
<li class="li substep substepexpand"><span class="cmd">针对<span class="ph uicontrol">测试器类型</span>，选择 <span class="ph uicontrol">IBM 漏洞顾问程序</span>。</span></li>
<li class="li substep substepexpand"><span class="cmd">根据需要，更新 <span class="keyword">Bluemix</span> 目标、组织和空间。</span></li>
<li class="li substep substepexpand"><span class="cmd">针对<span class="ph uicontrol">等待分析完成的时间（分钟）</span>，输入值 0 到 59 分钟。</span> 缺省值为 <var class="keyword varname">5</var> 分钟。作业结束时，控制台日志中会提供仪表板的 URL。<p>如果此时间结束之前扫描未完成，那么作业会失败，但扫描分析会继续运行，且可在仪表板上进行查看。扫描完成后，如果重新运行作业，那么不会重新提交扫描请求，且管道作业可成功完成。或者，可将管道配置为在出现成功扫描结果时不阻止，这会在下一个步骤中进行描述。</p>
</li>
<li class="li substep substepexpand"><span class="cmd">要确定超时行为，请选中或清除<span class="ph uicontrol">此作业失败时停止运行此阶段</span>复选框。</span> <p>您可以将作业配置为在此作业失败时阻止阶段中后续作业以及后续阶段运行，也可以将阶段配置为继续执行而不阻止后续作业和阶段。作业的状态取决于是否存在重大安全问题。</p>


<p>重大安全问题会导致作业失败。根据针对<span class="ph uicontrol">此作业失败时停止运行此阶段</span>所做的选择，失败的作业会阻止阶段和管道继续执行，或者会允许它们继续执行。如果您知道此报告包含许多要处理的问题，那么您可以将阶段配置为继续执行，因为扫描需要很长时间。在此情况下，您可能不希望仅仅因为扫描需要花很长时间而停止剩余的作业和阶段。</p>
</li>
</ol>
</li>
<li class="step stepexpand"><span class="cmd">如果该作业位于与构建作业相同的阶段中，请设置存储库名称的环境变量。</span> <ol type="a" class="ol substeps"><li class="li substep"><span class="cmd">单击<span class="ph uicontrol">环境属性</span>选项卡。</span></li>
<li class="li substep"><span class="cmd">单击<span class="ph uicontrol">添加属性</span>，然后选择<span class="ph uicontrol">文本属性</span>。</span></li>
<li class="li substep"><span class="cmd">在<span class="ph uicontrol">名称</span>字段中，输入 <samp class="ph codeph">FULL_REPOSITORY_NAME</samp>。</span></li>
<li class="li substep"><span class="cmd">在<span class="ph uicontrol">值</span>字段中，不要输入任何内容。</span> 容器构建作业中指定的映像名称会通过此环境变量传递。</li>
</ol>
</li>
<li class="step stepexpand"><span class="cmd">单击<span class="ph uicontrol">保存</span>。</span></li>
<li class="step stepexpand"><span class="cmd">单击<span class="ph uicontrol">运行阶段</span>图标，以验证该阶段在构建时是否没有任何错误。</span></li>
</ol>
<div class="section result"><div class="p">要查看漏洞顾问程序扫描的结果，请在作业完成后，单击<span class="ph uicontrol">查看结果和历史记录</span>。在<span class="ph uicontrol">日志</span>选项卡上，查找以下部分：<pre class="pre msgblock"><code>image registry.<span class="keyword" data-hd-keyref="DomainName">DomainName</span>/<var class="keyword varname">namespace</var>/<var class="keyword varname">image</var> vulnerability results found</code></pre>
</div>

<p>这会列出有漏洞的包、安全问题和建议的改进措施的列表，如“漏洞顾问程序”主题<a href="va/va_index.html#va_reviewing">查看映像报告</a>中所述。<a href="va/va_index.html#va_report">解决映像中的问题</a>中提供了 Dockerfile 代码以用于解决一些常见问题。</p>
</div></div>
</article><article class="topic task nested3" role="article" aria-labelledby="d58943e3323" lang="zh-cn" id="unique_2113181298"><h4 class="topictitle4" id="d58943e3323">（可选）使用 <span class="keyword">Delivery Pipeline</span> 清除映像</h4>
<div class="body taskbody"><p class="shortdesc"><span class="keyword">IBM
Bluemix Container Service</span> 构建作业会自动清除未使用的映像版本。不会除去正在使用的映像。可以指定多个映像版本进行保存，也可以禁用映像清除。</p>
<p class="li stepsection">要更改为项目保留的映像版本数，请执行以下操作：</p><ol class="steps"><li class="step"><span class="cmd">在管道中，打开构建阶段的配置。</span></li>
<li class="step"><span class="cmd">在<span class="ph uicontrol">环境属性</span>选项卡上，单击<span class="ph uicontrol">添加属性</span>。</span></li>
<li class="step"><span class="cmd">选择<span class="ph uicontrol">文本属性</span>。</span></li>
<li class="step"><span class="cmd">在<span class="ph uicontrol">名称</span>字段中，输入 <samp class="ph codeph">IMAGE_LIMIT</samp> 命令。</span></li>
<li class="step"><span class="cmd">在<span class="ph uicontrol">值</span>字段中，输入此项目要在注册表中保留的映像版本数。缺省情况下，将保留项目的最近 5 个映像版本。要禁用映像清除并保留所有映像版本，请将此值设置为 <samp class="ph codeph">-1</samp>。</span></li>
<li class="step"><span class="cmd">单击<span class="ph uicontrol">保存</span>。</span></li>
</ol>
</div>
</article><article class="topic task nested3" role="article" aria-labelledby="d58943e3459" lang="zh-cn" id="unique_2124940809"><h4 class="topictitle4" id="d58943e3459">（可选）使用 <span class="keyword">Delivery Pipeline</span> 将服务绑定到容器</h4>
<div class="body taskbody"><p class="shortdesc">服务不能直接绑定到容器。可以改为将服务绑定到应用程序，然后通过在管道阶段配置环境属性来将该应用程序绑定到容器。该应用程序将用作服务和容器之间的桥梁。</p>
<div class="section prereq"><p id="unique_2124940809__context"><span class="keyword">Bluemix</span> 提供了一组环境变量，用于定义与应用程序绑定的服务的名称和详细信息（例如，ClearDB MySQL Database 或 Question and Answer 服务）。这些环境变量称为 <samp class="ph codeph">VCAP_SERVICES</samp>。将容器绑定到服务时，会通过在容器与服务之间充当桥梁的应用程序将 <samp class="ph codeph">VCAP_SERVICES</samp> 作为环境变量传递到该容器。然后，该容器可以从该服务查找信息，例如端点、用户和密码。</p>

<p>配置环境属性之前，请指定一个已绑定了服务的现有应用程序，或者使用 <span class="keyword">Bluemix</span> GUI 或命令行来创建一个应用程序。有关更多信息，请参阅<a href="container_troubleshoot.html#ts_bridge_app">Bluemix 服务未直接绑定到容器</a>。</p>
</div><p class="li stepsection">将桥接应用程序绑定到容器。</p><ol class="steps"><li class="step"><span class="cmd">在工具链的“概述”页面中，单击 <span class="ph uicontrol"><span class="keyword">Delivery Pipeline</span></span>。</span></li>
<li class="step"><span class="cmd">打开管道阶段，然后单击<span class="ph uicontrol">环境属性</span>选项卡。</span></li>
<li class="step"><span class="cmd">单击<span class="ph uicontrol">添加属性</span>，然后选择<span class="ph uicontrol">文本属性</span>。</span></li>
<li class="step"><span class="cmd">在<span class="ph uicontrol">名称</span>字段中，输入命令 <kbd class="ph userinput">BIND_TO</kbd>。</span></li>
<li class="step"><span class="cmd">在<span class="ph uicontrol">值</span>字段中，输入桥接应用程序的名称，例如 <var class="keyword varname">pipeline_bridge_app</var>。</span></li>
<li class="step"><span class="cmd">单击<span class="ph uicontrol">保存</span>。</span></li>
<li class="step"><span class="cmd">通过运行管道测试配置。</span></li>
</ol>
<div class="section postreq"><div class="note tip"><span class="tiptitle">提示：</span> 将桥接应用程序绑定到容器后，请不要删除该桥接应用程序。如果删除绑定的桥接应用程序，那么容器会暂挂。请先删除容器以及正在使用桥接应用程序的任何其他容器，再删除该桥接应用程序。</div>
</div></div>
</article><article class="topic task nested3" role="article" aria-labelledby="d58943e3620" lang="zh-cn" id="container_group_pipeline_deploy"><h4 class="topictitle4" id="d58943e3620">使用 <span class="keyword">Delivery Pipeline</span> 创建容器组的部署阶段</h4>
<div class="body taskbody"><p class="shortdesc">您可以使用 <span class="keyword">Delivery Pipeline</span> 为容器组创建部署阶段。</p>
<div class="section prereq"><div class="p">开始之前：<ul><li><a href="container_integrations.html#container_group_pipeline_build" title="IBM Bluemix Container Service 包含构建服务，此构建服务接收源代码，然后会构建 Docker 映像并将其发布到容器注册表。作为 IBM Bluemix Continuous Delivery 一部分的 Delivery Pipeline 提供了使用容器构建服务的构建作业。此构建作业采用存储库中的源代码，通过该代码构建 Docker 映像，对此映像进行版本控制（标记）以匹配构建号，然后将生成的映像推送到组织的 Bluemix 上的 IBM Bluemix Container Service 注册表。 之后，组织的成员可将生成的映像部署到组织中的空间。">创建构建阶段</a>。</li>
<li><a href="https://github.com/Osthanes/deployscripts/blob/master/deploygroup.sh" rel="external" target="_blank" title="（在新的选项卡或窗口中打开）">复查容器组的缺省部署脚本</a>。您可以派生缺省脚本并对其进行编辑，或者创建自己的脚本以替代使用。</li>
<li><a href="../services/ContinuousDelivery/pipeline_deploy_var.html">复查 <span class="keyword">Delivery Pipeline</span> 服务所提供的可用环境变量的列表</a>。</li>
</ul>
</div>
</div><ol class="steps"><li class="step stepexpand"><span class="cmd">创建部署阶段。</span> <ol type="a" class="ol substeps"><li class="li substep"><span class="cmd">单击<span class="ph uicontrol">添加阶段</span>。</span></li>
<li class="li substep"><span class="cmd">命名阶段。</span> 例如，<samp class="ph codeph"><var class="keyword varname">Deploy</var></samp>。</li>
<li class="li substep"><span class="cmd">对于“输入类型”，选择<span class="ph uicontrol">构建工件</span>。</span></li>
</ol>
</li>
<li class="step stepexpand"><span class="cmd">在阶段中创建部署作业。</span> <ol type="a" class="ol substeps"><li class="li substep substepexpand"><span class="cmd">在<span class="ph uicontrol">作业</span>选项卡上，单击<span class="ph uicontrol">添加作业</span>。</span></li>
<li class="li substep substepexpand"><span class="cmd">对于“作业类型”，选择<span class="ph uicontrol">部署</span>。</span></li>
<li class="li substep substepexpand"><span class="cmd">对于“部署程序类型”，选择 <span class="ph uicontrol"><span class="keyword">Bluemix</span> 上的 IBM Container Service</span>。</span></li>
<li class="li substep substepexpand"><span class="cmd">选择组织和空间。</span></li>
<li class="li substep substepexpand"><span class="cmd">对于“部署策略”，请输入以下某个值。</span> <ul><li><span class="ph uicontrol">red_black</span> - 部署应用程序的新版本。如果部署成功，将会除去应用程序的先前部署，并会将 IP 地址或路径映射到新版本。</li>
<li><span class="ph uicontrol">clean</span> - 除去应用程序的所有先前部署。</li>
</ul>
</li>
<li class="li substep substepexpand"><span class="cmd">对于“名称”，请输入要部署的容器的名称。</span></li>
<li class="li substep substepexpand"><span class="cmd">对于“端口”，请输入容器的已发布端口。</span> 对于容器组，您仅可以指定一个端口。<div class="note tip"><span class="tiptitle">提示：</span> 如果未指定端口且您使用缺省部署脚本，那么会自动发布端口 80。要使用缺省部署脚本使容器为专用容器，请完成以下步骤。
<ol type="i"><li>对于“部署策略”，请输入 <kbd class="ph userinput">simple</kbd>。</li>
<li> 将<span class="ph uicontrol">端口</span>字段保留为空白。</li>
<li>由于简单的部署不会清除之前的部署，因此您可以创建另一个部署阶段以将它们清除。
在第二个部署阶段中，将<span class="ph uicontrol">部署策略</span>设置为 <kbd class="ph userinput">clean</kbd>。</li>
</ol>
</div>
</li>
<li class="li substep substepexpand"><span class="cmd">如果您有任何可选的部署自变量，请进行输入。</span> 例如，如果应用程序需要用于后端数据库位置的环境变量，可包含以下行：

<pre class="codeblock"><code>--env MY_DB_HOSTNAME_PROPERTY=<var class="keyword varname">mydbhostname</var></code></pre>
</li>
</ol>
</li>
<li class="step stepexpand"><span class="cmd">设置容器组部署而非单个容器部署。在“部署者脚本”部分中，除去 # 以取消注释容器组脚本：</span> <pre class="pre screen"><code>/bin/bash deployscripts/deploygroup.sh</code></pre>
添加 # 以注释掉单个容器脚本：
<pre class="pre screen"><code>#/bin/bash deployscripts/deploycontainer.sh</code></pre>
</li>
<li class="step stepexpand"><span class="cmd">如果您已创建自己的部署脚本，请编辑<span class="ph uicontrol">部署者脚本</span>部分，以对其加以使用。</span> <ol type="a" class="ol substeps"><li class="li substep substepexpand"><span class="cmd">复制以下行，并对其进行更新以使用您的存储库。</span> <pre class="pre screen"><code>git_retry clone https://github.com/Osthanes/deployscripts.git deployscripts</code></pre>
</li>
<li class="li substep substepexpand"><span class="cmd">编辑以下行以使用您的脚本。</span> <pre class="pre screen"><code>/bin/bash deployscripts/deploygroup.sh</code></pre>
</li>
</ol>
</li>
<li class="step stepexpand">可选： <span class="cmd">要配置基本容器组，请设置表中的每个环境变量。</span> 使用这些属性，您可以通过命令行或 <span class="keyword">Bluemix</span> 用户界面，设置部署容器时可能设置的一些选项。对于其他属性，请参阅用户界面的“部署者脚本”部分中的注释。<ol type="a" class="ol substeps"><li class="li substep substepexpand"><span class="cmd">单击<span class="ph uicontrol">环境属性</span>选项卡，然后单击<span class="ph uicontrol">添加属性</span>。</span></li>
<li class="li substep substepexpand"><span class="cmd">选择<span class="ph uicontrol">文本属性</span>。</span></li>
<li class="li substep substepexpand"><span class="cmd">输入环境属性的名称和值。</span> <div class="tablenoborder"><table summary="" id="container_group_pipeline_deploy__common_properties" class="defaultstyle"><thead><tr><th id="d58943e3912" class="thleft">属性</th>
<th id="d58943e3914" class="thleft">描述</th>
</tr>
</thead>
<tbody><tr><td headers="d58943e3912 "><span class="ph uicontrol">AUTO_RECOVERY</span></td>
<td headers="d58943e3914 "><kbd class="ph userinput">true</kbd> 或 <kbd class="ph userinput">false</kbd><p><span class="ph">针对容器组启用了自动恢复并且该组已运行了 10 分钟时，该组的负载均衡器会开始通过 HTTP 请求定期检查组中每个容器实例的运行状况。如果容器实例在 100 秒内未响应，即会将该实例标记为“不活动”。自动恢复会从组中除去不活动的容器实例并重新创建这些实例。自动恢复会尝试恢复组中的容器实例 3 次。在第三次尝试后，自动恢复在 60 分钟内不会再恢复组中的任何容器实例。60 分钟后，自动恢复进程将再次启动。</span></p>
</td>
</tr>
<tr><td headers="d58943e3912 "><span class="ph uicontrol">CONCURRENT_VERSIONS</span></td>
<td headers="d58943e3914 ">数字<p><samp class="ph systemoutput">CONCURRENT_VERSIONS</samp> 环境属性设置要保持活动的应用程序部署的版本数目。缺省值为 1 个版本。例如，如果
<samp class="ph systemoutput">CONCURRENT_VERSIONS</samp> 设置为 2 且您正在部署容器组，那么会将两个组映射到路径并接收流量。</p>

<p>要始终除去该应用程序的所有部署，可在“环境属性”选项卡中将 <samp class="ph systemoutput">CONCURRENT_VERSIONS</samp> 设置为 <samp class="ph systemoutput">0</samp>。</p>
</td>
</tr>
<tr><td headers="d58943e3912 "><span class="ph uicontrol">DESIRED_INSTANCES</span></td>
<td headers="d58943e3914 ">数字<p>示例：<samp class="ph codeph">4</samp></p>
<span class="ph">应用程序所需的容器组实例数取决于期望的工作负载和应用程序可以处理请求的时间。
例如，多任务或网络连接会影响应用程序所需的实例数。</span><p><span class="ph">要使容器组具有高可用性且对故障的处理更富弹性，请考虑除最低要求的实例数外，额外包含更多实例，以用于处理预期的工作负载。额外的实例可在其他实例崩溃时处理工作负载。要确保自动恢复发生故障的实例，而不影响工作负载，请包含一个额外实例。要避免两个实例同时发生故障，请包含两个额外实例。此设置是 <var class="keyword varname">N+2</var> 模式，其中 <var class="keyword varname">N</var> 是处理请求的实例数，<var class="keyword varname">+2</var> 是额外两个实例。</span></p>
</td>
</tr>
<tr><td headers="d58943e3912 "><span class="ph uicontrol">ROUTE_DOMAIN</span></td>
<td headers="d58943e3914 ">字符串或 <samp class="ph codeph">none</samp><p>示例：<samp class="ph codeph">mycustomdomain.com</samp></p>
<p>缺省系统域为 <samp class="ph codeph"><span class="keyword" data-hd-keyref="APPDomain">AppDomainName</span></samp>，此域已提供 SSL 证书，所以可以使用 HTTPS 来访问容器组，而无需任何额外配置。要使用定制域，必须在公共 DNS 服务器上注册定制域，在 <span class="keyword">Bluemix</span> 中配置定制域，然后将定制域映射到公共 DNS 服务器上的 <span class="keyword">Bluemix</span> 系统域。</p>
<p>如果未指定域，那么会使用 <samp class="ph codeph"><span class="keyword" data-hd-keyref="APPDomain">AppDomainName</span></samp>。如果指定 <samp class="ph codeph">none</samp>，那么不会创建域。</p>
<p>如果针对主机名和域指定 <samp class="ph codeph">none</samp>，那么组可由相同空间中的其他容器进行访问，但不是公开可访问。</p>
</td>
</tr>
<tr><td headers="d58943e3912 "><span class="ph uicontrol">ROUTE_HOSTNAME</span></td>
<td headers="d58943e3914 ">字符串或 <samp class="ph codeph">none</samp><p>示例：<samp class="ph codeph">myapp</samp></p>
<p>主机名，如 <var class="keyword varname">mycontainerhost</var>。不要在主机名中包含下划线 (_)。主机和域组合在一起构成了完整的公共路径 URL，例如 <samp class="ph codeph">http://mycontainerhost.<span class="keyword" data-hd-keyref="APPDomain">AppDomainName</span></samp>。</p>
<p>如果未指定主机名，那么会为您创建一个主机名。
如果指定 <samp class="ph codeph">none</samp>，那么不会创建主机名。</p>
<p>如果针对主机名和域指定 <samp class="ph codeph">none</samp>，那么组可由相同空间中的其他容器进行访问，但不是公开可访问。</p>
</td>
</tr>
</tbody>
</table>
</div>
</li>
</ol>
</li>
<li class="step stepexpand"><span class="cmd">单击<span class="ph uicontrol">保存</span>。</span></li>
</ol>
</div>
</article></article></article><article class="topic tutorial tutorialIntro nested1" role="article" aria-labelledby="d58943e4055" lang="zh-cn" id="container_cfapp_tutorial_intro"><h2 class="topictitle2" id="d58943e4055">教程：在容器中部署 Cloud Foundry Node.js 应用程序</h2>
<div class="body  tutorialIntroBody"><p class="shortdesc">您可以采用先前通过 Cloud Foundry 部署的应用程序，并使用 <span class="keyword">IBM
Bluemix Container Service</span> 将其部署在容器中。</p>
<div class="section tutorialDesc longDesc"></div><section class="section learningObjectives tutorialLearningObjectives" role="region" aria-labelledby="d58943e4105"><h3 class="sectiontitle" id="d58943e4105">目标</h3>
<ul><li>了解部署容器的一般过程</li>
<li>了解 Dockerfile 中必须包含哪些内容才能构建映像</li>
</ul>
</section>
<section class="section timeRequired tutorialTimeRequired" role="region" aria-labelledby="d58943e4114"><h3 class="sectiontitle" id="d58943e4114">所需时间</h3>30 分钟</section>
<section role="region" aria-labelledby="d58943e4118" class="section section audienceDesc"><h3 class="sectiontitle" id="d58943e4118">受众</h3>Cloud Foundry 应用程序开发者</section><section role="region" aria-labelledby="d58943e4122" class="section section prerequisites"><h3 class="sectiontitle" id="d58943e4122">先决条件</h3>
<ul><li><a href="container_cli_cfic_install.html#container_cli_cfic_install" title="安装 IBM Bluemix Container Service 插件 (bx ic)，以运行本机 Docker CLI 命令来管理容器。">安装 <span class="keyword">IBM
Bluemix Container Service</span> CLI</a></li>
<li><a href="container_cli_cfic_install.html#container_cli_login" title="安装 CLI 后，需要登录才能使用。">登录到 <span class="keyword">IBM
Bluemix Container Service</span> CLI</a></li>
</ul>
</section></div>
<article class="topic task tutorialLesson nested2" role="article" aria-labelledby="d58943e4165" lang="zh-cn" id="container_cfapp_tutorial_lesson1"><h3 class="topictitle3" id="d58943e4165">第 1 课：下载 Cloud Foundry Node.js 应用程序代码</h3>
<div class="body taskbody"><p class="shortdesc">获取可随时使用的 Node.js 代码。还没有任何代码吗？您可以从 <span class="keyword">Bluemix</span> 下载要在本教程中使用的入门模板代码。</p>
<div class="section prereq">开始之前，请<a href="container_cli_cfic_install.html#container_cli_cfic_install" title="安装 IBM Bluemix Container Service 插件 (bx ic)，以运行本机 Docker CLI 命令来管理容器。">安装 <span class="keyword">IBM
Bluemix Container Service</span> CLI</a> 并<a href="container_cli_cfic_install.html#container_cli_login" title="安装 CLI 后，需要登录才能使用。">登录</a>。</div><p class="li stepsection">要获取并组织应用程序代码，请执行以下操作：</p><ol class="steps"><li class="step stepexpand"><span class="cmd">创建名为 <kbd class="ph userinput"><var class="keyword varname">cf-pi-myinitials</var></kbd> 的目录并浏览到该目录。</span> 在此目录中，您将保存构建 Docker 映像以及运行 Node.js 应用程序所需的所有文件。可以将任何名称用于该目录。如果使用示例中的名称，请将 <var class="keyword varname">myinitials</var> 替换为您的姓名首字母缩写，例如 <var class="keyword varname">cf-pi-ms</var>。
<pre class="codeblock"><code>mkdir <var class="keyword varname">cf-pi-myinitials</var> &amp;&amp; cd <var class="keyword varname">cf-pi-myinitials</var></code></pre>
</li>
<li class="step stepexpand"><span class="cmd">将 Node.js 应用程序代码以及所有相关文件复制到该目录中。</span> 您可以使用自己的 Node.js 应用程序代码，也可以从 <span class="keyword">Bluemix</span> 下载 Personal Insights 应用程序。
<p>要从 <span class="keyword">Bluemix</span> 下载 Personal Insights 应用程序代码，请执行以下步骤。</p>
<ol type="a" class="ol substeps"><li class="li substep substepexpand"><span class="cmd">在 <span class="keyword">Bluemix</span>“<span class="keyword wintitle">目录</span>”的<span class="ph uicontrol">样板</span>中，单击 <span class="ph uicontrol">Personality Insights Node.js Web Starter</span>。</span> 此样板包含 Node.js 应用程序，该应用程序使用 <span class="keyword">IBM Watson™ Personality Insights</span> 服务从个人通过博客、推特或论坛帖子生成的文本中抽取各种认知和社交特征。</li>
<li class="li substep substepexpand"><span class="cmd">输入应用程序名称 <kbd class="ph userinput"><var class="keyword varname">cf-pi-myinitials</var></kbd>，然后单击<span class="ph uicontrol">创建</span>。</span> 要访问样板的应用程序代码，必须首先将 CF 应用程序部署到 <span class="keyword">Bluemix</span>。可以将任何名称用于该应用程序。如果使用示例中的名称，请将 <var class="keyword varname">myinitials</var> 替换为您的姓名首字母缩写（例如 <var class="keyword varname">cf-pi-ms</var>），以确保该名称唯一。
<p>此部署将创建名为 <var class="keyword varname">cf-pi-myinitials</var> 的应用程序，以及名为 <var class="keyword varname">cf-pi-myinitials-personality_insights</var> 的 <span class="keyword">IBM
Watson Personality Insights</span> 服务实例。</p>

<p>部署应用程序后，将显示<strong>使用命令行界面部署应用程序</strong>的指示信息。</p>
</li>
<li class="li substep substepexpand"><span class="cmd">在步骤 1 中，单击<span class="ph uicontrol">下载入门模板代码</span>。</span></li>
<li class="li substep substepexpand"><span class="cmd">解压缩 .zip 文件，并将应用程序文件保存到您的目录。</span></li>
</ol>
</li>
</ol>
<div class="section result">现在您的 Cloud Foundry 应用程序代码可随时部署到容器中！</div></div>
</article><article class="topic task tutorialLesson nested2" role="article" aria-labelledby="d58943e4362" lang="zh-cn" id="container_cfapp_tutorial_lesson2"><h3 class="topictitle3" id="d58943e4362">第 2 课：使用 CF 应用程序代码创建 Docker 映像</h3>
<div class="body taskbody"><p class="shortdesc">创建 Dockerfile 以包含 Node.js 应用程序代码以及容器的必要配置。然后，通过该 Dockerfile 构建 Docker 映像，并将其推送到专用 <span class="keyword">Bluemix</span> 注册表。</p>
<p class="li stepsection">要使用应用程序代码创建 Docker 映像，请执行以下步骤。</p><ol class="steps"><li class="step stepexpand"><span class="cmd">创建 <span class="ph filepath">Dockerfile</span>，此文件是创建容器的基础。</span> 您可使用您的首选 CLI 编辑器或计算机上的文本编辑器来创建 Dockerfile。以下示例显示了如何使用 <a href="https://www.nano-editor.org/dist/v2.2/nano.html" rel="external" target="_blank" title="（在新的选项卡或窗口中打开）">nano 编辑器</a>来创建 Dockerfile 文件。<pre class="codeblock"><code>nano Dockerfile</code></pre>
</li>
<li class="step stepexpand"><span class="cmd">将以下脚本复制到 Dockerfile 中。</span> <pre class="codeblock"><code>#Use the IBM Node image as a base image
FROM registry.<span class="keyword" data-hd-keyref="DomainName">DomainName</span>/ibmnode:latest

#Expose the port for your Personal Insights app, and set 
#it as an environment variable as expected by cf apps
ENV PORT=3000
EXPOSE 3000
ENV NODE_ENV production

#Copy all app files from the current directory into the app 
#directory in your container. Set the app directory
#as the working directory
ADD . /app
WORKDIR /app

#Install any necessary requirements from package.json
RUN npm install

#Sleep before the app starts. This command ensures that the
#IBM Containers networking is finished before the app starts. 
CMD (sleep 60; npm start)
#Start the Personal Insight app. 
CMD ["node", "/app/app.js"]</code></pre>
</li>
<li class="step stepexpand"><span class="cmd">按 <span class="ph uicontrol">ctrl + o</span> 保存更改。按 <span class="ph uicontrol">ENTER</span> 键确认更改。按 <span class="ph uicontrol">ctrl + x</span> 退出 nano 编辑器。</span></li>
<li class="step stepexpand"><span class="cmd">使用应用程序代码构建 Docker 映像，并将其推送到专用 <span class="keyword">Bluemix</span> 注册表。</span> <pre class="codeblock"><code><span class="ph"><samp class="ph codeph">bx ic</samp></span> build -t registry.<span class="keyword" data-hd-keyref="DomainName">DomainName</span>/<var class="keyword varname">namespace</var>/<var class="keyword varname">cf-pi-myinitials</var></code></pre>


<div class="tablenoborder"><table summary="" id="container_cfapp_tutorial_lesson2__table_build" class="defaultstyle"><thead><tr><th colspan="2" id="d58943e4471" class="thleft"><span class="ph"><img src="images/idea.png" alt="此图标指示这个任务步骤有要了解的更多信息。"></span> 了解此命令的组成部分</th>
</tr>
</thead>
<tbody><tr><td style="width: 50%" headers="d58943e4471 "><samp class="ph codeph">build</samp></td>
<td style="width: 50%" headers="d58943e4471 "><samp class="ph codeph">build</samp> 命令。</td>
</tr>
<tr><td style="width: 50%" headers="d58943e4471 "><samp class="ph codeph">registry.<span class="keyword" data-hd-keyref="DomainName">DomainName</span>/<var class="keyword varname">namespace</var>/<var class="keyword varname">cf-pi-myinitials</var></samp></td>
<td style="width: 50%" headers="d58943e4471 ">专用 <span class="keyword">Bluemix</span> 注册表路径，其中包含唯一名称空间以及映像的名称。对于本示例，用于映像的名称与 CF 节点应用程序 <var class="keyword varname">mongo</var> 的名称相同，但您可以为专用注册表中的映像选择任何名称。如果不确定哪个是您的名称空间，请运行以下命令进行查找。<pre class="codeblock"><code><span class="ph"><samp class="ph codeph">bx ic</samp></span> namespace-get</code></pre>
</td>
</tr>
<tr><td style="width: 50%" headers="d58943e4471 "><samp class="ph codeph">.</samp></td>
<td style="width: 50%" headers="d58943e4471 ">Dockerfile 的位置。如果要从包含 Dockerfile 的目录运行 build 命令，请输入句点 (.). 否则，请使用 Dockerfile 的相对路径。</td>
</tr>
</tbody>
</table>
</div>
</li>
</ol>
<div class="section result">映像已在注册表中创建。您可以运行 <samp class="ph codeph"><span class="ph"><samp class="ph codeph">bx ic</samp></span> images</samp> 命令来验证是否已创建映像。<pre class="pre screen"><code>$ <span class="ph"><samp class="ph codeph">bx ic</samp></span> images
REPOSITORY                                                  TAG                 IMAGE ID            CREATED             SIZE
registry.<span class="keyword" data-hd-keyref="DomainName">DomainName</span>/<var class="keyword varname">namespace</var>/<var class="keyword varname">cf-pi-myinitials</var>  latest  b02b7a24c35f  48 seconds ago  251.3 MB</code></pre>
</div></div>
</article><article class="topic task tutorialLesson nested2" role="article" aria-labelledby="d58943e4540" lang="zh-cn" id="container_cfapp_tutorial_lesson3"><h3 class="topictitle3" id="d58943e4540">第 3 课：基于映像部署容器</h3>
<div class="body taskbody"><p class="shortdesc">在 <span class="keyword">Bluemix</span> 中，将应用程序部署为容器组。</p>
<p class="li stepsection">要在容器组中部署应用程序，请执行以下步骤。</p><ol class="steps"><li class="step stepexpand"><span class="cmd"> 通过运行以下命令，基于上一课中创建的映像来创建容器组。</span>  <pre class="codeblock"><code><span class="ph"><samp class="ph codeph">bx ic</samp></span> group-create --name <var class="keyword varname">cf-pi-myinitials</var> -m 64 -n <var class="keyword varname">pi-app-myinitials</var> -d <span class="keyword" data-hd-keyref="APPDomain">AppDomainName</span> -p 3000 -e CCS_BIND_SRV=<var class="keyword varname">cf-pi-myinitials-personal_insights</var> --desired 3 --auto --anti registry.<span class="keyword" data-hd-keyref="DomainName">DomainName</span>/<var class="keyword varname">namespace</var>/<var class="keyword varname">cf-pi-myinitials</var>:latest</code></pre>


<div class="p"><div class="tablenoborder"><table summary="" id="container_cfapp_tutorial_lesson3__table_group_create" class="defaultstyle"><thead><tr><th colspan="2" id="d58943e4627" class="thleft"><span class="ph"><img src="images/idea.png" alt="此图标指示这个任务步骤有要了解的更多信息。"></span> 了解此命令的组成部分</th>
</tr>
</thead>
<tbody><tr><td style="width: 50%" headers="d58943e4627 "><samp class="ph codeph">group-create</samp></td>
<td style="width: 50%" headers="d58943e4627 "><samp class="ph codeph">group-create</samp> 命令。</td>
</tr>
<tr><td style="width: 50%" headers="d58943e4627 "><samp class="ph codeph">--name <var class="keyword varname">cf-pi-myinitials</var></samp></td>
<td style="width: 50%" headers="d58943e4627 ">您希望在 <span class="keyword">Bluemix</span> GUI 中显示的容器名称。</td>
</tr>
<tr><td style="width: 50%" headers="d58943e4627 "><samp class="ph codeph">-m 64</samp></td>
<td style="width: 50%" headers="d58943e4627 ">组中每个实例都分配有 64 MB 内存。</td>
</tr>
<tr><td style="width: 50%" headers="d58943e4627 "><samp class="ph codeph">-n <var class="keyword varname">pi-app-myinitials</var></samp></td>
<td style="width: 50%" headers="d58943e4627 ">路径 URL 中的主机名。<div class="note tip"><span class="tiptitle">提示：</span> 如果要使用入门模板代码，请使用与上一课中用于部署 Cloud Foundry 应用程序的主机名不同的名称。如果使用相同的主机，并且 CF 应用程序仍在运行，那么容器组和应用程序之间会发生负载均衡。</div>
</td>
</tr>
<tr><td style="width: 50%" headers="d58943e4627 "><samp class="ph codeph">-d <span class="keyword" data-hd-keyref="APPDomain">AppDomainName</span></samp></td>
<td style="width: 50%" headers="d58943e4627 ">路径 URL 中的域名。除非您有定制域，否则请使用 <span class="keyword" data-hd-keyref="APPDomain">AppDomainName</span>。</td>
</tr>
<tr><td style="width: 50%" headers="d58943e4627 "><samp class="ph codeph">-p 3000</samp></td>
<td style="width: 50%" headers="d58943e4627 ">要公开的端口号。与路径 URL 的连接会转发到容器上的端口 3000。</td>
</tr>
<tr><td style="width: 50%" headers="d58943e4627 "><samp class="ph codeph">-e CCS_BIND_SRV=<var class="keyword varname">cf-pi-myinitials-personal_insights</var></samp></td>
<td style="width: 50%" headers="d58943e4627 ">将 <span class="keyword">IBM
Watson Personality Insights</span> 服务实例绑定到容器，以便可以通过在 Personal Insights 应用程序中输入的文本来分析认知和社交特征。服务实例已在第 1 课部署 CF 应用程序的过程中进行创建。<div class="p">如果不确定您的服务实例的名称，请运行以下命令。<pre class="codeblock"><code>bx service list</code></pre>
</div>
</td>
</tr>
<tr><td style="width: 50%" headers="d58943e4627 "><samp class="ph codeph">--desired 3</samp></td>
<td style="width: 50%" headers="d58943e4627 ">要在容器组中创建的单独容器实例的数量。所有实例都相同。</td>
</tr>
<tr><td style="width: 50%" headers="d58943e4627 "><samp class="ph codeph">--auto</samp></td>
<td style="width: 50%" headers="d58943e4627 ">对容器组启用自动恢复。如果组中某个实例变得不可用，将自动创建另一个实例来替换无响应的实例。</td>
</tr>
<tr><td style="width: 50%" headers="d58943e4627 "><samp class="ph codeph">--anti</samp></td>
<td style="width: 50%" headers="d58943e4627 ">对容器组启用反亲缘关系。组中的每一个实例会置于不同的物理计算节点上，这可降低组中所有容器因硬件故障而发生崩溃的几率。</td>
</tr>
<tr><td style="width: 50%" headers="d58943e4627 "><samp class="ph codeph">registry.<span class="keyword" data-hd-keyref="DomainName">DomainName</span>/<var class="keyword varname">namespace</var>/<var class="keyword varname">cf-pi-myinitials</var>:latest</samp></td>
<td style="width: 50%" headers="d58943e4627 ">目标存储库路径，其中包含唯一名称空间以及目标映像的名称。对于本示例，用于映像的名称与 CF 节点应用程序 <var class="keyword varname">cf-pi-myinitials</var> 相同。</td>
</tr>
</tbody>
</table>
</div>
</div>
</li>
<li class="step stepexpand"><span class="cmd">请等待数分钟，以便容器完成部署并设置联网。部署容器后，可以在浏览器中通过输入以下 URL 来查看 Personal Insights 应用程序：<span class="ph filepath">http://<var class="keyword varname">pi-app-myinitials</var>.<span class="keyword" data-hd-keyref="APPDomain">AppDomainName</span>/</span>。</span></li>
<li class="step stepexpand"><span class="cmd">除去 CF 应用程序。</span> 现在，CF 应用程序代码已部署在容器中，您可以除去 CF 应用程序以最充分地利用配额。
<pre class="codeblock"><code>cf delete <var class="keyword varname">cf-pi-myinitials</var></code></pre>
通过输入 <span class="ph uicontrol">y</span> 以确认删除。</li>
</ol>
<div class="section result">您的应用程序已部署在容器中！</div></div>
</article></article></article></div></main></body></html>