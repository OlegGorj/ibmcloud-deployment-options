<!DOCTYPE html><html lang="zh-tw">
<head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="UTF-8">
<meta name="dcterms.date" content="2017-11-10">
<meta name="dcterms.rights" content="© Copyright IBM Corp. 2014, 2017">

<meta name="description" content="在開發應用程式或服務時，或針對不需要高可用性的短期程序，都可以使用單一容器來執行簡單測試。若要使用自己的網路前端，您可以將公用 IP 位址指派給容器。">
<meta name="keywords" content="單一容器, 儀表板, GUI, IBM Containers, 容器, CLI, docker run, bx ic, run, 更新, 指令行, 鏈結, --link, IP 位址, 公用, ip-bind, ip-request, ips, ip-unbind, 移除, 釋放, docker rm, rm, 指導教學, 開始使用, cli, 安裝, 外掛程式, 映像檔, 部署, docker compose, 多容器部署, 多容器應用程式, docker-compose.yml, 擴充, 負載平衡器, nginx, 工作負載, yml, 支援的選項, FAQ">
<meta name="geo.country" content="ZZ">
<script>
    digitalData = {
      page: {
        pageInfo: {
  language: "zh-tw",

  version: "v18",
  ibm: {
  country: "ZZ",
  type: "CT701"
  
         }
       }
     }
   };
  </script><link rel="stylesheet" type="text/css" href="./ibmdita.css">
<title>在 IBM Bluemix Container Service 中，將短期作業當作單一容器來執行</title>
</head>
<body><main role="main"><div><article class="nested0" role="article" aria-labelledby="d75631e6" id="container_single_ui"><h1 class="topictitle1" id="d75631e6">將短期作業當作單一容器來執行</h1>
<div class="abstract"><div class="shortdesc"><span class="ph">在開發應用程式或服務時，或針對不需要高可用性的短期程序，都可以使用單一容器來執行簡單測試。若要使用自己的網路前端，您可以將公用 IP 位址指派給容器。</span></div>


<div class="p"><div class="note attention"><span class="attentiontitle">小心：</span> 不提供<span class="ph"><span class="ph">單一及可擴充容器</span>的免費試用。<a href="cs_ov.html" title="IBM Bluemix Container Service 會結合 Docker 與 Kubernetes 來提供功能強大的工具、直覺式使用者體驗和內建安全和隔離，以使用 Kubernetes API，透過獨立運算主機叢集來自動進行容器化應用程式的部署、作業、擴充及監視。">瞭解在「<span class="keyword">Bluemix®</span> 公用」上，如何在 <span class="keyword">IBM®
Bluemix Container Service</span> 中進行叢集管理並移轉至 Kubernetes。</a></span></div>
</div>


<div class="p">在此頁面中：<div class="lines">&nbsp;&nbsp;&nbsp;&nbsp; • 從 <a href="container_single_ui.html#gui" title="從 Bluemix GUI 中建立及部署容器。">GUI</a> 或 <a href="container_single_ui.html#container_single_cli" title="使用 run 指令來建立容器。容器必須內含映像檔。如果還沒有映像檔，您可以使用組織專用映像檔登錄中預設提供的其中一個預設 IBM 認證映像檔。">CLI</a> 將短期作業當作單一容器來執行<br>
&nbsp;&nbsp;&nbsp;&nbsp; • <a href="container_single_ui.html#container_single_updating" title="若要更新應用程式，您必須部署新的容器。如果您推送新的映像檔，則不會自動重新啟動容器。">更新容器</a><br>
&nbsp;&nbsp;&nbsp;&nbsp; • <a href="container_single_ui.html#container_linking" title="將某個容器鏈結至相同空間中的另一個容器時，IBM Bluemix Container Service 會在來源容器的收件者容器上建立一個主機項目。您可以使用別名來參照來源容器，而不使用可能經常變更的特定 IP 位址。">鏈結容器</a><br>
&nbsp;&nbsp;&nbsp;&nbsp; • <a href="container_single_ui.html#container_cli_ips" title="在 Bluemix 中，要求公用 IP 位址，並將其連結至容器。">要求及連結 IP 位址</a><br>
&nbsp;&nbsp;&nbsp;&nbsp; • <a href="container_single_ui.html#container_single_remove" title="若要充分利用您的配額，請偶而移除未使用的容器。">移除單一容器</a><br>
&nbsp;&nbsp;&nbsp;&nbsp; • 指導教學：<a href="container_single_ui.html#container_gettingstarted_tutorial" title="IBM Bluemix 可讓您在公用雲端中執行 Docker 容器。使用容器來部署自給自足的安全 Web 應用程式，這些 Web 應用程式可獨立於主機作業系統而執行。容器是輕量型，而且不需要大量系統資源，因為容器使用相同的系統核心，因此執行效率高於虛擬機器。本指導教學示範如何在 Bluemix 中使用 Docker 容器來建置傳訊 Web 應用程式。 在此程序中，您將撰寫 Dockerfile、將 Docker 映像檔新增至專用 Bluemix 映像檔登錄，以及將容器鏈結在一起。">建立單一容器 Web 應用程式</a><br>
&nbsp;&nbsp;&nbsp;&nbsp; • 指導教學：<a href="container_single_ui.html#container_compose_intro" title="如果您的應用程式有多個元件（例如資料庫、服務及快取），要將所有容器編排為一起啟動和關閉，可能會是一件很困難的事情。在本指導教學中，您將瞭解如何使用單一 Docker Compose 指令，在微服務架構中將應用程式部署及執行為多容器部署。每一個屬於此系統的容器都是根據 Docker Compose 服務定義，並在自己的隔離環境中執行。">建立多容器部署</a></div>
</div>
</div>
<aside role="complementary" aria-labelledby="d75631e6"></aside><article class="topic task nested1" role="article" aria-labelledby="d75631e174" id="gui"><h2 class="topictitle2" id="d75631e174">從 <span class="keyword">Bluemix</span> GUI 將短期作業當作單一容器來執行</h2>
<div class="body taskbody"><p class="shortdesc">從 <span class="keyword">Bluemix</span> GUI 中建立及部署容器。</p>
<div class="section prereq" id="gui__prereq_oh5_421_4z"><div class="p">開始之前，請考量下列資訊。<ul id="gui__ul_ph5_421_4z"><li id="gui__role">您必須具有 <span class="keyword">Bluemix</span> 空間的「開發者」角色，才能在其中建立容器。如需每一個角色之許可權以及如何編輯角色的相關資訊，請參閱<span class="ph"><a href="../iam/users_roles.html">使用者及角色</a></span>。</li>
<li id="gui__add_image">在 <span class="keyword">Bluemix</span> GUI 中，您可以從 IBM 提供的公用映像檔，或是從組織專用 <span class="keyword">Bluemix</span> 登錄中的現有映像檔來建立容器。如需新增映像檔至「<span class="keyword wintitle">型錄</span>」的相關資訊，請參閱<a href="container_images_adding_ov.html#container_images_adding_ov" title="容器映像檔是您建立的每個容器的基礎。映像檔是從 Dockerfile 建立的，Dockerfile 檔案中包含建置映像檔以及建置構件（例如應用程式、應用程式的配置及其相依關係）的指示。請將容器映像檔想像成執行檔（.exe 或 .bin）。執行這個可執行的應用程式檔案之後，即會建立應用程式的實例。當您執行容器時，會從映像檔建立容器實例。">將 Docker 映像檔新增至組織的專用 Bluemix 映像檔登錄</a>。</li>
<li id="gui__existing_ip">查看空間是否有您可以使用的 IP 位址存在，而不要建立新的 IP 位址。如需相關資訊，請參閱<a href="container_single_ui.html#container_cli_ips_list" title="若要將單一容器設成可從網際網路進行存取，您必須將公用 IP 位址與其連結。要求 IP 位址之前，請檢閱已指派給您組織的公用 IP 位址清單，並查看是否可以使用其中一個現有 IP 位址。">使用指令行介面 (CLI) 尋找組織的現有公用 IP 位址</a>。</li>
<li id="gui__bind_service">如果知道您想要將 <span class="keyword">Bluemix</span> 服務連結至容器，請將 <span class="keyword">Bluemix</span> 服務新增至您的空間。如需相關資訊，請參閱<a href="container_integrations.html#container_integrations_binding" title="IBM Bluemix 具有一份服務清單，且會代表應用程式開發者管理它們。若要新增 Bluemix 服務供您的容器使用，您必須要求此服務的實例，並將服務連結至容器。">從 Bluemix GUI 連結服務</a>。</li>
<li>如果知道您想要共用磁碟，以容許從容器內存取檔案，請在建立容器之前建立磁區。如需相關資訊，請參閱<a href="container_volumes_ov.html#container_volumes_cli" title="磁區是一個持續性的儲存位置，用來存放應用程式所建立的資料，或是應用程式執行所需的檔案。 您可以從指令行建立容器的磁區。">使用指令行 (CLI) 建立磁區</a>。</li>
</ul>
</div>
</div><p class="li stepsection">若要使用映像檔來建立及部署容器，請執行下列動作：</p><ol class="steps" id="gui__steps_qh5_421_4z"><li class="step stepexpand" id="gui__start"><span class="cmd"><span class="ph" data-hd-otherprops="registry_check">從型錄中，選取<span class="ph uicontrol">容器</span>，然後選擇映像檔。</span></span> 即會顯示 IBM 所提供的映像檔及專用 <span class="keyword">Bluemix</span> 登錄中所儲存的映像檔。</li>
<li class="step stepexpand" id="gui__namespace"><span class="cmd">如果已為您的組織設定名稱空間，則系統不會提示您建立一個名稱空間，而且可以繼續下一步。</span> 如果尚未為您的組織指定名稱空間，則系統會提示您為映像檔登錄設定一個名稱空間。 名稱空間是在 <span class="keyword">Bluemix</span> 中識別您的專用登錄的唯一名稱。名稱空間會指派給組織一次，且建立之後即無法變更。如果您要在多個 <span class="keyword">Bluemix</span> 地區中使用 <span class="keyword">IBM
Bluemix Container Service</span>，則必須設定每一個地區的名稱空間。
<div class="note tip" id="gui__namespace_naming"><span class="tiptitle">提示：</span> 遵守下列名稱空間規則：
<ul id="gui__ul_rh5_421_4z"><li>它只能包含小寫字母、數字或底線 (_)。</li>
<li>它可以是 4 - 30 個字元。如果您計劃從指令行管理容器，則可能偏好使用可以快速鍵入的簡短名稱空間。</li>
<li>其名稱在 <span class="keyword">Bluemix</span> 中必須是唯一的。</li>
</ul>
</div>
</li>
<li class="step stepexpand"><span class="cmd">接下來，開始定義您的容器。</span> 此視窗預設會開啟至<span class="ph uicontrol">單一容器</span>標籤。</li>
<li class="step stepexpand" id="gui__tag">選擇性的： <span class="cmd">在映像檔名稱下，選取要使用之映像檔的標籤或版本。</span></li>
<li class="step stepexpand" id="gui__space"><span class="cmd">選取您組織中的其中一個 <span class="keyword">Bluemix</span> 空間。</span></li>
<li class="step stepexpand"><span class="cmd">在<span class="ph uicontrol">容器名稱</span>欄位中，輸入容器的名稱。</span> <div class="note tip"><span class="tiptitle">提示：</span> 容器名稱必須以字母開頭，接著可以包含大寫字母、小寫字母、數字、句點 (.)、底線 (_) 或連字號 (-)。</div>
</li>
<li class="step stepexpand" id="gui__size"><span class="cmd">在<span class="ph uicontrol">大小</span>欄位中，選取容器大小。</span> 預設大小是<span class="ph uicontrol" data-hd-audience="yellow">微小（256 MB 記憶體，16 GB 儲存空間）</span>。您選擇的大小會影響在執行時，容器可在運算主機上取得的記憶體和磁碟空間數量，建立容器之後，即無法進行變更。其他可用的大小如下：<ul data-hd-audience="yellow" id="gui__ul_sh5_421_4z"><li>極微小（64 MB 記憶體，4 GB 磁碟空間）</li>
<li>極微（128 MB 記憶體，8 GB 磁碟空間）</li>
<li>極小（512 MB 記憶體，32 GB 磁碟空間）</li>
<li>小（1 GB 記憶體，64 GB 磁碟空間）</li>
<li>中（2 GB 記憶體，128 GB 磁碟空間）</li>
<li>大（4 GB 記憶體，256 GB 磁碟空間）</li>
<li>特大（8 GB 記憶體，512 GB 磁碟空間）</li>
<li>超大（16 GB 記憶體，1 TB 磁碟空間）</li>
</ul>

</li>
<li class="step stepexpand"><span class="cmd">在<span class="ph uicontrol">公用 IP 位址</span>欄位中，選擇是否要求並指派新的公用 IP 位址。</span> 公用 IP 位址容許與容器進行公開連線。有時您可能不想要公用 IP 位址，例如，當您使用一個只有專用網路內部使用者應用程式才能看到的資料庫時。
<div class="steps note"><span class="notetitle">註：</span> 連結公用 IP 位址時不包含 SSL 憑證，這個 SSL 憑證會加密傳送至單一容器及從其中送出的資料。如果您的應用程式需要 SSL 加密，您可以實作自己的 SSL 解決方案，或使用容器群組，而非單一容器。
容器群組會連結至已包含 SSL 憑證的公用路徑，讓您可以使用 HTTPS 存取容器群組，而不需要進行任何其他配置。如需相關資訊，請參閱<a href="container_ha.html#container_group_ui" title="從 Bluemix GUI 建立及部署可擴充群組容器。容器群組包含兩個以上執行相同映像檔的容器。對於執行具有需要可擴充性及可靠性之工作負載的長期服務，或是進行所需規模的測試，都可以使用容器群組。">使用 Bluemix GUI 建立容器群組</a>。</div>

<p>如果您有可以使用的 IP 位址，請選取<span class="ph uicontrol">保留未指派</span>，並在建立容器之後將此 IP 位址連結至容器。</p>
</li>
<li class="step stepexpand"><span class="cmd">在<span class="ph uicontrol">公用埠</span>欄位中，指定任何要發佈的公用埠。</span> 欄位會預先移入當建置映像檔時針對映像檔指定在 Dockerfile 中的埠。當您指定公用埠時，可以選擇 UDP 與 TCP 其中一個，以指出您要使用的 IP 通訊協定。如果您未指定通訊協定，則會針對 TCP 資料流量自動公開您的埠。當您公開公用埠時，會建立容器的「公用網路安全群組」，讓您可以僅透過公開埠傳送及接收公用資料。所有其他公用埠都會關閉，因此無法用來從網際網路存取應用程式。您可以用逗點 (,) 區隔每一個埠來包含多個埠。 <div class="p" id="gui__ports_p">如果在 Dockerfile 中針對您要使用的映像檔指定了埠，請包含該埠。<div class="note tip"><span class="tiptitle">提示：</span> <ul id="gui__ul_uh5_421_4z"><li>對於 IBM 認證的 Liberty Server 映像檔或此映像檔的已修改版本，請輸入埠 <kbd class="ph userinput">9080</kbd>。</li>
<li>對於 IBM 認證的 Node.js 映像檔或此映像檔的已修改版本，請輸入任何埠，例如埠 <kbd class="ph userinput">8000</kbd>。</li>
</ul>
</div>
</div>
</li>
<li class="step stepexpand">選擇性的： <span class="cmd">如果您要新增磁區、新增環境變數或連結 <span class="keyword">Bluemix</span> 服務，請展開<span class="ph uicontrol">進階選項</span>。</span></li>
<li class="step stepexpand" id="gui__volume">選擇性的： <span class="cmd">定義資料或檔案儲存空間。建立現有磁區與容器或容器群組的關聯。</span> 磁區是一個共用磁碟，容許在容器內存取檔案。容器中的路徑會指出在容器檔案系統中裝載磁區的位置。
<div class="note restriction"><span class="restrictiontitle">限制：</span> 您只能使用指令行，從 <span class="keyword">Bluemix</span> 空間刪除磁區。</div>
<ol type="a" class="ol substeps" id="gui__substeps_vh5_421_4z"><li class="li substep"><span class="cmd">按一下<span class="ph uicontrol">指派現有磁區</span>。</span></li>
<li class="li substep"><span class="cmd">從下拉清單中選取磁區。</span></li>
<li class="li substep"><span class="cmd">在下一個欄位中，指定容器上的路徑以對映磁區。</span> 例如，<span class="ph filepath">/var/lib/my_volume</span></li>
<li class="li substep"><span class="cmd">若要指定唯讀的磁區，請選取<span class="ph uicontrol">唯讀</span>。</span> 磁區預設為可讀寫。</li>
<li class="li substep"><span class="cmd">若要新增多個磁區，請按一下<span class="ph uicontrol">指派現有磁區</span>，然後重複上述步驟。</span></li>
</ol>
</li>
<li class="step stepexpand" id="gui__env_var">選擇性的： <span class="cmd">定義環境變數。</span> <ol type="a" class="ol substeps" id="gui__substeps_wh5_421_4z"><li class="li substep substepexpand"><span class="cmd">按一下<span class="ph uicontrol">新增環境變數</span>。</span></li>
<li class="li substep substepexpand"><span class="cmd">輸入環境變數的名稱。</span></li>
<li class="li substep substepexpand"><span class="cmd">在下一個欄位中，指定環境變數的值。</span></li>
<li class="li substep substepexpand"><span class="cmd">若要新增多個環境變數，請按一下<span class="ph uicontrol">新增環境變數</span>，然後重複上述步驟。</span> <div class="tablenoborder"><table summary="" id="gui__env_keys_group" class="defaultstyle"><caption><span class="tablecap">表 1. 建議的環境變數</span></caption><thead><tr><th id="d75631e520" class="thleft">環境變數</th>
<th id="d75631e522" class="thleft">說明</th>
</tr>
</thead>
<tbody><tr><td headers="d75631e520 "><div class="lines"><samp class="ph codeph">CCS_BIND_APP=</samp><br>
<samp class="ph codeph"><var class="keyword varname">&lt;appname&gt;</var></samp></div>
</td>
<td headers="d75631e522 ">部分 <span class="keyword">Bluemix</span> 服務不支援直接連結至容器。在此情況下，您需要建立一個 Cloud Foundry 應用程式，並將 <span class="keyword">Bluemix</span> 服務連結至其中。然後，您可以使用 <samp class="ph codeph">CCS_BIND_APP</samp>，將應用程式連結至您的容器。Cloud Foundry 應用程式用來作為橋接器，並容許 <span class="keyword">Bluemix</span> 將您橋接應用程式的 VCAP_SERVICES 資訊注入執行中的容器實例。</td>
</tr>
<tr><td headers="d75631e520 "><div class="lines"><samp class="ph codeph">CCS_BIND_SRV=</samp><br>
<samp class="ph codeph"><var class="keyword varname">&lt;service_instance_name1&gt;,</var></samp><br>
<samp class="ph codeph"><var class="keyword varname">&lt;service_instance_name2&gt;</var></samp></div>

<div class="steps note"><span class="notetitle">註：</span>  當服務不支援使用 <samp class="ph codeph">CCS_BIND_SRV=</samp> 環境變數時，請改用 <samp class="ph codeph">CCS_BIND_APP=</samp>。</div>
</td>
<td headers="d75631e522 ">若要將 <span class="keyword">Bluemix</span> 服務直接連結至容器，而不使用橋接應用程式，請使用 <samp class="ph codeph">CCS_BIND_SRV</samp>。此連結容許 <span class="keyword">Bluemix</span> 將 VCAP_SERVICES 資訊注入執行中容器實例。若要列出多個 <span class="keyword">Bluemix</span> 服務，請將它們包含為相同環境變數的一部分。</td>
</tr>
<tr><td headers="d75631e520 "><div class="lines">（已淘汰）<samp class="ph codeph">CCS_SSH_KEY=</samp><br>
<samp class="ph codeph"><var class="keyword varname">&lt;public_ssh_key&gt; </var></samp></div>
</td>
<td headers="d75631e522 "><div class="note note" data-hd-status="deprecated"><span class="notetitle">已淘汰此環境變數。：</span> 請改用 <span class="ph"><samp class="ph codeph">bx ic</samp></span>
<samp class="ph codeph">exec</samp> 或 <span class="ph"><samp class="ph codeph">bx ic</samp></span>
<samp class="ph codeph">attach</samp>，對您的容器進行外部存取。如需相關資訊，請參閱<a href="container_security.html#container_cli_login_exec" title="如果您必須登入執行中容器，則可以使用 bx ic exec。">使用 exec 登入容器</a>。</div>
<span class="ph">若要在建立時將 SSH 金鑰新增至容器，您可以使用 <samp class="ph codeph">CCS_API_KEY</samp>。</span></td>
</tr>
<tr><td headers="d75631e520 "><div class="lines"><samp class="ph codeph">LOG_LOCATIONS=</samp><br>
<samp class="ph codeph"><var class="keyword varname">&lt;path_to_file&gt; </var></samp></div>
</td>
<td headers="d75631e522 "><span class="ph" id="gui__d42709e1438">若要新增要在容器中監視的日誌檔，請包含 <samp class="ph codeph">LOG_LOCATIONS</samp> 環境變數與日誌檔路徑。</span></td>
</tr>
</tbody>
</table>
</div>
</li>
</ol>
</li>
<li class="step stepexpand" id="gui__bind_service_step">選擇性的： <span class="cmd">定義應用程式的其他服務。將 <span class="keyword">Bluemix</span> 服務從您的 <span class="keyword">Bluemix</span> 空間連結至您的容器。在<span class="ph uicontrol">服務連結</span>區段中，選取 <span class="keyword">Bluemix</span> 服務實例，然後按一下<span class="ph uicontrol">新增</span>，以將服務連結至容器。</span> 如果尚未有任何 <span class="keyword">Bluemix</span> 服務新增至空間，則功能表中不會顯示任何服務。</li>
<li class="step stepexpand" id="gui__deploy"><span class="cmd">部署容器，並等待其完成。按一下<span class="ph uicontrol">建立</span>。</span> 建立容器（可能需要一些時間）時，也會在 <span class="keyword">Bluemix</span> 中啟動容器。查看<span class="ph uicontrol">容器性能</span>區段中的容器狀態。建立完成時，狀態為<span class="ph uicontrol">執行中</span>。</li>
</ol>
<div class="section result" id="gui__result_xh5_421_4z"><p>如果由於有可使用的現有 IP 位址而對<span class="ph uicontrol">公用 IP 位址</span>選取<span class="ph uicontrol">保留未指派</span>，請將此 IP 位址連結至容器。如需相關資訊，請參閱<a href="container_single_ui.html#container_cli_ips" title="在 Bluemix 中，要求公用 IP 位址，並將其連結至容器。">要求及連結公用 IP 位址至容器</a>。</p>

<div class="p" id="gui__wait">如果您是從容器連接至外部應用程式，則在啟動容器處理程序之後最多等待 5 分鐘，就能連接至指定的 IP 位址。然後，您可以執行下列其中一個選項，以驗證應用程式正在容器中運作：<ul id="gui__ul_yh5_421_4z"><li>您可以使用公用 IP 位址及埠建立 URL，以在瀏覽器中開啟應用程式。<p>範例</p>
<span class="ph filepath">http://<var class="keyword varname">public_IP</var>:<var class="keyword varname">public_port</var></span>
<div class="steps note"><span class="notetitle">註：</span> 如果應用程式中存在未公開 HTTP 端點的服務，則此選項可能不會在瀏覽器中顯示應用程式。</div>
</li>
<li>從 Linux 或 UNIX 指令行中，您可以執行 <span class="ph filepath">nc -zv <var class="keyword varname">&lt;public_IP&gt;</var>
<var class="keyword varname">&lt;public_port&gt;</var></span>，以驗證伺服器正在所指定的埠上進行接聽。</li>
</ul>
</div>
</div><div class="section postreq" id="gui__postreq_zh5_421_4z"><p>接下來，如果您是組織管理員，則可以檢視組織的容器計費。</p>

<ol id="gui__ol_a35_421_4z"><li><span class="ph">從帳戶詳細資料的「管理組織」中，選取組織。</span></li>
<li>選取<span class="ph uicontrol">用量儀表板</span>，並檢閱用量及計費詳細資料。</li>
</ol>
</div></div>
</article><article class="topic task nested1" role="article" aria-labelledby="d75631e755" lang="zh-tw" id="container_single_cli"><h2 class="topictitle2" id="d75631e755">使用指令行介面 (CLI) 將短期作業當作單一容器來執行</h2>
<div class="body taskbody"><p class="shortdesc">使用 <samp class="ph codeph">run</samp> 指令來建立容器。容器必須內含映像檔。如果還沒有映像檔，您可以使用組織專用映像檔登錄中預設提供的其中一個預設 IBM 認證映像檔。</p>
<div class="section prereq"><div class="p" id="container_single_cli__prereq">開始之前，請考量下列步驟。<ul><li>您必須具有 <span class="keyword">Bluemix</span> 空間的「開發者」角色，才能在其中建立容器。如需每一個角色之許可權以及如何編輯角色的相關資訊，請參閱<span class="ph"><a href="../iam/users_roles.html">使用者及角色</a></span>。</li>
<li id="container_single_cli__identify_images">執行 <samp class="ph codeph"><span class="ph"><samp class="ph codeph">bx ic</samp></span> images</samp> 指令，以從組織的專用映像檔登錄中識別要用於容器的現有映像檔。若要將映像檔新增至登錄，請參閱<a href="container_images_adding_ov.html#container_images_adding_ov" title="容器映像檔是您建立的每個容器的基礎。映像檔是從 Dockerfile 建立的，Dockerfile 檔案中包含建置映像檔以及建置構件（例如應用程式、應用程式的配置及其相依關係）的指示。請將容器映像檔想像成執行檔（.exe 或 .bin）。執行這個可執行的應用程式檔案之後，即會建立應用程式的實例。當您執行容器時，會從映像檔建立容器實例。">將 Docker 映像檔新增至組織的專用 Bluemix 映像檔登錄</a>。</li>
<li>查看空間是否有您可以使用的 IP 位址存在，而不要建立新的 IP 位址。如需相關資訊，請參閱<a href="container_single_ui.html#container_cli_ips_list" title="若要將單一容器設成可從網際網路進行存取，您必須將公用 IP 位址與其連結。要求 IP 位址之前，請檢閱已指派給您組織的公用 IP 位址清單，並查看是否可以使用其中一個現有 IP 位址。">使用指令行介面 (CLI) 尋找組織的現有公用 IP 位址</a>。</li>
<li>如果知道您想要將 <span class="keyword">Bluemix</span> 服務連結至容器，請將 <span class="keyword">Bluemix</span> 服務新增至您的空間。如需相關資訊，請參閱<a href="container_integrations.html#container_integrations_binding" title="IBM Bluemix 具有一份服務清單，且會代表應用程式開發者管理它們。若要新增 Bluemix 服務供您的容器使用，您必須要求此服務的實例，並將服務連結至容器。">從 Bluemix GUI 連結服務</a>。</li>
<li id="container_single_cli__create_shared_volume">如果知道您想要共用磁碟，以容許從多個容器內存取檔案，請在建立容器之前建立磁區。如需相關資訊，請參閱<a href="container_volumes_ov.html#container_volumes_cli" title="磁區是一個持續性的儲存位置，用來存放應用程式所建立的資料，或是應用程式執行所需的檔案。 您可以從指令行建立容器的磁區。">使用指令行 (CLI) 建立磁區</a>。</li>
</ul>
</div>
</div><p class="li stepsection">建立容器。</p><ol class="steps"><li class="step stepexpand"><span class="cmd">使用現有 IP 位址和組織專用映像檔登錄中的現有映像檔來建立容器。*</span> <pre class="codeblock"><code><span class="ph"><samp class="ph codeph">bx ic</samp></span> run -p <var class="keyword varname">&lt;ip-address&gt;</var>:<var class="keyword varname">&lt;port_on_IP&gt;</var>:<var class="keyword varname">&lt;public_port&gt;</var> -e <var class="keyword varname">&lt;env_variable&gt;</var> -m <var class="keyword varname">&lt;container_size&gt;</var> --name <var class="keyword varname">&lt;container_name&gt;</var> --volume <var class="keyword varname">&lt;volname:mount_path&gt;</var> registry.<span class="keyword" data-hd-keyref="DomainName">DomainName</span>/<var class="keyword varname">&lt;namespace&gt;</var>/<var class="keyword varname">&lt;image_name_or_id&gt;</var></code></pre>

<div class="steps note"><span class="notetitle">註：</span> <span class="ph" id="container_single_cli__d41666e180">*<a href="container_cli_cfic_install.html#container_cli_login" title="在安裝 CLI 之後，請登入以使用它。">登入 <span class="keyword">IBM
Bluemix Container Service</span></a> 並設定環境變數以使用原生 Docker 指令時，可以將此指令中的 <samp class="ph codeph"><span class="ph">bx ic</span></samp> 取代為 <samp class="ph codeph">docker</samp>。</span><span class="ph" id="container_single_cli__d41666e192">您可以在本主題中所有標上星號 (*) 的步驟中使用原生 Docker 指令。</span></div>

<p>範例</p>

<div class="p">下列範例會建立具有下列詳細資料的單一容器。<ul><li>名稱：<var class="keyword varname">my_container</var></li>
<li>大小：<var class="keyword varname">64 MB</var></li>
<li>映像檔：<var class="keyword varname">ibmliberty</var></li>
<li>裝載磁區：<var class="keyword varname">myvol</var></li>
<li>公開的公用埠：<var class="keyword varname">9080</var></li>
<li>連結的 IP 位址：<var class="keyword varname">192.0.2.23</var></li>
<li>自訂日誌檔位置：標準 Ubuntu 日誌檔。在建立容器之後，可以在 Kibana 中檢視自訂日誌檔位置中的日誌。</li>
</ul>
</div>

<pre class="codeblock"><code><span class="ph"><samp class="ph codeph">bx ic</samp></span> run -p 192.0.2.23:9080:9080 -e <span class="q">"LOG_LOCATION=/var/log/dpkg.log"</span> -m 64 --name my_container --volume myvol:/var/tmp registry.<span class="keyword" data-hd-keyref="DomainName">DomainName</span>/ibmliberty </code></pre>

建立容器時，也會將它啟動。顯示容器的 ID 時，即表示已部署容器。</li>
<li class="step stepexpand">選擇性的： <span class="cmd">列出執行中容器。*</span> <pre class="codeblock"><code><span class="ph"><samp class="ph codeph">bx ic</samp></span> ps</code></pre>
</li>
</ol>
<div class="section postreq"><div class="p">如果您是從容器連接至外部應用程式，則在啟動容器處理程序之後最多等待 5 分鐘，就能連接至指定的 IP 位址。然後，您可以執行下列其中一個選項，以驗證應用程式正在容器中運作：<ul id="container_single_cli__d41671e378"><li>您可以使用公用 IP 位址及埠建立 URL，以在瀏覽器中開啟應用程式。<p>範例</p>
<span class="ph filepath">http://<var class="keyword varname">public_IP</var>:<var class="keyword varname">public_port</var></span>
<div class="steps note"><span class="notetitle">註：</span> 如果應用程式中存在未公開 HTTP 端點的服務，則此選項可能不會在瀏覽器中顯示應用程式。</div>
</li>
<li>從 Linux 或 UNIX 指令行中，您可以執行 <span class="ph filepath">nc -zv <var class="keyword varname">&lt;public_IP&gt;</var>
<var class="keyword varname">&lt;public_port&gt;</var></span>，以驗證伺服器正在所指定的埠上進行接聽。</li>
</ul>
</div>

<p>接下來，如果您是組織管理員，則可以檢視組織的容器計費。</p>

<div class="p"><ol><li>按一下使用者虛擬人像。</li>
<li>按一下<span class="ph uicontrol">帳戶</span>。</li>
<li>按一下 <span class="ph uicontrol">+</span> 按鈕，以展開組織。</li>
<li>選取<span class="ph uicontrol">用量儀表板</span>，並檢閱用量及計費詳細資料。</li>
</ol>
<span class="ph">如需相關資訊，請移至<span class="ph"><a href="../admin/account.html">管理您的帳戶</a></span>。</span></div>
</div></div>
<aside role="complementary" aria-labelledby="d75631e755"></aside></article><article class="topic task nested1" role="article" aria-labelledby="d75631e1078" lang="zh-tw" id="container_single_updating"><h2 class="topictitle2" id="d75631e1078">使用指令行介面 (CLI) 更新單一容器中的短期作業</h2>
<div class="body taskbody"><p class="shortdesc">若要更新應用程式，您必須部署新的容器。如果您推送新的映像檔，則不會自動重新啟動容器。</p>
<div class="section context"><div class="tablenoborder"><table summary="" id="container_single_updating__updating_group_cli_table" class="defaultstyle"><caption><span class="tablecap">表 2. 用於更新應用程式的選用性工具</span></caption><thead><tr><th id="d75631e1144" class="thleft">更新工具</th>
<th id="d75631e1146" class="thleft">說明</th>
</tr>
</thead>
<tbody><tr><td headers="d75631e1144 "><span class="keyword">Delivery Pipeline</span></td>
<td headers="d75631e1146 ">使用 <span class="keyword">Delivery Pipeline</span>（這是您可以使用的一項 <span class="keyword">Bluemix</span> 服務）自動建置應用程式，並將容器部署至 <span class="keyword">Bluemix</span>。如需相關資訊，請參閱<a href="container_integrations.html#container_single_pipeline_ov" title="使用 Delivery Pipeline 自動建置及部署單一容器。">使用 Delivery Pipeline 建立單一容器</a>。</td>
</tr>
<tr><td headers="d75631e1144 ">UrbanCode Deploy</td>
<td headers="d75631e1146 ">使用 UrbanCode Deploy 自動建置應用程式，並將容器部署至 <span class="keyword">Bluemix</span>。如需購買 UrbanCode Deploy 的相關資訊，請參閱 <a href="http://www.ibm.com/software/products/en/ucdep" rel="external" target="_blank" title="（在新分頁或視窗中開啟）">IBM UrbanCode Deploy</a> 產品頁面。</td>
</tr>
<tr><td headers="d75631e1144 ">使用 <span class="keyword">IBM
Bluemix Container Service</span> CLI 自行更新應用程式</td>
<td headers="d75631e1146 ">完成此作業中的步驟來自行更新應用程式。</td>
</tr>
</tbody>
</table>
</div>
</div><p class="li stepsection">若要使用 <span class="keyword">IBM
Bluemix Container Service</span> CLI 自行更新容器，請執行下列動作：</p><ol class="steps"><li class="step stepexpand"><span class="cmd">在本端更新應用程式。</span></li>
<li class="step stepexpand"><span class="cmd">選擇直接在 <span class="keyword">Bluemix</span> 中建置映像檔，或先在本端建置及測試映像檔，然後再將它推送至 <span class="keyword">Bluemix</span>。</span> <ul><li>若要在 <span class="keyword">Bluemix</span> 中直接建置映像檔，請執行下列指令。*<div class="note tip"><span class="tiptitle">提示：</span> <span class="ph">執行 <samp class="ph codeph"><span class="ph">bx ic</span> namespace-get</samp>，以擷取名稱空間，並將 <var class="keyword varname">&lt;my_namespace&gt;</var> 取代為您的名稱空間資訊。</span></div>
<pre class="codeblock"><code><span class="ph"><samp class="ph codeph">bx ic</samp></span> build -t registry.<span class="keyword" data-hd-keyref="DomainName">DomainName</span>/<var class="keyword varname">&lt;my_namespace&gt;</var>/<var class="keyword varname">&lt;image_name&gt;</var>:<var class="keyword varname">&lt;tag&gt;</var> <var class="keyword varname">&lt;dockerfile_location&gt;</var></code></pre>
範例<pre class="codeblock"><code><span class="ph"><samp class="ph codeph">bx ic</samp></span> build -t registry.<span class="keyword" data-hd-keyref="DomainName">DomainName</span>/<var class="keyword varname">my_namespace</var>/<var class="keyword varname">my_image</var>:<var class="keyword varname">v1</var> .</code></pre>
<div class="steps note"><span class="notetitle">註：</span> <span class="ph" id="container_single_updating__d43216e240">*<a href="container_cli_cfic_install.html#container_cli_login" title="在安裝 CLI 之後，請登入以使用它。">登入 <span class="keyword">IBM
Bluemix Container Service</span></a> 並設定環境變數以使用原生 Docker 指令時，可以將此指令中的 <samp class="ph codeph"><span class="ph">bx ic</span></samp> 取代為 <samp class="ph codeph">docker</samp>。</span><span class="ph" id="container_single_updating__d43216e259">您可以在本主題中所有標上星號 (*) 的步驟中使用原生 Docker 指令。</span></div>
</li>
<li>若要在本端建置映像檔，然後將映像檔推送至 <span class="keyword">Bluemix</span>，請遵循下列步驟。<div class="p"><ol type="a"><li>如果您是使用 <span class="keyword">IBM
Bluemix Container Service</span> 的外掛程式，請重新登入。針對選項 2，請不要設定環境變數，讓 <samp class="ph codeph">docker</samp> 指令因而傳送至本端機器上的 Docker Engine。<div class="p"><pre class="codeblock"><code><span class="ph"><samp class="ph codeph">bx ic</samp></span> init</code></pre>
</div>
</li>
<li>從 Dockerfile 本端建置映像檔。<div class="p"><pre class="codeblock"><code>docker build -t <var class="keyword varname">&lt;image_name&gt;</var>:<var class="keyword varname">&lt;tag&gt;</var> <var class="keyword varname">&lt;dockerfile_location&gt;</var></code></pre>
</div>
<div class="p">範例<pre class="codeblock"><code>docker build -t <var class="keyword varname">my_ibmliberty_image</var>:<var class="keyword varname">v1</var> .</code></pre>
</div>
</li>
<li>使用下列指令，從映像檔中執行容器來測試新應用程式是否在本端執行，其中 <var class="keyword varname">Port</var> 是適用於 HTTP 資料流量的埠。<div class="p"><pre class="codeblock"><code>docker run -d --name <var class="keyword varname">&lt;container_name&gt;</var> <var class="keyword varname">&lt;image_name&gt;</var></code></pre>
</div>
<div class="p">範例<pre class="codeblock"><code>docker run -d --name <var class="keyword varname">my_container</var> <var class="keyword varname">my_ibmliberty_image</var></code></pre>
</div>
<p>如果應用程式正確地執行，則會在 CLI 輸出中顯示容器 ID。若要檢閱容器的日誌，請執行 <samp class="ph codeph">docker logs <var class="keyword varname">&lt;container_name_or_id&gt;</var>。</samp></p>
</li>
<li id="container_single_updating__d43216e340">使用專用 <span class="keyword">Bluemix</span> 登錄及新名稱來標記本端映像檔。<span class="ph">僅在映像檔名稱中使用小寫英數字元或底線 (_)。其他符號（例如連字號 (-) 或斜線 (/)）可能會防止將映像檔推送至映像檔登錄。</span><div class="p"><pre class="codeblock"><code>docker tag <var class="keyword varname">&lt;current_image_name_or_ID&gt;</var>:<var class="keyword varname">&lt;optional_tag&gt;</var>  registry.<span class="keyword" data-hd-keyref="DomainName">DomainName</span>/<var class="keyword varname">&lt;my_namespace&gt;</var>/<var class="keyword varname">&lt;new_image_name&gt;</var>:<var class="keyword varname">&lt;optional_tag&gt;</var> </code></pre>
</div>
<p>範例</p>
<div class="p"><pre class="codeblock"><code>docker tag <var class="keyword varname">my_ibmliberty_image</var> registry.<span class="keyword" data-hd-keyref="DomainName">DomainName</span>/<var class="keyword varname">&lt;my_namespace&gt;</var>/<var class="keyword varname">my_ibmliberty_image</var></code></pre>
</div>
</li>
<li>使用下列指令，將映像檔推送至專用 <span class="keyword">Bluemix</span> 登錄。<div class="p"><pre class="codeblock"><code>docker push registry.<span class="keyword" data-hd-keyref="DomainName">DomainName</span>/<var class="keyword varname">&lt;my_namespace&gt;</var>/<var class="keyword varname">&lt;image_name&gt;</var></code></pre>
</div>
<div class="p">範例<pre class="codeblock"><code>docker push registry.<span class="keyword" data-hd-keyref="DomainName">DomainName</span>/<var class="keyword varname">my_namespace</var>/<var class="keyword varname">my_ibmliberty_image</var></code></pre>
</div>
</li>
</ol>
</div>
<div class="note important"><span class="importanttitle">重要：</span> <span class="ph">當您將映像檔推送至專用 <span class="keyword">Bluemix</span> 登錄時，針對映像檔報告的大小小於本端 Docker Engine 中相同映像檔的大小。大小之間的差異並不表示在推送映像檔時發生問題。在 <span class="keyword">IBM
Bluemix Container Service</span> 中報告壓縮的映像檔大小。</span></div>
</li>
</ul>
</li>
<li class="step stepexpand"><span class="cmd">從容器取消連結公用 IP 位址。</span> <pre class="codeblock"><code><span class="ph"><samp class="ph codeph">bx ic</samp></span> ip-unbind <var class="keyword varname">&lt;public_IP_address&gt;</var> <var class="keyword varname">&lt;container_name_or_id&gt;</var></code></pre>
 <p>容器不再連結至 IP 位址，但是 IP 仍然會計入組織的公用 IP 配額。</p>
</li>
<li class="step stepexpand"><span class="cmd">執行下列指令，驗證已取消連結 IP 位址。*</span> <pre class="codeblock"><code><span class="ph"><samp class="ph codeph">bx ic</samp></span> inspect <var class="keyword varname">&lt;container_name_or_id&gt;</var></code></pre>


<p>如果 <samp class="ph systemoutput">PublicIpAddress</samp> 的值不是空的，請多等待幾分鐘、重新執行指令，然後再繼續下一步。</p>
</li>
<li class="step stepexpand"><span class="cmd">從現有容器移除 IP 位址之後，請使用更新過的映像檔來建立另一個容器。*</span> <pre class="codeblock"><code><span class="ph"><span class="ph"><samp class="ph codeph">bx ic</samp></span><span class="ph" id="container_single_updating__d43230e3582"> run [-p PORT] [-P] [-d] [-e ENV] [--env-file
ENVFILE] [-it] [--link NAME:ALIAS] [-m MEMORY] --name NAME [--volume VOLUME:/DIRECTORY_PATH] IMAGE [CMD [CMD ...]] </span></span></code></pre>
</li>
<li class="step stepexpand"><span class="cmd">將 IP 位址連結至新的容器。</span> <pre class="codeblock"><code><span class="ph"><samp class="ph codeph">bx ic</samp></span> ip-bind <var class="keyword varname">&lt;public_IP_address&gt;</var> <var class="keyword varname">&lt;container_name_or_id&gt;</var></code></pre>
</li>
<li class="step stepexpand">選擇性的： <span class="cmd">刪除舊的容器。*</span> <pre class="codeblock"><code><span class="ph"><samp class="ph codeph">bx ic</samp></span> rm <var class="keyword varname">&lt;container_name_or_id&gt;</var></code></pre>
</li>
</ol>
</div>
<aside role="complementary" aria-labelledby="d75631e1078"></aside></article><article class="topic task nested1" role="article" aria-labelledby="d75631e1546" lang="zh-tw" id="container_linking"><h2 class="topictitle2" id="d75631e1546">使用指令行介面 (CLI) 鏈結單一容器</h2>
<div class="body taskbody"><p class="shortdesc">將某個容器鏈結至相同空間中的另一個容器時，<span class="keyword">IBM
Bluemix Container Service</span> 會在來源容器的收件者容器上建立一個主機項目。您可以使用別名來參照來源容器，而不使用可能經常變更的特定 IP 位址。</p>
<div class="section context"><p>想要某個容器與另一個執行映像檔（例如 <samp class="ph codeph">dbimage</samp>）的容器進行通訊時，即可使用主機名稱的別名（例如 <samp class="ph codeph">dbserver</samp>）來為容器定址。使用此功能，您可以建立 <samp class="ph codeph">webserver</samp> 映像檔，讓它使用 <samp class="ph codeph">dbserver</samp> 主機名稱來參照資料庫伺服器映像檔，不論其 IP 位址或實際名稱為何。您可以執行相同映像檔中配對的許多實例，而不需要遞交配置或 IP 資訊。可以一律將資料庫伺服器參照為 <samp class="ph codeph">dbserver</samp>。</p>

</div><ol class="steps"><li class="step stepexpand"><span class="cmd">執行下列指令，以建立來源容器。*</span> <div class="note tip"><span class="tiptitle">提示：</span> 請一定要包含 <samp class="ph codeph">-p</samp> 選項來發佈埠，以向收件者容器公開埠號。在 Dockerfile 中，鏈結運行環境目前未使用透過 EXPOSE 陳述式在映像檔中公開的埠。</div>

<div class="note tip"><span class="tiptitle">提示：</span> <span class="ph">執行 <samp class="ph codeph"><span class="ph">bx ic</span> namespace-get</samp>，以擷取名稱空間，並將 <var class="keyword varname">&lt;my_namespace&gt;</var> 取代為您的名稱空間資訊。</span></div>

<pre class="codeblock"><code><span class="ph"><samp class="ph codeph">bx ic</samp></span> run -p <var class="keyword varname">&lt;port&gt;</var> --name <var class="keyword varname">&lt;source_container_name&gt;</var> registry.<span class="keyword" data-hd-keyref="DomainName">DomainName</span>/<var class="keyword varname">&lt;my_namespace&gt;</var>/<var class="keyword varname">&lt;source_container_image_name&gt;</var> </code></pre>
範例<pre class="codeblock"><code><span class="ph"><samp class="ph codeph">bx ic</samp></span> run -p <var class="keyword varname">17546</var> --name <var class="keyword varname">source</var> registry.<span class="keyword" data-hd-keyref="DomainName">DomainName</span>/<var class="keyword varname">&lt;my_namespace&gt;</var>/<var class="keyword varname">dbimage</var> </code></pre>

<div class="steps note"><span class="notetitle">註：</span> <span class="ph" id="container_linking__d36696e180">*<a href="container_cli_cfic_install.html#container_cli_login" title="在安裝 CLI 之後，請登入以使用它。">登入 <span class="keyword">IBM
Bluemix Container Service</span></a> 並設定環境變數以使用原生 Docker 指令時，可以將此指令中的 <samp class="ph codeph"><span class="ph">bx ic</span></samp> 取代為 <samp class="ph codeph">docker</samp>。</span><span class="ph" id="container_linking__d36696e192">您可以在本主題中所有標上星號 (*) 的步驟中使用原生 Docker 指令。</span></div>
</li>
<li class="step stepexpand"><span class="cmd">執行下列指令，以建立收件者容器並將其鏈結至來源容器。*</span> 對於別名，選取來源容器中所使用映像檔的自訂名稱。您可以包含 <span class="keyword option">-p</span> 選項多次，將收件者容器的多個埠公開給主機容器。 <pre class="codeblock"><code><span class="ph"><samp class="ph codeph">bx ic</samp></span> run -p <var class="keyword varname">&lt;port&gt;</var> -p <var class="keyword varname">&lt;port&gt;</var> --name <var class="keyword varname">&lt;recipient_container_name&gt;</var> --link <var class="keyword varname">&lt;source_container_name&gt;</var>:<var class="keyword varname">&lt;alias&gt;</var> registry.<span class="keyword" data-hd-keyref="DomainName">DomainName</span>/<var class="keyword varname">&lt;my_namespace&gt;</var>/<var class="keyword varname">&lt;recipient_container_image_name&gt;</var> </code></pre>
範例<pre class="codeblock"><code><span class="ph"><samp class="ph codeph">bx ic</samp></span> run -p 12534 -p 15256 --name <var class="keyword varname">recipient</var> --link <var class="keyword varname">source</var>:<var class="keyword varname">dbserver</var> registry.<span class="keyword" data-hd-keyref="DomainName">DomainName</span>/<var class="keyword varname">&lt;my_namespace&gt;</var>/<var class="keyword varname">webserver</var> </code></pre>

<p>顯示收件者容器的 ID 時，即表示已鏈結容器。</p>
</li>
<li class="step stepexpand">選擇性的： <span class="cmd">使用 <samp class="ph codeph">exec</samp>.* 來登入容器，以驗證鏈結所注入的環境變數。</span> <pre class="codeblock"><code><span class="ph"><samp class="ph codeph">bx ic</samp></span> exec -it <var class="keyword varname">&lt;recipient_container_name&gt;</var> bash </code></pre>
 <div class="p">在 Bash 視窗中執行 <samp class="ph codeph">env</samp> 指令，以查看別名的詳細資料。<pre class="codeblock"><code>"Env": [
    "<var class="keyword varname">&lt;alias&gt;</var>_PORT_&lt;source_container_port&gt;/tcp_TCP_PORT=&lt;source_container_port&gt;/tcp",
    "<var class="keyword varname">&lt;alias&gt;</var>_PORT_&lt;source_container_port&gt;/tcp_TCP=tcp://<var class="keyword varname">&lt;recipient_container_private_IP&gt;</var>:&lt;source_container_port&gt;/tcp",
    "<var class="keyword varname">&lt;alias&gt;</var>_ENV_space_id=<var class="keyword varname">&lt;space_ID&gt;</var>",
    "logging_password=",
    "space_id=<var class="keyword varname">&lt;space_ID&gt;</var>",
    "logstash_target=logs.opvis.bluemix.net:9091",
    "<var class="keyword varname">&lt;alias&gt;</var>_PORT_<var class="keyword varname">&lt;source_container_port&gt;</var>/tcp_TCP_ADDR=<var class="keyword varname">&lt;recipient_container_private_ip&gt;</var>",
    "<var class="keyword varname">&lt;alias&gt;</var>_ENV_metrics_target=metrics.opvis.bluemix.net:9095",
    "<var class="keyword varname">&lt;alias&gt;</var>_NAME=/<var class="keyword varname">&lt;recipient_container&gt;</var>/<var class="keyword varname">&lt;alias&gt;</var>",
    "<var class="keyword varname">&lt;alias&gt;</var>_ENV_logstash_target=logs.opvis.bluemix.net:9091",
    "<var class="keyword varname">&lt;alias&gt;</var>_ENV_logging_password=",
    "<var class="keyword varname">&lt;alias&gt;</var>_PORT_<var class="keyword varname">&lt;source_container_port&gt;</var>/tcp_TCP_PROTO=tcp",
    "metrics_target=metrics.opvis.bluemix.net:9095"
],</code></pre>
</div>
</li>
</ol>
</div>
<aside role="complementary" aria-labelledby="d75631e1546"></aside></article><article class="topic task nested1" role="article" aria-labelledby="d75631e1863" lang="zh-tw" id="container_cli_ips"><h2 class="topictitle2" id="d75631e1863">要求及連結公用 IP 位址至容器</h2>
<div class="body taskbody"><p class="shortdesc">在 <span class="keyword">Bluemix</span> 中，要求公用 IP 位址，並將其連結至容器。</p>
<div class="section prereq"><div class="steps note"><span class="notetitle">註：</span> 連結公用 IP 位址時不包含 SSL 憑證，這個 SSL 憑證會加密傳送至單一容器及從其中送出的資料。如果您的應用程式需要 SSL 加密，您可以實作自己的 SSL 解決方案，或使用容器群組，而非單一容器。
容器群組會連結至已包含 SSL 憑證的公用路徑，讓您可以使用 HTTPS 存取容器群組，而不需要進行任何其他配置。如需相關資訊，請參閱<a href="container_ha.html#container_group_ui" title="從 Bluemix GUI 建立及部署可擴充群組容器。容器群組包含兩個以上執行相同映像檔的容器。對於執行具有需要可擴充性及可靠性之工作負載的長期服務，或是進行所需規模的測試，都可以使用容器群組。">使用 Bluemix GUI 建立容器群組</a>。</div>

<p>開始之前，若要查看空間是否有您可以使用的公用 IP 位址，而不要建立公用 IP 位址，請參閱<a href="container_single_ui.html#container_cli_ips_list" title="若要將單一容器設成可從網際網路進行存取，您必須將公用 IP 位址與其連結。要求 IP 位址之前，請檢閱已指派給您組織的公用 IP 位址清單，並查看是否可以使用其中一個現有 IP 位址。">使用指令行介面 (CLI) 尋找組織的現有公用 IP 位址</a>。</p>
</div><ol class="steps"><li class="step stepexpand"><span class="cmd">要求公用 IP 位址。</span>  要求公用 IP 位址時，會將公用 IP 位址儲存區中的隨機公用 IP 位址配置給空間。配置給空間時，IP 位址不會變更。<pre class="codeblock"><code><span class="ph"><samp class="ph codeph">bx ic</samp></span> ip-request</code></pre>
</li>
<li class="step stepexpand"><span class="cmd">記下 IP 位址。</span></li>
<li class="step stepexpand"><span class="cmd">將位址連結至新的容器或現有的執行中容器。</span> <ul class="ul choices"><li class="li choice">若要連結至現有的執行中容器，請執行下列指令：<pre class="codeblock"><code><span class="ph"><samp class="ph codeph">bx ic</samp></span> ip-bind <var class="keyword varname">&lt;public_IP_address&gt;</var> <var class="keyword varname">&lt;container_name_or_id&gt;</var></code></pre>
範例<pre class="codeblock"><code><span class="ph"><samp class="ph codeph">bx ic</samp></span> ip-bind 192.0.2.23 my_container</code></pre>
</li>
<li class="li choice">若要連結至新的容器，請執行下列指令：<pre class="codeblock"><code><span class="ph"><samp class="ph codeph">bx ic</samp></span> run -p <var class="keyword varname">&lt;ip-address&gt;</var>:<var class="keyword varname">&lt;container-port&gt;</var>:<var class="keyword varname">&lt;container-port&gt;</var> --name <var class="keyword varname">&lt;container_name&gt;</var> registry.<span class="keyword" data-hd-keyref="DomainName">DomainName</span>/<var class="keyword varname">&lt;my_namespace&gt;</var>/<var class="keyword varname">&lt;image_name&gt;</var></code></pre>
</li>
</ul>
</li>
</ol>
<div class="section result">會立即提出連結要求，但使用 IP 位址連接至容器可能需要幾分鐘的時間。</div></div>
<aside role="complementary" aria-labelledby="d75631e1863"></aside><article class="topic task nested2" role="article" aria-labelledby="d75631e2015" lang="zh-tw" id="container_cli_ips_list"><h3 class="topictitle3" id="d75631e2015">使用指令行介面 (CLI) 尋找組織的現有公用 IP 位址</h3>
<div class="body taskbody"><p class="shortdesc">若要將單一容器設成可從網際網路進行存取，您必須將公用 IP 位址與其連結。要求 IP 位址之前，請檢閱已指派給您組織的公用 IP 位址清單，並查看是否可以使用其中一個現有 IP 位址。</p>
<div class="section context"><div class="steps note"><span class="notetitle">註：</span> 連結公用 IP 位址時不包含 SSL 憑證，這個 SSL 憑證會加密傳送至單一容器及從其中送出的資料。如果您的應用程式需要 SSL 加密，您可以實作自己的 SSL 解決方案，或使用容器群組，而非單一容器。
容器群組會連結至已包含 SSL 憑證的公用路徑，讓您可以使用 HTTPS 存取容器群組，而不需要進行任何其他配置。如需相關資訊，請參閱<a href="container_ha.html#container_group_ui" title="從 Bluemix GUI 建立及部署可擴充群組容器。容器群組包含兩個以上執行相同映像檔的容器。對於執行具有需要可擴充性及可靠性之工作負載的長期服務，或是進行所需規模的測試，都可以使用容器群組。">使用 Bluemix GUI 建立容器群組</a>。</div>
</div><div class="step"><span class="cmd">列出空間的可用公用 IP 位址。</span> <pre class="codeblock"><code><span class="ph"><samp class="ph codeph">bx ic</samp></span> ips</code></pre>
</div>
<div class="section postreq">如果您沒有任何 IP 位址或想要要求一個 IP 位址，則可以選擇下列其中一個選項。您可以在使用 <span class="keyword">Bluemix</span> GUI 建立單一容器時，或從指令行執行 <samp class="ph codeph"><span class="ph"><samp class="ph codeph">bx ic</samp></span> ip-request</samp> 時，要求一個 IP 位址。若要使用指令行要求 IP 位址，請參閱<a href="container_single_ui.html#container_cli_ips" title="在 Bluemix 中，要求公用 IP 位址，並將其連結至容器。">要求及連結公用 IP 位址至容器</a>。</div></div>
<aside role="complementary" aria-labelledby="d75631e2015"></aside></article><article class="topic task nested2" role="article" aria-labelledby="d75631e2117" lang="zh-tw" id="container_cli_ips_unbind"><h3 class="topictitle3" id="d75631e2117">取消容器與公用 IP 位址的連結</h3>
<div class="body taskbody"><p class="shortdesc">您可以從容器取消連結公用 IP 位址，但是其他容器仍然可以使用該 IP 位址，且它仍然會計入組織的公用 IP 配額。</p>
<ol class="steps"><li class="step stepexpand" id="container_cli_ips_unbind__unbind"><span class="cmd">從容器取消連結公用 IP 位址。</span> <pre class="codeblock"><code><span class="ph"><samp class="ph codeph">bx ic</samp></span> ip-unbind <var class="keyword varname">&lt;public_IP_address&gt;</var> <var class="keyword varname">&lt;container_name_or_id&gt;</var></code></pre>
 <p>容器不再連結至 IP 位址，但是 IP 仍然會計入組織的公用 IP 配額。</p>
</li>
<li class="step stepexpand"><span class="cmd">驗證已順利取消連結 IP 位址。</span> <pre class="codeblock"><code><span class="ph"><samp class="ph codeph">bx ic</samp></span> ips</code></pre>
</li>
</ol>
</div>
<aside role="complementary" aria-labelledby="d75631e2117"></aside></article><article class="topic task nested2" role="article" aria-labelledby="d75631e2200" lang="zh-tw" id="container_cli_ips_remove"><h3 class="topictitle3" id="d75631e2200">從您的配額移除公用 IP 位址</h3>
<div class="body taskbody"><p class="shortdesc">如果您未使用公用 IP 位址，或必須刪除公用 IP 位址以要求新的公用 IP 位址，則可以從您組織的配額移除公用 IP 位址。</p>
<div class="section prereq">開始之前，請從正在使用公用 IP 位址的任何容器取消連結該公用 IP 位址。</div><ol class="steps"><li class="step stepexpand"><span class="cmd">從組織的配額移除 IP 位址。</span> <pre class="codeblock"><code><span class="ph"><samp class="ph codeph">bx ic</samp></span> ip-release <var class="keyword varname">&lt;public_IP_address&gt;</var> </code></pre>
</li>
<li class="step stepexpand">選擇性的： <span class="cmd">驗證 IP 位址不再列為已配置。</span> <pre class="codeblock"><code><span class="ph"><samp class="ph codeph">bx ic</samp></span> ips</code></pre>
</li>
</ol>
</div>
<aside role="complementary" aria-labelledby="d75631e2200"></aside></article></article><article class="topic task nested1" role="article" aria-labelledby="d75631e2281" lang="zh-tw" id="container_single_remove"><h2 class="topictitle2" id="d75631e2281">移除單一容器</h2>
<div class="body taskbody"><p class="shortdesc">若要充分利用您的配額，請偶而移除未使用的容器。</p>
<ol class="steps"><li class="step stepexpand"><span class="cmd">使用下列其中一種方法來移除容器。</span> <ul class="ul choices"><li class="li choice">從 <span class="keyword">Bluemix</span> GUI<ol type="a"><li>從 <span class="keyword">Bluemix</span>「儀表板」中，選取您要刪除的容器。</li>
<li>展開<span class="ph uicontrol">其他動作...</span> 功能表，然後按一下<span class="ph uicontrol">刪除</span>。</li>
</ol>
<ul><li>在容器磚中，按一下齒輪圖示，然後按一下<span class="ph uicontrol">刪除容器</span>。</li>
</ul>
</li>
<li class="li choice">從 CLI
*<pre class="codeblock"><code><span class="ph"><span class="ph"><samp class="ph codeph">bx ic</samp></span> rm [-f] CONTAINER [CONTAINER] </span></code></pre>
<div class="steps note"><span class="notetitle">註：</span> <span class="ph" id="container_single_remove__d42493e180">*<a href="container_cli_cfic_install.html#container_cli_login" title="在安裝 CLI 之後，請登入以使用它。">登入 <span class="keyword">IBM
Bluemix Container Service</span></a> 並設定環境變數以使用原生 Docker 指令時，可以將此指令中的 <samp class="ph codeph"><span class="ph">bx ic</span></samp> 取代為 <samp class="ph codeph">docker</samp>。</span><span class="ph" id="container_single_remove__d42493e192">您可以在本主題中所有標上星號 (*) 的步驟中使用原生 Docker 指令。</span></div>
</li>
</ul>
</li>
<li class="step stepexpand">選擇性的： <span class="cmd">驗證已移除容器，方法為執行下列指令，並確認容器並未出現在清單中。*</span> <pre class="codeblock"><code><span class="ph"><samp class="ph codeph">bx ic</samp></span> ps -a</code></pre>
</li>
</ol>
</div>
<aside role="complementary" aria-labelledby="d75631e2281"></aside></article><article class="topic tutorial nested1" role="article" aria-labelledby="d75631e2433" lang="zh-tw" id="container_gettingstarted_tutorial"><h2 class="topictitle2" id="d75631e2433">指導教學：建立單一容器 Web 應用程式</h2>
<div class="body tutorialBody"><p class="shortdesc"><span class="keyword">IBM
Bluemix</span> 可讓您在公用雲端中執行 Docker 容器。使用容器來部署自給自足的安全 Web 應用程式，這些 Web 應用程式可獨立於主機作業系統而執行。容器是輕量型，而且不需要大量系統資源，因為容器使用相同的系統核心，因此執行效率高於虛擬機器。本指導教學示範如何在 <span class="keyword">Bluemix</span> 中使用 Docker 容器來建置傳訊 Web 應用程式。
在此程序中，您將撰寫 Dockerfile、將 Docker 映像檔新增至專用 <span class="keyword">Bluemix</span> 映像檔登錄，以及將容器鏈結在一起。</p>
<div class="section tutorialDesc"></div><section class="section learningObjectives tutorialLearningObjectives" role="region" aria-labelledby="d75631e2500"><h3 class="sectiontitle" id="d75631e2500">目標</h3>
<p>在此情境中，您將在 <span class="keyword">Bluemix</span> 空間中建立稱為 Let's Chat 的 Web 應用程式。Let's Chat 是一個專為小型開發團隊所設計的線上傳訊應用程式。使用 <span class="keyword">Bluemix</span>，您可以管理專用 Docker 映像檔登錄，以及部署 Web 應用程式以供公開存取。</p>

<figure class="fignone" id="container_gettingstarted_tutorial__getting_started_tutorial"><figcaption>圖 1. 執行中 Web 應用程式的架構</figcaption><div class="image"><object width="480" data="images/getting_started_tutorial.svg"><img width="480" src="images/getting_started_tutorial.jpg" alt="Let's Chat 指導教學圖表"></object></div></figure>

<div class="p">此情境提供下列作業的指示：<ul><li>設定 <span class="keyword">Bluemix</span> 帳戶</li>
<li>設定 <span class="keyword">IBM
Bluemix Container Service</span> 指令行介面</li>
<li>建立 Dockerfile</li>
<li>將映像檔推送至專用 <span class="keyword">Bluemix</span> 映像檔登錄</li>
<li>鏈結兩個容器，這會建立容器之間的網路連線</li>
<li>建置可公開存取的容器</li>
</ul>
</div>
</section>
<section class="section timeRequired tutorialTimeRequired" role="region" aria-labelledby="d75631e2553"><h3 class="sectiontitle" id="d75631e2553">所需時間</h3>45 分鐘</section>
<section role="region" aria-labelledby="d75631e2557"><h3 class="sectiontitle" id="d75631e2557">適用對象</h3>
<p>本指導教學適用於不熟悉 <span class="keyword">Bluemix</span> 中的 Docker 容器而且想要瞭解如何在 <span class="keyword">Bluemix</span> 公用雲端中部署執行中應用程式的使用者。</p>
</section></div>
<article class="topic task tutorialLesson nested2" role="article" aria-labelledby="d75631e2571" lang="zh-tw" id="container_gettingstarted_tutorial_lesson_1"><h3 class="topictitle3" id="d75631e2571">課程 1：設定 <span class="keyword">IBM
Bluemix Container Service</span></h3>
<div class="body taskbody"><p class="shortdesc">在本課程中，您將會建立 <span class="keyword">Bluemix</span> 帳戶、安裝 <span class="keyword">IBM
Bluemix Container Service</span> CLI、登入帳戶，以及檢閱預設 IBM 映像檔。</p>
<ol class="steps"><li class="step stepexpand"><span class="cmd">移至 <a href="https://console.ng.bluemix.net/registration/" rel="external" target="_blank" title="（在新分頁或視窗中開啟）"><span class="keyword">Bluemix</span> 登錄頁面</a>，以建立帳戶。</span> 請記下您的使用者名稱及密碼，因為稍後需要這項資訊。</li>
<li class="step stepexpand"><span class="cmd">從 <a href="https://github.com/cloudfoundry/cli/releases" rel="external" target="_blank" title="（在新分頁或視窗中開啟）">GitHub 儲存庫</a>安裝 Cloud Foundry CLI <span class="ph">Cloud Foundry CLI <span class="ph" id="container_gettingstarted_tutorial_lesson_1__d28109e290">6.14.0</span> 版 - 6.22.0</span> 版。</span> 您必須在作業系統的預設位置中安裝 Cloud Foundry CLI，否則 PATH 環境變數不會符合您的安裝目錄。 <div class="steps note"><span class="notetitle">註：</span> MacOS Sierra 使用者必須安裝 Cloud Foundry CLI 6.22.0 版或更新版本。</div>


<div class="p">若要驗證已適當地安裝 Cloud Foundry CLI，或如果已安裝 Cloud Foundry CLI，要檢查安裝的版本，請執行下列指令：<pre class="codeblock"><code>cf -v</code></pre>
</div>
</li>
<li class="step stepexpand"><span class="cmd">從 Docker 網站<a href="https://www.docker.com/products/docker" rel="external" target="_blank" title="（在新分頁或視窗中開啟）">安裝 Docker 1.10.0 或更新版本</a>。</span></li>
<li class="step stepexpand"><span class="cmd">開啟 Docker 終端機。</span> 如果您要使用 Docker Toolbox for Windows 或 OS X，請開啟稱為 Docker Quickstart Terminal 的程式。</li>
<li class="step stepexpand"><span class="cmd">安裝 <a href="https://clis.ng.bluemix.net/ui/home.html" rel="external" target="_blank" title="（在新分頁或視窗中開啟）"><span class="keyword">Bluemix</span> CLI</a>。</span></li>
<li class="step stepexpand"><span class="cmd" id="container_gettingstarted_tutorial_lesson_1__d28109e326">安裝 <span class="keyword">IBM
Bluemix Container Service</span> 外掛程式。</span> <pre class="codeblock" id="container_gettingstarted_tutorial_lesson_1__d28109e337"><code><span class="ph">bx</span> plugin install IBM-Containers -r <span class="ph" data-hd-audience="yellow"><var class="keyword varname">Bluemix</var></span></code></pre>
 <div class="p">若要驗證已適當安裝外掛程式，請執行下列指令：<pre class="codeblock"><code><span class="ph">bx</span> plugin list</code></pre>
</div>


<p>在結果中，外掛程式會顯示為 IBM-Containers。</p>
</li>
<li class="step stepexpand"><span class="cmd">既然，您已安裝 <span class="keyword">IBM
Bluemix Container Service</span> 外掛程式，請在 Docker 終端機中執行 <samp class="ph codeph">docker run hello-world</samp>。</span> <pre class="codeblock"><code>docker run hello-world</code></pre>
 這會驗證已正確設定 Docker 配置。Docker 會尋找本端映像檔，因此，如果這是您第一次執行這個指令，將會看到下列訊息：

<pre class="pre screen"><code>Unable to find image 'hello-world:latest' locally</code></pre>
映像檔是取自 Docker Hub（映像檔的公用儲存庫），而且，在指令完成之後，您的輸出會類似下列內容：
<pre class="pre screen"><code>$ docker run hello-world

Hello from Docker.
This message shows that your installation appears to be working correctly.

To generate this message, Docker took the following steps:
 1. The Docker client contacted the Docker daemon.
 2. The Docker daemon pulled the <span class="q">"hello-world"</span> image from the Docker Hub.
 3. The Docker daemon created a new container from that image which runs the
    executable that produces the output you are currently reading.
 4. The Docker daemon streamed that output to the Docker client, which sent it
    to your terminal.

To try something more ambitious, you can run an Ubuntu container with:
 $ docker run -it ubuntu bash

Share images, automate workflows, and more with a free Docker Hub account:
 https://hub.docker.com

For more examples and ideas, visit:
 https://docs.docker.com/userguide/</code></pre>
 如果 hello-world 未執行，請執行 <samp class="ph codeph">docker version</samp> 來確認已正確安裝 Docker。Windows 及 OS X 使用者會確認您執行的是 Docker Quickstart Terminal，而非標準終端機視窗。</li>
<li class="step stepexpand">選擇性的： <span class="cmd">如果這是您第一次使用 <span class="keyword">Bluemix</span>，請指定 API 端點。下列程式碼範例預設為您 <span class="keyword">Bluemix</span> 帳戶的地區，但是您可以手動變更地區。</span> <pre class="codeblock"><code>bx api https://api.<var class="keyword varname" data-hd-keyref="DomainName">domain_name</var></code></pre>
</li>
<li class="step stepexpand"><span class="cmd">現在，登入您的 <span class="keyword">Bluemix</span> 帳戶。</span> 輸入您在建立 <span class="keyword">Bluemix</span> 帳戶時指定的電子郵件及密碼。必要的話，請在系統提示時選取您偏好的組織及空間。
<pre class="codeblock"><code>bx login [-sso]</code></pre>
<span class="ph">當您使用聯合 ID 登入時，需要單一登入參數 <span class="keyword option">--sso</span>。如果使用此選項，請開啟 <a href="https://login.ng.bluemix.net/UAALoginServerWAR/passcode" rel="external" target="_blank" title="（在新分頁或視窗中開啟）">https://login.ng.bluemix.net/UAALoginServerWAR/passcode</a> 以取得一次性密碼。如果您未併入 <span class="keyword option">--sso</span> 選項，請完成下列子步驟。</span><ol type="a" class="ol substeps"><li class="li substep"><span class="cmd">對於<span class="ph uicontrol">電子郵件</span>，輸入 <span class="keyword">Bluemix</span> 的 IBM ID。</span></li>
<li class="li substep"><span class="cmd">對於<span class="ph uicontrol">密碼</span>，輸入 IBM ID 的密碼。</span> 即會擷取您的 Bluemix 組織及空間。</li>
<li class="li substep"><span class="cmd">輸入代表其中一個 <span class="keyword">Bluemix</span> 組織的號碼。</span></li>
<li class="li substep"><span class="cmd">輸入代表其中一個現有 <span class="keyword">Bluemix</span> 空間的號碼。</span></li>
</ol>
</li>
<li class="step stepexpand"><span class="cmd">建立名稱空間。</span> 組織的名稱空間是您的容器映像檔登錄在 <span class="keyword">Bluemix</span> 地區中的唯一 ID。請將名稱空間視為區分您的 <span class="keyword">Bluemix</span> 映像檔登錄與 IBM 公用雲端的所有其他映像檔登錄的方式。<div class="steps note"><span class="notetitle">註：</span> 如果您或任何其他使用者曾經登入 <span class="keyword">Bluemix</span> 組織並建立容器，則您已經有名稱空間。若要找出其值，您可以執行下列指令：
<pre class="codeblock"><code><samp class="ph codeph"><span class="ph">bx ic</span> namespace-get</samp></code></pre>
</div>
 <div class="p">以下是建立名稱空間的若干提示：
<ul><li>您的名稱空間必須是唯一的。IBM 公用雲端的同一地區中的任何其他組織都不得使用該名稱。</li>
<li>您的名稱空間可以是 4-30 個字元，而且只能包含小寫字母、數字或底線 (_)。</li>
<li>保持簡短的名稱空間。如果您使用指令行，在標記及推送映像檔時，將會經常鍵入名稱空間。</li>
</ul>
</div>


<p>在下列指令中，將 <var class="keyword varname">your_registry_name_here</var> 取代為您選擇的名稱空間：</p>
 <pre class="codeblock"><code><span class="ph"><samp class="ph codeph">bx ic</samp></span> namespace-set <var class="keyword varname">your_registry_name_here</var></code></pre>
</li>
<li class="step stepexpand">選擇性的： <span class="cmd">設定您名稱空間的變數。</span> 在本指導教學中，範例指令將包含 <samp class="ph codeph">$your_namespace</samp> 字串來顯示名稱空間的放置位置。若要避免手動編輯這些指令，請在終端機中建立變數。 <pre class="codeblock"><code>your_namespace=<var class="keyword varname">your_registry_name_here</var></code></pre>
 使用 <samp class="ph codeph">ljenkins1</samp> 作為使用者名稱空間的範例 <pre class="pre screen"><code>$ your_namespace=<var class="keyword varname">ljenkins1</var></code></pre>
</li>
<li class="step stepexpand"><span class="cmd">起始設定 <span class="keyword">IBM
Bluemix Container Service</span>。</span> <pre class="codeblock"><code><span class="ph"><samp class="ph codeph">bx ic</samp></span> init</code></pre>
</li>
<li class="step stepexpand"><span class="cmd">現在，您已登入 <span class="keyword">IBM
Bluemix Container Service</span>，我們將移出您可以使用的預設映像檔。</span> <pre class="codeblock"><code><span class="ph"><samp class="ph codeph">bx ic</samp></span> images</code></pre>


<pre class="pre screen"><code>$ <span class="ph"><samp class="ph codeph">bx ic</samp></span> images
REPOSITORY                                        TAG                 IMAGE ID            CREATED             SIZE
registry.ng.bluemix.net/ibm-mobilefirst-starter   latest              d61c09fd0af7        4 weeks ago         510.2 MB
registry.ng.bluemix.net/ibm-node-strong-pm        latest              322b9ca7b2dc        2 weeks ago         255.5 MB
registry.ng.bluemix.net/ibmliberty                latest              33fdda9431c7        2 days ago          292.5 MB
registry.ng.bluemix.net/ibmnode                   latest              c33c25d4af3b        2 days ago          187.8 MB
registry.ng.bluemix.net/ibmnode                   v4                  c33c25d4af3b        2 days ago          187.8 MB
registry.ng.bluemix.net/ibmnode                   v1.1                ef3425f90e1e        2 days ago          175.3 MB
registry.ng.bluemix.net/ibmnode                   v1.2                c5546bf5e891        2 days ago          183.6 MB</code></pre>


<div class="tablenoborder"><table summary="" id="container_gettingstarted_tutorial_lesson_1__table_lqp_hkm_2v" class="defaultstyle"><caption><span class="tablecap">表 3. 進一步瞭解映像檔及容器</span></caption><thead><tr><th colspan="2" id="d75631e2965" class="thleft"><span class="ph"><img src="images/idea.png" alt="此圖示指出還有相關資訊可讓您瞭解該作業的這個步驟。"></span> 深入瞭解映像檔及容器</th>
</tr>
</thead>
<tbody><tr><td style="width: NaN%" headers="d75631e2965 ">映像檔與容器</td>
<td style="width: NaN%" headers="d75631e2965 "><p> 因此，映像檔與容器有何差異？基本上，映像檔是已定義層及指令的唯讀 Snapshot。只有在您執行映像檔之後，它才會變成容器。此處理程序的其中一個優點是，不論您對容器進行哪些變更，映像檔 Snapshot 都會保持不變。單一容器是設計為暫時處理程序。需要跨容器持續保存的配置或資料，必須寫入至映像檔或儲存在持續性磁區中。請參閱 Docker 名詞解釋中的<a href="https://docs.docker.com/glossary/?term=image" rel="external" target="_blank" title="（在新分頁或視窗中開啟）">映像檔定義</a>。</p>
</td>
</tr>
<tr><td style="width: NaN%" headers="d75631e2965 ">IBM 映像檔</td>
<td style="width: NaN%" headers="d75631e2965 "><p>在此指導教學中，您是使用 Docker Hub 中的映像檔。不過，IBM 也提供四個映像檔 "Snapshot"，您可以用來自行建置映像檔，或用來執行容器。請在這裡閱讀 <a href="container_images_adding_ov.html#container_images_adding_ov" title="容器映像檔是您建立的每個容器的基礎。映像檔是從 Dockerfile 建立的，Dockerfile 檔案中包含建置映像檔以及建置構件（例如應用程式、應用程式的配置及其相依關係）的指示。請將容器映像檔想像成執行檔（.exe 或 .bin）。執行這個可執行的應用程式檔案之後，即會建立應用程式的實例。當您執行容器時，會從映像檔建立容器實例。">IBM 映像檔</a>。</p>
</td>
</tr>
</tbody>
</table>
</div>
</li>
</ol>
<div class="section result"><p>恭喜！您已順利建立 Bluemix 帳戶、已安裝 CLI 外掛程式，並已登入來查看您可以用來建置 Web 應用程式的映像檔。</p>

<p>若要將映像檔新增至您的登錄，請繼續進行下一個課程。</p>
</div></div>
</article><article class="topic task tutorialLesson nested2" role="article" aria-labelledby="d75631e3005" lang="zh-tw" id="container_gettingstarted_tutorial_lesson_2"><h3 class="topictitle3" id="d75631e3005">課程 2：將映像檔新增至專用 <span class="keyword">Bluemix</span> 映像檔登錄</h3>
<div class="body taskbody"><p class="shortdesc">在本課程中，您使用兩種方法，將映像檔新增至您的專用映像檔登錄：複製 Docker Hub 中的映像檔，以及建立 Dockerfile。自行建立 Dockerfile，可讓您將自己的指令新增至映像檔。因此，每個從該映像檔啟動的容器都會包含這些指令。
容器的其中一個優點，是這些映像檔可協助您維護來源控制，讓您組織中的所有人都可以建置具有一致作業環境的容器。</p>
<div class="section context">本課程中使用下列映像檔。您可以檢閱映像檔的 Dockerfile，以及 Docker Hub 的其他資訊。<ul><li><a href="https://hub.docker.com/_/mongo/" rel="external" target="_blank" title="（在新分頁或視窗中開啟）">MongoDB</a></li>
<li><a href="https://hub.docker.com/r/sdelements/lets-chat/" rel="external" target="_blank" title="（在新分頁或視窗中開啟）">讓我們來聊一聊</a></li>
</ul>
</div><ol class="steps"><li class="step stepexpand"><span class="cmd">將 MongoDB 映像檔從 Docker Hub 複製到您的專用 <span class="keyword">Bluemix</span> 映像檔登錄。</span> MongoDB 映像檔是用來儲存資料。即使 MongoDB 容器可以用來儲存資料，但是移除容器時，任何寫入至容器的資料還是會遺失。若要持續保存任何寫入至容器的資料，您必須在執行容器時裝載磁區。 <p>如果您未設定變數取代，請記得將 <samp class="ph codeph"><var class="keyword varname">$your_namespace</var></samp> 取代為您在課程 1 中建立的名稱空間。如果您需要確認您的名稱空間為何，請執行 <samp class="ph codeph"><span class="ph"><samp class="ph codeph">bx ic</samp></span> namespace get</samp>。</p>
 <pre class="codeblock"><code><span class="ph"><samp class="ph codeph">bx ic</samp></span> cpi <var class="keyword varname">mongo</var> registry.<var class="keyword varname" data-hd-keyref="DomainName">domain_name</var>/<var class="keyword varname">$your_namespace</var>/<var class="keyword varname">mongo</var></code></pre>
 起始輸出程式碼與這個範例類似。
<pre class="pre screen"><code>$ <span class="ph"><samp class="ph codeph">bx ic</samp></span> cpi mongo registry.<var class="keyword varname" data-hd-keyref="DomainName">domain_name</var>/<var class="keyword varname">$your_namespace</var>/<var class="keyword varname">mongo</var>
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM mongo
 ---&gt; 32427ae49eff
Successfully built 32427ae49eff
The push refers to a repository [registry.<var class="keyword varname" data-hd-keyref="DomainName">domain_name</var>/<var class="keyword varname">$your_namespace</var>/<var class="keyword varname">mongo</var>] (len: 1)</code></pre>
 在背景中，正在將 mongo 映像檔從 Docker Hub 複製到 Bluemix 映像檔登錄。<samp class="ph codeph">cpi</samp> 指令可能需要幾分鐘的時間才能完成，而且完成時，完整輸出會與下列範例類似。
<pre class="pre screen"><code>$ <span class="ph"><samp class="ph codeph">bx ic</samp></span> cpi mongo registry.<var class="keyword varname" data-hd-keyref="DomainName">domain_name</var>/<var class="keyword varname">$your_namespace</var>/<var class="keyword varname">mongo</var>
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM mongo
 ---&gt; 32427ae49eff
Successfully built 32427ae49eff
The push refers to a repository [registry.<var class="keyword varname" data-hd-keyref="DomainName">domain_name</var>/<var class="keyword varname">$your_namespace</var>/<var class="keyword varname">mongo</var>] (len: 1)
32427ae49eff: Pushed
424ec4bd7fc4: Pushed
9e3490ec0722: Pushed
166aa7bca9c1: Pushed
c79deeebd6f0: Pushed
c181e50c0e8b: Pushed
438e27bd44bf: Pushed
af6f43fa45bb: Pushed
605e5767a4ac: Pushed
33e8076f6b28: Pushed
e63969171eec: Pushed
latest: digest: sha256:ab092d78d331337cf6cf0ceeda28489f5e154b1403ca1220e9de6b417
b7cfb95 size: 32158</code></pre>
 <div class="tablenoborder"><table summary="" id="container_gettingstarted_tutorial_lesson_2__table_sdf_nkm_2v" class="defaultstyle"><thead><tr><th colspan="2" id="d75631e3173" class="thleft"><span class="ph"><img src="images/idea.png" alt="此圖示指出還有相關資訊可讓您瞭解該作業的這個步驟。"></span> 瞭解此指令的元件</th>
</tr>
</thead>
<tbody><tr><td style="width: NaN%" headers="d75631e3173 "><samp class="ph codeph">cpi</samp></td>
<td style="width: NaN%" headers="d75631e3173 ">copy 指令。</td>
</tr>
<tr><td style="width: NaN%" headers="d75631e3173 "><samp class="ph codeph">mongo</samp></td>
<td style="width: NaN%" headers="d75631e3173 ">來源儲存庫及名稱。在此情況下，映像檔的名稱是 <var class="keyword varname">mongo</var>，而且不需要進行任何進一步儲存庫定義，因為映像檔位於 Docker Hub 中。</td>
</tr>
<tr><td style="width: NaN%" headers="d75631e3173 "><samp class="ph codeph">registry.<var class="keyword varname" data-hd-keyref="DomainName">domain_name</var>/<var class="keyword varname">$your_namespace</var>/<var class="keyword varname">mongo</var></samp></td>
<td style="width: NaN%" headers="d75631e3173 ">目的地登錄路徑，內含您的唯一名稱空間和目的地映像檔名稱。在此範例中，我們會將映像檔的名稱保持為 <var class="keyword varname">mongo</var>，但您可以在專用登錄中為映像檔選擇任何名稱。在 CLI 中處理此映像檔時，請指定完整路徑的映像檔：
<samp class="ph codeph">registry.<var class="keyword varname" data-hd-keyref="DomainName">domain_name</var>/<var class="keyword varname">$your_namespace</var>/<var class="keyword varname">mongo</var></samp></td>
</tr>
</tbody>
</table>
</div>
</li>
<li class="step stepexpand"><span class="cmd">建立並導覽至您 Dockerfile 的新本端資料夾。</span> 既然您已透過 <samp class="ph codeph">cpi</samp> 指令將映像檔新增至登錄，則接著將透過 Dockerfile 建立另一個映像檔。Dockerfile 可讓您在本端建置映像檔，並可讓您新增 Web 應用程式所需的任何其他指令或變數。在容器建置期間，可以新增其中的一些指令，但這可能會因相同映像檔的多個版本而造成片段化。將指令新增至 Dockerfile，可確保透過此映像檔所建置的每個容器都包含這些指令。 <pre class="codeblock"><code>mkdir wrapper &amp;&amp; cd wrapper</code></pre>
</li>
<li class="step stepexpand"><span class="cmd">在 <span class="ph filepath">wrapper</span> 資料夾內建立 Dockerfile。</span> 此指令會建立 Dockerfile，並新增所有 Dockerfile 中都需要的指定 <var class="keyword varname">FROM</var> 指令。<var class="keyword varname">FROM</var> 指出主映像檔。
在此情況下，我們使用 <var class="keyword varname">lets-chat</var> 映像檔作為母項。 <pre class="codeblock"><code>echo <span class="q">"FROM sdelements/lets-chat:latest"</span> &gt; Dockerfile</code></pre>
</li>
<li class="step stepexpand"><span class="cmd">列出您現行目錄中的檔案，確認已建立 Dockerfile。</span> <pre class="codeblock"><code>ls</code></pre>
</li>
<li class="step stepexpand"><span class="cmd">將網路延遲指令新增至 Dockerfile。</span> lets-chat 容器啟動時，<span class="keyword">IBM
Bluemix Container Service</span> 會設定專用容器網路，並將專用 IP 位址指派給容器。lets-chat 應用程式在應用程式啟動時需要作用中的網路連線。新增網路延遲可確保在啟動應用程式之前，<span class="keyword">IBM
Bluemix Container Service</span> 網路設定有足夠的時間來完成。 <pre class="codeblock"><code>echo <span class="q">"CMD (sleep 60; npm start)"</span> &gt;&gt; Dockerfile</code></pre>
</li>
<li class="step stepexpand"><span class="cmd">建置及標記您的映像檔。</span> 請不要忘記指令結尾的 <samp class="ph codeph">.</samp>！這個句點告訴 Docker 要查看您的現行本端資料夾以尋找需要的 Dockerfile。 <pre class="codeblock"><code><span class="ph"><samp class="ph codeph">bx ic</samp></span> build -t registry.<var class="keyword varname" data-hd-keyref="DomainName">domain_name</var>/<var class="keyword varname">$your_namespace</var>/lets-chat。</code></pre>
</li>
<li class="step stepexpand"><span class="cmd">確認 <var class="keyword varname">mongo</var> 映像檔及 <var class="keyword varname">lets-chat</var> 映像檔位於您的 <span class="keyword">Bluemix</span> 映像檔登錄。</span> <pre class="codeblock"><code><span class="ph"><samp class="ph codeph">bx ic</samp></span> images</code></pre>


<pre class="pre screen"><code>$ <span class="ph"><samp class="ph codeph">bx ic</samp></span> images
REPOSITORY                                                  TAG                 IMAGE ID            CREATED             SIZE
registry.<var class="keyword varname" data-hd-keyref="DomainName">domain_name</var>/<var class="keyword varname">$your_namespace</var>/<var class="keyword varname">mongo</var>                          latest              8de059ee71fc        2 minutes ago         317.4 MB
registry.<var class="keyword varname" data-hd-keyref="DomainName">domain_name</var>/<var class="keyword varname">$your_namespace</var>/<var class="keyword varname">lets-chat </var>                      latest              d4de00f58363        5 minutes ago          0 B
registry.<var class="keyword varname" data-hd-keyref="DomainName">domain_name</var>/ibm-node-strong-pm                  latest              322b9ca7b2dc        2 weeks ago         616.4 MB
registry.<var class="keyword varname" data-hd-keyref="DomainName">domain_name</var>/ibmliberty                          latest              6595ea483bf5        2 weeks ago         552.8 MB
registry.<var class="keyword varname" data-hd-keyref="DomainName">domain_name</var>/ibmnode                             latest              b2c351248227        2 weeks ago         472.4 MB
registry.<var class="keyword varname" data-hd-keyref="DomainName">domain_name</var>/ibmnode                             v4                  b2c351248227        2 weeks ago         472.4 MB
registry.<var class="keyword varname" data-hd-keyref="DomainName">domain_name</var>/ibmnode                             v1.1                7d11220193d6        2 weeks ago         449.2 MB
registry.<var class="keyword varname" data-hd-keyref="DomainName">domain_name</var>/ibmnode                             v1.2                84efce0c747b        2 weeks ago         465.2 MB</code></pre>
</li>
</ol>
<div class="section result"><p>現在，必要的映像檔位於您的專用 <span class="keyword">Bluemix</span> 映像檔登錄！您已順利複製 Docker Hub 映像檔，以及已建立 Dockerfile、已建置新的映像檔，並將該映像檔推送至 <span class="keyword">Bluemix</span> 映像檔登錄。</p>

<p>在下一個課程中，您會建立容器、將它們鏈結在一起，以及部署 Web 應用程式。</p>
</div></div>
</article><article class="topic task tutorialLesson nested2" role="article" aria-labelledby="d75631e3386" lang="zh-tw" id="container_gettingstarted_tutorial_lesson_3"><h3 class="topictitle3" id="d75631e3386">課程 3：建置及部署容器</h3>
<div class="body taskbody"><p class="shortdesc">您的 <span class="keyword">Bluemix</span> 映像檔登錄中具有部署 Let's Chat 傳訊 Web 應用程式所需的映像檔。在本課程中，您將建置容器、將它們鏈結在一起，以及將公用 IP 位址指派給應用程式。</p>
<ol class="steps"><li class="step stepexpand"><span class="cmd">從 mongo 映像檔執行容器。</span> <pre class="codeblock"><code><span class="ph"><samp class="ph codeph">bx ic</samp></span> run --name <var class="keyword varname">lc-mongo</var> -p <var class="keyword varname">27017</var> -m <var class="keyword varname">128</var> registry.<var class="keyword varname" data-hd-keyref="DomainName">domain_name</var>/<var class="keyword varname">$your_namespace</var>/mongo</code></pre>
 <div class="tablenoborder"><table summary="" id="container_gettingstarted_tutorial_lesson_3__table_lqp_hkm_2v" class="defaultstyle"><thead><tr><th colspan="2" id="d75631e3473" class="thleft"><span class="ph"><img src="images/idea.png" alt="此圖示指出還有相關資訊可讓您瞭解該作業的這個步驟。"></span> 瞭解此指令的元件</th>
</tr>
</thead>
<tbody><tr><td style="width: 22.22222222222222%" headers="d75631e3473 ">run</td>
<td style="width: 77.77777777777779%" headers="d75631e3473 "><p> 透過指定的映像檔建立容器的 run 指令。</p>
</td>
</tr>
<tr><td style="width: 22.22222222222222%" headers="d75631e3473 ">--name</td>
<td style="width: 77.77777777777779%" headers="d75631e3473 ">定義容器的名稱。在此情況下，我們將容器命名為 <var class="keyword varname">lc-mongo</var>。</td>
</tr>
<tr><td style="width: 22.22222222222222%" headers="d75631e3473 ">-p</td>
<td style="width: 77.77777777777779%" headers="d75631e3473 "><span class="ph">如果您要讓使用者可從網際網路存取您的應用程式，則必須公開公用埠。當您公開公用埠時，會建立容器的「公用網路安全群組」，讓您可以僅透過公開埠傳送及接收公用資料。所有其他公用埠都會關閉，因此無法用來從網際網路存取應用程式。您可以利用多個 <span class="keyword option">-p</span> 選項來包含多個埠。無法對映或轉遞埠。如果您未公開埠，則只能從專用容器網路存取容器。您可以使用已指派的專用 IP 位址來與專用網路上的容器進行通訊。</span> 在此情況下，我們將公開埠 27017，因為 Dockerfile 中已指定該埠。</td>
</tr>
<tr><td style="width: 22.22222222222222%" headers="d75631e3473 ">-m</td>
<td style="width: 77.77777777777779%" headers="d75631e3473 "><span class="ph">輸入容器的記憶體限制 (MB)。記憶體限制是容器大小的一部分，它定義容器在執行時可在運算主機上取得的記憶體及磁碟空間數量上限。指派容器大小之後，即無法變更其值。</span></td>
</tr>
</tbody>
</table>
</div>
</li>
<li class="step stepexpand"><span class="cmd">確認容器在執行中。</span> 請等待狀態更新為執行中，然後再繼續下一步。必要的話，在容器狀態為執行中之前，您可以執行 <samp class="ph codeph"><span class="ph"><samp class="ph codeph">bx ic</samp></span> ps</samp>。 <pre class="codeblock"><code><span class="ph"><samp class="ph codeph">bx ic</samp></span> ps</code></pre>


<pre class="pre screen"><code>$<span class="ph"><samp class="ph codeph">bx ic</samp></span> ps
CONTAINER ID        IMAGE                                           COMMAND             CREATED             STATUS                PORTS               NAMES
9f73abc2-9a1        registry.<var class="keyword varname" data-hd-keyref="DomainName">domain_name</var>/<var class="keyword varname">$your_namespace</var>/<var class="keyword varname">mongo</var>:latest       ""                  40 seconds ago          Running 5 seconds ago    27017/tcp           lc-mongo</code></pre>
</li>
<li class="step stepexpand"><span class="cmd">在 <var class="keyword varname">mongo</var> 容器為執行中之後，請執行 <var class="keyword varname">lets-chat</var> 容器。</span> <pre class="codeblock"><code><span class="ph"><samp class="ph codeph">bx ic</samp></span> run --name <var class="keyword varname">lets-chat</var> --link lc-mongo:mongo -p <var class="keyword varname">8080</var> -m <var class="keyword varname">128</var> registry.<var class="keyword varname" data-hd-keyref="DomainName">domain_name</var>/<var class="keyword varname">$your_namespace</var>/<var class="keyword varname">lets-chat</var></code></pre>
 <div class="tablenoborder"><table summary="" id="container_gettingstarted_tutorial_lesson_3__table_o22_ttv_4x" class="defaultstyle"><thead><tr><th colspan="2" id="d75631e3581" class="thleft"><span class="ph"><img src="images/idea.png" alt="此圖示指出還有相關資訊可讓您瞭解該作業的這個步驟。"></span> 瞭解此指令的元件</th>
</tr>
</thead>
<tbody><tr><td style="width: 22.22222222222222%" headers="d75631e3581 ">--link</td>
<td style="width: 77.77777777777779%" headers="d75631e3581 "><p>將資料庫容器（如 <samp class="ph codeph">lc-mongo</samp>）鏈結至另一個容器，是 <samp class="ph codeph">--link</samp> 的其中一種常見用法。<samp class="ph codeph">--link</samp> 旗標會在 <var class="keyword varname">lc-mongo</var> 容器的 <var class="keyword varname">lets-chat</var> 容器上建立一個主機項目，以容許容器彼此通訊。</p>
</td>
</tr>
</tbody>
</table>
</div>
</li>
<li class="step stepexpand"><span class="cmd">檢視您的容器。</span> <pre class="codeblock"><code><span class="ph"><samp class="ph codeph">bx ic</samp></span> ps</code></pre>


<pre class="pre screen"><code>$<span class="ph"><samp class="ph codeph">bx ic</samp></span> ps
CONTAINER ID        IMAGE                                           COMMAND             CREATED             STATUS                  PORTS                         NAMES
68f6536a-82f        registry.<var class="keyword varname" data-hd-keyref="DomainName">domain_name</var>/<var class="keyword varname">$your_namespace</var>/<var class="keyword varname">lets-chat</var>:latest   ""                  3 days ago          Running 6 seconds ago   8080/tcp                      <var class="keyword varname">lets-chat</var>
9f73abc2-9a1        registry.<var class="keyword varname" data-hd-keyref="DomainName">domain_name</var>/<var class="keyword varname">$your_namespace</var>/<var class="keyword varname">mongo</var>:latest       ""                  3 days ago          Running 3 days ago      27017/tcp                     <var class="keyword varname">lc-mongo</var></code></pre>
</li>
<li class="step stepexpand"><span class="cmd">列出可用的 IP 位址。</span> 連結 IP 位址，可容許透過網際網路存取您的單一容器 Web 應用程式。 <pre class="codeblock"><code><span class="ph"><samp class="ph codeph">bx ic</samp></span> ips</code></pre>
</li>
<li class="step stepexpand">選擇性的： <span class="cmd">如果未列出任何 IP 位址，請要求一個 IP 位址。</span> <pre class="codeblock"><code><span class="ph"><samp class="ph codeph">bx ic</samp></span> ip-request</code></pre>
</li>
<li class="step stepexpand"><span class="cmd">選擇可用的 IP 位址，將它連結至 <var class="keyword varname">lets-chat</var> 容器。</span> 請注意，如果所有 IP 位址都已連結，您需要先<a href="container_cli_reference_cfic.html#container_cli_reference_cfic__ip_unbind">取消連結 IP 位址</a>。請將此範例 IP 位址取代為您可在 Bluemix 組織中使用的 IP 位址。 <pre class="codeblock"><code><span class="ph"><samp class="ph codeph">bx ic</samp></span> ip-bind <var class="keyword varname">192.0.2.100</var> lets-chat</code></pre>
</li>
<li class="step stepexpand"><span class="cmd">等待完成連結 IP 位址。</span> <pre class="codeblock"><code><span class="ph"><samp class="ph codeph">bx ic</samp></span> inspect lets-chat</code></pre>
只要 IP 位址連結至您的容器，就會在 CLI 輸出的 <span class="ph uicontrol">Networks</span> 區段中列出為 <span class="ph uicontrol">PublicIpAddress</span>。
<pre class="pre screen"><code><span class="ph"><samp class="ph codeph">bx ic</samp></span> inspect lets-chat
...
"PortMapping": null,
"Ports": {
    "8080/tcp": [
      {
         "HostIp": "192.0.2.100",
         "HostPort": "8080"
      }
    ]
 },
 "PublicIpAddress": "192.0.2.100"
...</code></pre>
</li>
<li class="step stepexpand"><span class="cmd">查看已啟動並執行的 Web 應用程式！將已連結的公用 IP 位址貼入 Web 瀏覽器（包括埠）。</span> <pre class="codeblock"><code>http://<var class="keyword varname">192.0.2.100</var>:8080</code></pre>
 <p><img src="images/lets-chat_screenshot.jpg" alt="登入 Let's Chat Web 應用程式。"></p>
</li>
<li class="step stepexpand">選擇性的： <span class="cmd">在 Let's Chat 中建立帳戶，登入以查看 Web 應用程式正在 IBM Containers 中執行！</span> <p><img src="images/lets-chat-room.png" alt="lets-chat room"></p>
</li>
<li class="step stepexpand">選擇性的： <span class="cmd">停止您的容器。</span> 如果您不希望容器耗用資源，可以將它們停止並移除。 <pre class="codeblock"><code><span class="ph"><samp class="ph codeph">bx ic</samp></span> stop <var class="keyword varname">lets-chat</var> <var class="keyword varname">lc-mongo</var></code></pre>


<pre class="codeblock"><code><span class="ph"><samp class="ph codeph">bx ic</samp></span> rm <var class="keyword varname">lets-chat</var> <var class="keyword varname">lc-mongo</var></code></pre>
</li>
</ol>
<div class="section result" id="container_gettingstarted_tutorial_lesson_3__quiz">測試一下您學到的知識！您現在已完成指導教學，請<a href="https://bluemix-doc-quizzes.mybluemix.net/containers/gettingstarted_tutorial/quiz.html" rel="external" target="_blank" title="（在新分頁或視窗中開啟）">進行隨堂測驗來了解您的學習成果</a>。</div><div class="section postreq"><div class="p"> 下一步為何？有許多其他 <span class="keyword">IBM
Bluemix Container Service</span> 特性可以套用至此指導教學：<ul><li>嘗試將單一容器取代為<a href="container_ha.html#container_group_ui" title="從 Bluemix GUI 建立及部署可擴充群組容器。容器群組包含兩個以上執行相同映像檔的容器。對於執行具有需要可擴充性及可靠性之工作負載的長期服務，或是進行所需規模的測試，都可以使用容器群組。">高度可用的容器群組</a>，並啟用自動回復以自動取代無法使用的容器</li>
<li>建立<a href="container_volumes_ov.html#container_volumes_ui" title="磁區是一個持續性的儲存位置，用來存放應用程式所建立的資料，或是應用程式執行所需的檔案。 您可以從 Bluemix GUI 建立容器的磁區。">儲存磁區</a>，並將其裝載至 mongo 及 lets-chat 容器，讓容器資料可以跨容器重新啟動持續保存，以及供專用網路中的多個容器進行存取</li>
<li>檢閱<a href="va/va_index.html#va_reviewing">漏洞警告器</a>中的映像檔，透過掃描登錄中的映像檔以尋找潛在漏洞來協助保持組織安全</li>
</ul>
… 等等。馬上就開始使用吧。</div>
</div></div>
</article></article><article class="topic tutorial tutorialIntro nested1" role="article" aria-labelledby="d75631e3803" lang="zh-tw" id="container_compose_intro"><h2 class="topictitle2" id="d75631e3803">指導教學：使用 Docker Compose 及 <span class="keyword">IBM
Bluemix Container Service</span> 建立多容器部署</h2>
<div class="body  tutorialIntroBody"><p class="shortdesc">如果您的應用程式有多個元件（例如資料庫、服務及快取），要將所有容器編排為一起啟動和關閉，可能會是一件很困難的事情。在本指導教學中，您將瞭解如何使用單一 Docker Compose 指令，在微服務架構中將應用程式部署及執行為多容器部署。每一個屬於此系統的容器都是根據 Docker Compose 服務定義，並在自己的隔離環境中執行。</p>
<section class="section learningObjectives tutorialLearningObjectives" role="region" aria-labelledby="d75631e3865"><h3 class="sectiontitle" id="d75631e3865">情境</h3>本指導教學示範軟體開發人員如何使用 Docker Compose 及 <span class="keyword">IBM
Bluemix Container Service</span> 來部署可執行 Lets-Chat Web 應用程式的多容器部署，這個 Web 應用程式鏈結至 Mongo 資料庫，也鏈結至可平衡送入使用者資料流量的 nginx 負載平衡器。<div class="p"><figure class="fignone" id="container_compose_intro__fig_compose"><figcaption>圖 2. 多容器 Lets-Chat 應用程式的目標情境</figcaption><a href="../api/content/containers/images/container_compose_tutorial.png" rel="external" target="_blank" title="（在新分頁或視窗中開啟）"><div class="image"><img src="images/container_compose_tutorial.png" width="700" alt="多容器 Lets-Chat 應用程式的目標情境"></div></a></figure>
</div>
<div class="p">您可以逐步完成這些課程。<dl><dt class="dlterm"><a href="container_single_ui.html#container_compose_config" title="首先，您將在名為 docker-compose.yml 的 YAML 檔案中配置多容器部署的每一個服務。對於每一個服務，指定映像檔、要公開的埠，以及系統中其他服務的鏈結。">課程 1：配置多容器部署</a></dt>
<dd>在名為 <span class="ph filepath">docker-compose.yml</span> 的配置檔中，定義 Lets-Chat Web 應用程式及 Mongo 資料庫的服務。</dd>
<dt class="dlterm"><a href="container_single_ui.html#container_compose_run" title="接下來，您將部署及執行多容器部署。您將使用單一 Docker Compose 指令來根據 docker-compose.yml 檔案中的服務定義建立容器，而不是個別建立及啟動 Lets-Chat 和 Mongo Database 容器，並手動將它們鏈結在一起。">課程 2：執行多容器部署</a></dt>
<dd>使用單一 Docker Compose 指令，在多容器部署上執行 Lets-Chat 應用程式，並從網際網路進行存取。</dd>
<dt class="dlterm"><a href="container_single_ui.html#container_compose_scale" title="在多容器部署目前正在執行的情況下，增加 Lets-Chat 容器實例數目，讓您的應用程式更為可靠。">課程 3：擴充多容器部署</a></dt>
<dd>增加容器實例數目，讓 Lets-Chat Web 應用程式更為可靠。</dd>
<dt class="dlterm"><a href="container_single_ui.html#container_compose_loadbalance" title="若要回應較高的工作負載，請將 nginx 負載平衡器新增至多容器部署，以平衡 Lets-Chat 容器實例之間的送入使用者資料流量。">課程 4：將負載平衡器新增至多容器部署</a></dt>
<dd>在營業時間回應較高的工作負載，方法是將 nginx 負載平衡器新增至多容器部署，以平衡 Lets-Chat 容器實例之間的送入網路資料流量。</dd>
<dt class="dlterm"><a href="container_single_ui.html#container_compose_remove" title="最後一個步驟是移除多容器部署來釋出已使用的資源，並充分利用您的配額。">課程 5：移除多容器部署</a></dt>
<dd>刪除多容器部署以釋出已使用的資源，並充分利用您的配額。</dd>
</dl>
<div class="note tip"><span class="tiptitle">提示：</span> 如果您不熟悉 <span class="keyword">IBM
Bluemix Container Service</span>，請參閱<a href="container_single_ui.html#container_gettingstarted_tutorial" title="IBM Bluemix 可讓您在公用雲端中執行 Docker 容器。使用容器來部署自給自足的安全 Web 應用程式，這些 Web 應用程式可獨立於主機作業系統而執行。容器是輕量型，而且不需要大量系統資源，因為容器使用相同的系統核心，因此執行效率高於虛擬機器。本指導教學示範如何在 Bluemix 中使用 Docker 容器來建置傳訊 Web 應用程式。 在此程序中，您將撰寫 Dockerfile、將 Docker 映像檔新增至專用 Bluemix 映像檔登錄，以及將容器鏈結在一起。">入門指導教學</a>以及 <a href="container_ov.html#container_docker_ov" title="IBM Bluemix Container Service 是運用 Docker 技術的 Bluemix 運行環境。現有的 Docker 使用者以及初次使用 Docker 的使用者，可能期盼下列 IBM Bluemix Container Service 功能。">Docker 與 IBM Containers</a> 之間的差異。</div>
</div>
<p>如需 Docker Compose 的進一步資訊，請檢閱 <a href="container_single_ui.html#container_compose_faq" title="檢閱這些關於 Docker Compose 的常見問題。">Docker Compose 常見問題</a>及 <a href="container_cli_reference_cfic.html#container_cli_reference_docker-compose" title="請參閱這些指令，以使用 IBM Bluemix Container Service 外掛程式 (bx ic) 來執行及管理您的多容器部署。">Docker Compose 指令參考資料</a>。</p>
</section>
<section class="section timeRequired tutorialTimeRequired" role="region" aria-labelledby="d75631e4014"><h3 class="sectiontitle" id="d75631e4014">所需時間</h3>45 分鐘</section>
<section role="region" aria-labelledby="d75631e4018" class="section section prerequisites"><h3 class="sectiontitle" id="d75631e4018">必要條件</h3>
在電腦上，<a href="container_cli_cfic_install.html#container_cli_compose_install" title="若要同時啟動及停止多個單一容器，您可以安裝 Docker Compose CLI。">安裝</a>或<a href="container_cli_cfic_install.html#container_cli_compose_upgrade" title="您可能需要升級 Docker Compose 套件的版本，才能使用最新功能。">升級</a>至最新版本的 Docker Compose 軟體套件。</section></div>
<article class="topic task tutorialLesson nested2" role="article" aria-labelledby="d75631e4032" lang="zh-tw" id="container_compose_config"><h3 class="topictitle3" id="d75631e4032">課程 1：配置多容器部署</h3>
<div class="body taskbody"><p class="shortdesc">首先，您將在名為 <span class="ph filepath">docker-compose.yml</span> 的 YAML 檔案中配置多容器部署的每一個服務。對於每一個服務，指定映像檔、要公開的埠，以及系統中其他服務的鏈結。</p>
<div class="section prereq">開始之前，請考量下列步驟。<ul><li>執行 <samp class="ph codeph"><span class="ph"><samp class="ph codeph">bx ic</samp></span> namespace-get</samp> 以擷取名稱空間資訊，並將這項資訊儲存在名為 <var class="keyword varname">$your_namespace</var> 的環境變數中。
<pre class="codeblock"><code><var class="keyword varname">$your_namespace</var>=&lt;my_namespace_information&gt;</code></pre>
</li>
<li>在專用 <span class="keyword">Bluemix</span> 映像檔登錄中，建置 <a href="container_single_ui.html#container_gettingstarted_tutorial_lesson_2" title="在本課程中，您使用兩種方法，將映像檔新增至您的專用映像檔登錄：複製 Docker Hub 中的映像檔，以及建立 Dockerfile。自行建立 Dockerfile，可讓您將自己的指令新增至映像檔。因此，每個從該映像檔啟動的容器都會包含這些指令。 容器的其中一個優點，是這些映像檔可協助您維護來源控制，讓您組織中的所有人都可以建置具有一致作業環境的容器。">Lets-Chat 及 MongoDB 容器映像檔</a>。</li>
</ul>
</div><ol class="steps"><li class="step stepexpand"><span class="cmd">在電腦上建立您可以儲存 Docker Compose 配置檔且名為 <var class="keyword varname">composetutorial</var> 的 Docker Compose 專案目錄，然後導覽至這個目錄。</span> 在執行 Docker Compose 指令時，您需要位於這個目錄中，才能找到配置檔。否則，您會收到來自 Docker 常駐程式的錯誤訊息。若要減少部署時間，請不要選擇包含子目錄的目錄，因為所有檔案都會在執行時傳送至 Docker 常駐程式。

<pre class="codeblock"><code>mkdir <var class="keyword varname">composetutorial</var> &amp;&amp; cd <var class="keyword varname">composetutorial</var></code></pre>
</li>
<li class="step stepexpand"><span class="cmd">建立 <span class="ph filepath">docker-compose.yml</span> 檔案。</span> 您可在電腦上使用偏好的 CLI 編輯器或文字編輯器來建立配置檔。下列範例顯示如何使用 <a href="http://www.nano-editor.org/dist/v2.2/nano.html" rel="external" target="_blank" title="（在新分頁或視窗中開啟）">nano editor</a> 來建立 <span class="ph filepath">docker-compose.yml</span> 檔案。
<ol type="a"><li>開啟 nano 編輯器，然後輸入 <span class="ph filepath">docker-compose.yml</span> 作為檔名。<pre class="codeblock"><code>nano <span class="ph filepath">docker-compose.yml</span></code></pre>
</li>
<li>為執行 Lets-Chat 應用程式的多容器部署定義服務。您可以使用 <var class="keyword varname">#</var> 來輸入註解。
<pre class="codeblock"><code>#Name of your Lets-Chat service. 
#The first container that is started for this service is named:
#<span class="ph filepath">composetutorial_lets-chat_1</span>
lets-chat: 
  #Container image that is used to run the lets-chat service. 
  #Use the full path to your private Bluemix images registry.
  image: registry.<span class="keyword" data-hd-keyref="DomainName">DomainName</span>/<var class="keyword varname">$your_namespace</var>/lets-chat  
  #Enter a public IP address and port 8080. Run <samp class="ph codeph"><span class="ph"><samp class="ph codeph">bx ic</samp></span> ips</samp>
  #to list available public IP addresses in your space. 
  #Option 1: If you do not have a public IP address 
  #that you can use, you can request a new one as follows: 
  #ports:
  #- "request:8080:8080". 
  #Option 2: If you want to bind a public IP address after your Lets-Chat container
  #is created by using the <samp class="ph codeph"><span class="ph"><samp class="ph codeph">bx ic</samp></span> ip-bind</samp> command, enter the following:
  #ports:
  #- "8080"
  #Option 3: Bind a public IP address directly to your Lets-Chat container
  #ports:
  #- "<var class="keyword varname">YOUR_PUBLIC_IP_ADDRESS</var>:8080:8080"
  #Choose one of the port options described. 
  ports:
   - "<var class="keyword varname">SELECT_YOUR_PORT_OPTION</var>"
  #lets-chat service is linked to the mongo service. 
  links: 
    - mongo
#Name of your Mongo database service. 
#The first container that is started for this service is named:
#<span class="ph filepath">composetutorial_mongo_1</span>
mongo:
  #Container image that is used to run the mongo service. 
  #Use the full path to your private Bluemix images registry.
  image: registry.<span class="keyword" data-hd-keyref="DomainName">DomainName</span>/<var class="keyword varname">$your_namespace</var>/mongo
  #Container port 27017 is published within your private container network. 
  #If a container instance wants to send messages to a mongo container, 
  #requests need to be sent to this port. 
  expose:
    - "27017"</code></pre>
<div class="note tip"><span class="tiptitle">提示：</span>  當您建立自己的 <span class="ph filepath">docker-compose.yml</span> 檔案時，請新增至少一個服務名稱，以及您要使用之容器映像檔的鏈結，讓 <samp class="ph codeph">docker-compose up</samp> 指令可從配置檔建置容器。</div>
<div class="steps note"><span class="notetitle">註：</span> <span class="keyword">IBM
Bluemix Container Service</span> 只支援第 1 版的 <span class="ph filepath">docker-compose.yml</span> 檔案格式。目前不支援第 2 版。請參閱 <a href="https://docs.docker.com/compose/compose-file/compose-file-v1/" rel="external" target="_blank" title="（在新分頁或視窗中開啟）">Docker compose file version 1 reference</a>，尋找有關如何建立 <span class="ph filepath">docker-compose.yml</span> 檔案的其他範例。</div>
</li>
<li>按 <span class="ph uicontrol">ctrl + o</span> 來儲存您的變更。按 <span class="ph uicontrol">ENTER</span> 鍵來確認您的變更。</li>
<li>按 <span class="ph uicontrol">ctrl + x</span> 來結束 nano 編輯器。</li>
</ol>
</li>
</ol>
<div class="section result">恭喜！您現在已經可以使用 <span class="keyword">IBM
Bluemix Container Service</span> 及 Docker Compose 來<a href="container_single_ui.html#container_compose_run" title="接下來，您將部署及執行多容器部署。您將使用單一 Docker Compose 指令來根據 docker-compose.yml 檔案中的服務定義建立容器，而不是個別建立及啟動 Lets-Chat 和 Mongo Database 容器，並手動將它們鏈結在一起。">部署可執行 Lets-Chat 應用程式的多容器部署</a>。</div></div>
</article><article class="topic task tutorialLesson nested2" role="article" aria-labelledby="d75631e4261" lang="zh-tw" id="container_compose_run"><h3 class="topictitle3" id="d75631e4261">課程 2：執行多容器部署</h3>
<div class="body taskbody"><p class="shortdesc">接下來，您將部署及執行多容器部署。您將使用單一 Docker Compose 指令來根據 <span class="ph filepath">docker-compose.yml</span> 檔案中的服務定義建立容器，而不是個別建立及啟動 Lets-Chat 和 Mongo Database 容器，並手動將它們鏈結在一起。</p>
<ol class="steps"><li class="step stepexpand"><span class="cmd">如果您尚未這麼做，請<a href="container_cli_cfic_install.html#container_cli_login__option2_li">登入 IBM Containers 外掛程式</a>，然後配置 CLI 來執行原生 Docker 指令。</span></li>
<li class="step stepexpand"><span class="cmd">移至 <span class="ph filepath">docker-compose.yml</span> 檔案所在的目錄。</span> 若要執行 Docker Compose 指令，您必須位於 <span class="ph filepath">docker-compose.yml</span> 檔案儲存所在的目錄中。</li>
<li class="step stepexpand"><span class="cmd">根據 <span class="ph filepath">docker-compose.yml</span> 檔案中的服務定義，部署及執行多容器部署。</span> 在 <span class="keyword">IBM
Bluemix Container Service</span> 中，大部分服務及應用程式都是長時間執行的作業。因此，請使用 <samp class="ph codeph">-d</samp> 選項，以避免卡在容器的主控台輸出中，而無法分離。

<pre class="codeblock"><code>docker-compose up -d</code></pre>
 如果您使用 <samp class="ph codeph">-d</samp> 選項，則還是可以追蹤容器實例，因為它們的名稱在建立之後會顯示在 CLI 中。

<pre class="codeblock"><code>$ docker-compose up -d

Creating composetutorial_mongo_1
Creating composetutorial_lets-chat_1</code></pre>
</li>
<li class="step stepexpand"><span class="cmd">驗證多容器部署的容器正在執行中。</span> <pre class="codeblock"><code>docker-compose ps</code></pre>
在容器實例執行之後，即會顯示<span class="ph uicontrol">啟動</span>狀態。此處理程序可能需要幾分鐘的時間。您的輸出類似下列內容：

<pre class="codeblock"><code>$ docker-compose ps

        Name                   Command      State             Ports             
-----------------------------------------------------------------------
composetutorial_lets-chat_1                  Up      192.0.2.100:8080-&gt;8080/tcp    
composetutorial_mongo_1                    Up      203.0.113.23:27017-&gt;27017/tcp</code></pre>
</li>
<li class="step stepexpand">選擇性的： <span class="cmd">如果您尚未在 <span class="ph filepath">docker-compose.yml</span> 檔案中配置 IP 位址，請將可用的公用 IP 位址連結至 Lets-Chat 容器。</span> 執行 <samp class="ph codeph"><span class="ph"><samp class="ph codeph">bx ic</samp></span> ips</samp> 以列出您空間中的可用公用 IP 位址，或執行 <samp class="ph codeph"><span class="ph"><samp class="ph codeph">bx ic</samp></span> ip-request</samp> 來要求新的公用 IP 位址。將 <var class="keyword varname">&lt;IP_address&gt;</var> 取代為公用 IP 位址。

<pre class="codeblock"><code><span class="ph"><samp class="ph codeph">bx ic</samp></span> ip-bind <var class="keyword varname">&lt;IP_address&gt;</var> composetutorial_lets-chat_1</code></pre>
</li>
<li class="step stepexpand">選擇性的： <span class="cmd">等待將 IP 位址連結至容器作業完成。</span> 此處理程序可能需要幾分鐘的時間。完成之後，即在 CLI 中顯示<span class="ph uicontrol">正常</span>訊息。</li>
<li class="step stepexpand"><span class="cmd">從網際網路存取您的 Lets-Chat 應用程式。</span> <ol type="a" class="ol substeps"><li class="li substep substepexpand"><span class="cmd">開啟 Web 瀏覽器。</span></li>
<li class="li substep substepexpand"><span class="cmd">在 Web 瀏覽器中輸入公用 IP 位址及公用 Lets-Chat 埠 8080，如此範例所示：<samp class="ph codeph">192.0.2.100:8080</samp>。</span> Lets-Chat 登入頁面即會顯示在 Web 瀏覽器中。<p><img src="images/lets-chat_screenshot.jpg" alt="登入 Let's Chat Web 應用程式。"></p>
</li>
</ol>
</li>
</ol>
<div class="section result">太棒了。您的 Lets-Chat 應用程式現在已經可以使用。請開始建立 Lets-Chat 帳戶，以及探索您應用程式的功能。若要讓 Lets-Chat 應用程式更為可靠，請<a href="container_single_ui.html#container_compose_scale" title="在多容器部署目前正在執行的情況下，增加 Lets-Chat 容器實例數目，讓您的應用程式更為可靠。">擴增 Lets-Chat 容器實例</a>。</div></div>
</article><article class="topic task tutorialLesson nested2" role="article" aria-labelledby="d75631e4440" lang="zh-tw" id="container_compose_scale"><h3 class="topictitle3" id="d75631e4440">課程 3：擴充多容器部署</h3>
<div class="body taskbody"><p class="shortdesc">在多容器部署目前正在執行的情況下，增加 Lets-Chat 容器實例數目，讓您的應用程式更為可靠。</p>
<div class="section context"></div><ol class="steps"><li class="step stepexpand"><span class="cmd">更新 <span class="ph filepath">docker-compose.yml</span> 檔案。</span> 您只能擴充未公開公用埠的服務，因為針對此服務而啟動的所有容器實例都會嘗試使用相同的埠。在前一個課程中定義要針對 Lets-Chat 服務公開埠 8080 時，您需要在 <span class="ph filepath">docker-compose.yml</span> 檔案中變更此設定。<ol type="a" class="ol substeps"><li class="li substep substepexpand"><span class="cmd">開啟 <span class="ph filepath">docker-compose.yml</span></span> <pre class="codeblock"><code>nano <span class="ph filepath">docker-compose.yml</span></code></pre>
</li>
<li class="li substep substepexpand"><span class="cmd">在 Lets-Chat 服務定義中，將 <span class="ph uicontrol">ports</span> 參數取代為 <span class="ph uicontrol">expose</span>，並刪除公用 IP 位址。</span> expose 參數只會發佈專用容器網路內的埠。您的 Lets-Chat 服務定義看起來如下。

<pre class="codeblock"><code>lets-chat: 
  image: registry.<span class="keyword" data-hd-keyref="DomainName">DomainName</span>/<var class="keyword varname">$your_namespace</var>/lets-chat 
  expose:
   - "8080"
  links: 
    - mongo</code></pre>
</li>
<li class="li substep substepexpand"><span class="cmd">按 <span class="ph uicontrol">ctrl + o</span> 來儲存您的變更。按 <span class="ph uicontrol">ENTER</span> 鍵來確認您的變更。</span></li>
<li class="li substep substepexpand"><span class="cmd">按 <span class="ph uicontrol">ctrl + x</span> 來結束 nano 編輯器。</span></li>
</ol>
</li>
<li class="step stepexpand"><span class="cmd">重建多容器部署。使用 <samp class="ph codeph">--force-recreate</samp> 選項，在部署中重建所有實例。</span> <pre class="codeblock"><code>docker-compose up -d --force-recreate</code></pre>
</li>
<li class="step stepexpand"><span class="cmd">將 Lets-Chat 服務擴增為 2 個容器實例。</span> 使用下列指令，<span class="keyword">IBM
Bluemix Container Service</span> 會根據 <span class="ph filepath">docker-compose.yml</span> 檔案中的服務定義，來自動建立新的 Lets-Chat 容器實例。
<div class="steps note"><span class="notetitle">註：</span> 如果減少容器實例的數目，則 <span class="keyword">IBM
Bluemix Container Service</span> 會自動停止及移除多容器部署中的額外容器實例。</div>

<pre class="codeblock"><code>docker-compose scale lets-chat=2</code></pre>
您的 CLI 輸出看起來如下。

<pre class="codeblock"><code>$ docker-compose scale lets-chat=2

Creating and starting composetutorial_lets-chat_2 ... done</code></pre>
</li>
<li class="step stepexpand"><span class="cmd">重建多容器部署，以鏈結您的新容器實例。</span> Docker Compose 目前不支援自動連接/分離鏈結，因此，您需要使用 <samp class="ph codeph">--force-recreate</samp> 選項，在多容器部署中重建所有容器實例。
<pre class="codeblock"><code>docker-compose up -d --force-recreate</code></pre>
</li>
<li class="step stepexpand"><span class="cmd">驗證 Mongo 容器實例已鏈結至 Lets-Chat 容器實例。</span> <pre class="codeblock"><code>docker inspect composetutorial_lets-chat_1</code></pre>

<pre class="codeblock"><code>docker inspect composetutorial_lets-chat_2</code></pre>
您可以在每一個回應的 <var class="keyword varname">HostConfig &gt; Links</var> 區段中檢閱鏈結的 Mongo 容器實例。
<pre class="codeblock"><code>...
"HostConfig": {
        "Binds": [],
        "CapAdd": [],
        "CapDrop": [],
        "ContainerIDFile": "",
        "Links": [
            "composetutorial_mongo_1:mongo",
            "composetutorial_mongo_1:composetutorial_mongo_1",
            "composetutorial_mongo_1:composetutorial_mongo_1"
        ],
        "LogConfig": {
            "Config": {},
            "Type": "json-file"
        },
        "LxcConf": [],
        "PortBindings": {
            "8080/tcp": [
                {
                    "HostPort": "8080"
                }
            ]
        },
        "Privileged": false,
        "PublishAllPorts": false
    },
...</code></pre>
</li>
</ol>
<div class="section result">太好了。您已順利擴增 Lets-Chat 服務，並讓應用程式更為可靠。若要可以回應較高的使用者資料流量，請<a href="container_single_ui.html#container_compose_loadbalance" title="若要回應較高的工作負載，請將 nginx 負載平衡器新增至多容器部署，以平衡 Lets-Chat 容器實例之間的送入使用者資料流量。">新增 nginx 負載平衡器</a>至多容器部署，以平衡 Lets-Chat 容器實例之間的工作負載。</div></div>
</article><article class="topic task tutorialLesson nested2" role="article" aria-labelledby="d75631e4629" lang="zh-tw" id="container_compose_loadbalance"><h3 class="topictitle3" id="d75631e4629">課程 4：將負載平衡器新增至多容器部署</h3>
<div class="body taskbody"><p class="shortdesc">若要回應較高的工作負載，請將 nginx 負載平衡器新增至多容器部署，以平衡 Lets-Chat 容器實例之間的送入使用者資料流量。</p>
<ol class="steps"><li class="step stepexpand"><span class="cmd">配置 <span class="ph uicontrol">nginx</span> 負載平衡器。</span> <ol type="a" class="ol substeps"><li class="li substep substepexpand"><span class="cmd">建立 <span class="ph filepath">nginx.conf</span> 配置檔。</span> <pre class="codeblock"><code>nano <span class="ph filepath">nginx.conf</span></code></pre>
</li>
<li class="li substep substepexpand"><span class="cmd">將下列資訊儲存至配置檔。</span> 為了平衡 Lets-Chat 容器實例之間的工作負載，您需要在配置檔中將它們全部新增為上游伺服器。因此，所有送入要求都會轉遞至其中一個 Lets-Chat 容器。

<pre class="codeblock"><code>worker_processes 3;

events { worker_connections 1024; }

http {

        upstream lets-chat-app {
              ip_hash;
              server composetutorial_lets-chat_1:8080 weight=10 max_fails=3 fail_timeout=30s;
              server composetutorial_lets-chat_2:8080 weight=10 max_fails=3 fail_timeout=30s;
        }
         
        server {
              listen 80;
         
              location / {
                proxy_pass http://lets-chat-app;
                proxy_http_version 1.1;
                proxy_set_header Upgrade $http_upgrade;
                proxy_set_header Connection 'upgrade';
                proxy_set_header Host $host;
                proxy_cache_bypass $http_upgrade;
              }
        }
}</code></pre>
</li>
<li class="li substep substepexpand"><span class="cmd">按 <span class="ph uicontrol">ctrl + o</span> 來儲存您的變更。按 <span class="ph uicontrol">ENTER</span> 鍵來確認您的變更。</span></li>
<li class="li substep substepexpand"><span class="cmd">按 <span class="ph uicontrol">ctrl + x</span> 來結束 nano 編輯器。</span></li>
</ol>
</li>
<li class="step stepexpand"><span class="cmd">在專用 <span class="keyword">Bluemix</span> 映像檔登錄中建立 <span class="ph uicontrol">nginx</span> 映像檔。</span> <ol type="a" class="ol substeps"><li class="li substep substepexpand"><span class="cmd">建立 Dockerfile。</span> <pre class="codeblock"><code>nano Dockerfile</code></pre>
</li>
<li class="li substep substepexpand"><span class="cmd">將下列資訊儲存至 Dockerfile。</span> 您建立的映像檔是以 Dockerhub 所提供的公用 <span class="ph uicontrol">nginx</span> 映像檔為基礎。若要套用前一個步驟中指定的自訂設定，請使用 <samp class="ph codeph">COPY</samp> 指令，將 <span class="ph filepath">nginx.conf</span> 檔案複製到 <span class="ph uicontrol">nginx</span> 配置檔位置。
<pre class="codeblock"><code>#Uses the public nginx image available on Dockerhub.
FROM nginx
#Copies your custom <span class="ph filepath">nginx.conf</span> file into the nginx configuration file location.
COPY nginx.conf /etc/nginx/nginx.conf</code></pre>
</li>
<li class="li substep substepexpand"><span class="cmd">按 <span class="ph uicontrol">ctrl + o</span> 來儲存您的變更。按 <span class="ph uicontrol">ENTER</span> 鍵來確認您的變更。</span></li>
<li class="li substep substepexpand"><span class="cmd">按 <span class="ph uicontrol">ctrl + x</span> 來結束 nano 編輯器。</span></li>
<li class="li substep substepexpand"><span class="cmd">建置 <span class="ph uicontrol">nginx</span> 映像檔，並將它推送至專用 <span class="keyword">Bluemix</span> 映像檔登錄。</span> <pre class="codeblock"><code>docker build -t registry.<span class="keyword" data-hd-keyref="DomainName">DomainName</span>/<var class="keyword varname">$your_namespace</var>/nginx .</code></pre>

您的 CLI 輸出類似下列內容：

<pre class="codeblock"><code>Sending build context to Docker daemon 9.728 kB
Step 1 : FROM nginx
 ---&gt; 6f62f48c4e55
Step 2 : COPY nginx.conf /etc/nginx/nginx.conf
 ---&gt; bc40817f0593
Removing intermediate container 64c5e180943f
Successfully built bc40817f0593
The push refers to a repository [registry.<span class="keyword" data-hd-keyref="DomainName">DomainName</span>/<var class="keyword varname">$your_namespace</var>/nginx] (len: 1)
bc40817f0593: Pushed 
6f62f48c4e55: Pushed 
50ed65ac2e2d: Pushed 
fed44c33bce9: Pushed 
73e8d4f6bf84: Pushed 
latest: digest: sha256:99587168cbf699b32804c4ff0de610460dfa150120b12385b194c2f9236903f5 size: 15270</code></pre>
</li>
</ol>
</li>
<li class="step stepexpand"><span class="cmd">將 <span class="ph uicontrol">nginx</span> 服務定義新增至 <span class="ph filepath">docker-compose.yml</span> 檔案。</span> <ol type="a" class="ol substeps"><li class="li substep substepexpand"><span class="cmd">開啟 <span class="ph filepath">docker-compose.yml</span> 檔案。</span> <pre class="codeblock"><code>nano <span class="ph filepath">docker-compose.yml</span></code></pre>
</li>
<li class="li substep substepexpand"><span class="cmd">將下列資訊複製到 <span class="ph filepath">docker-compose.yml</span>。將 <var class="keyword varname">IP_ADDRESS</var> 取代為您要用來存取 <span class="ph uicontrol">nginx</span> 負載平衡器的公用 IP 位址。</span> <pre class="codeblock"><code>nginx:
  image: registry.<span class="keyword" data-hd-keyref="DomainName">DomainName</span>/<var class="keyword varname">$your_namespace</var>/nginx  
  ports:
   - "<var class="keyword varname">IP_ADDRESS</var>:80:80"
  links: 
    - lets-chat</code></pre>
您的 <span class="ph filepath">docker-compose.yml</span> 檔案看起來如下。

<pre class="codeblock"><code>nginx:
  image: registry.<span class="keyword" data-hd-keyref="DomainName">DomainName</span>/<var class="keyword varname">$your_namespace</var>/nginx
  ports:
   - "<var class="keyword varname">IP_ADDRESS</var>:80:80"
  links: 
    - lets-chat
lets-chat: 
  image: registry.<span class="keyword" data-hd-keyref="DomainName">DomainName</span>/<var class="keyword varname">$your_namespace</var>/lets-chat
  expose:
   - "8080"
  links: 
    - mongo
mongo:
  image: registry.<span class="keyword" data-hd-keyref="DomainName">DomainName</span>/<var class="keyword varname">$your_namespace</var>/mongo
  expose:
    - "27017"</code></pre>
</li>
<li class="li substep substepexpand"><span class="cmd">按 <span class="ph uicontrol">ctrl + o</span> 來儲存您的變更。按 <span class="ph uicontrol">ENTER</span> 鍵來確認您的變更。</span></li>
<li class="li substep substepexpand"><span class="cmd">按 <span class="ph uicontrol">ctrl + x</span> 來結束 nano 編輯器。</span></li>
</ol>
</li>
<li class="step stepexpand"><span class="cmd">使用 <span class="ph uicontrol">nginx</span> 負載平衡器，部署可執行 Lets-Chat 應用程式的多容器部署。</span> <ol type="a" class="ol substeps"><li class="li substep substepexpand"><span class="cmd">重建多容器部署。</span> 使用 <samp class="ph codeph">--force-recreate</samp> 選項，在多容器部署中重建所有容器實例，以正確地連接鏈結。

<pre class="codeblock"><code>docker-compose up -d --force-recreate</code></pre>
</li>
<li class="li substep substepexpand"><span class="cmd">驗證已正確地鏈結容器。</span> <pre class="codeblock"><code>docker inspect composetutorial_nginx_1</code></pre>
您可以在回應的 <var class="keyword varname">HostConfig &gt; Links</var> 區段中檢閱鏈結的 Lets-Chat 容器實例。
<pre class="codeblock"><code>...
"HostConfig": {
        "Binds": [],
        "CapAdd": [],
        "CapDrop": [],
        "ContainerIDFile": "",
        "Links": [
            "composetutorial_lets-chat_2:composetutorial_lets-chat_2",
            "composetutorial_lets-chat_1:composetutorial_lets-chat_1",
            "composetutorial_lets-chat_1:composetutorial_lets-chat_1",
            "composetutorial_lets-chat_2:lets-chat",
            "composetutorial_lets-chat_2:composetutorial_lets-chat_2"
        ],
        "LogConfig": {
            "Config": {},
            "Type": "json-file"
        },
        "LxcConf": [],
        "PortBindings": {
            "80/tcp": [
                {
                    "HostPort": "80"
                }
            ]
        },
        "Privileged": false,
        "PublishAllPorts": false
    },
...</code></pre>
</li>
</ol>
</li>
<li class="step stepexpand"><span class="cmd">驗證自訂 <span class="ph filepath">nginx.config</span> 設定已套用至 <span class="ph uicontrol">nginx</span> 容器實例。</span> <ol type="a" class="ol substeps"><li class="li substep substepexpand"><span class="cmd">登入 <span class="ph uicontrol">nginx</span> 容器。</span> <pre class="codeblock"><code>docker exec -it composetutorial_nginx_1 bash</code></pre>
</li>
<li class="li substep substepexpand"><span class="cmd">檢閱主機配置。</span> <pre class="codeblock"><code>cat <span class="ph filepath">/etc/hosts</span></code></pre>
如果已套用自訂設定，您可以在 CLI 輸出中看到鏈結的 Lets-Chat 容器實例與其專用 IP 位址一起列出。<pre class="codeblock"><code>127.0.0.1	localhost
::1	localhost ip6-localhost ip6-loopback
fe00::0	ip6-localnet
ff00::0	ip6-mcastprefix
ff02::1	ip6-allnodes
ff02::2	ip6-allrouters
198.51.100.19	composetutorial_lets-chat_1
198.51.100.18	composetutorial_lets-chat_2
198.51.100.20	instance-000f2b2b
198.51.100.18	lets-chat
198.51.100.20	composetutorial-nginx-1
198.51.100.19	composetutoral_lets-chat_1
198.51.100.18	composetutorial_lets-chat_2
198.51.100.20	instance-000f2b2b</code></pre>
</li>
<li class="li substep substepexpand"><span class="cmd">在 CLI 中輸入 <samp class="ph codeph">exit</samp>，以登出容器。</span></li>
</ol>
</li>
</ol>
<div class="section result">太好了。您現在可以平衡 Lets-Chat 容器之間的工作負載，並回應較高的使用者資料流量。最後一個步驟，您可以<a href="container_single_ui.html#container_compose_remove" title="最後一個步驟是移除多容器部署來釋出已使用的資源，並充分利用您的配額。">刪除多容器部署</a>來釋出已使用的資源，並充分利用您的配額。</div></div>
</article><article class="topic task tutorialLesson nested2" role="article" aria-labelledby="d75631e4973" lang="zh-tw" id="container_compose_remove"><h3 class="topictitle3" id="d75631e4973">課程 5：移除多容器部署</h3>
<div class="body taskbody"><p class="shortdesc">最後一個步驟是移除多容器部署來釋出已使用的資源，並充分利用您的配額。</p>
<div class="section context"><div class="note attention"><span class="attentiontitle">小心：</span> 多容器部署一旦刪除即無法復原。如果您要保留多容器部署的配置，請不要移除 <span class="ph filepath">docker-compose.yml</span> 檔案。</div>
</div><ol class="steps"><li class="step stepexpand"><span class="cmd">停止多容器部署中的所有執行中容器實例。</span> <pre class="codeblock"><code>docker-compose stop</code></pre>
</li>
<li class="step stepexpand"><span class="cmd">移除多容器部署中的所有容器實例。</span> <pre class="codeblock"><code>docker-compose rm</code></pre>
 在移除過程中，會要求您確認要移除所有容器實例。請輸入 <span class="ph uicontrol">y</span> 予以確認。</li>
<li class="step stepexpand">選擇性的： <span class="cmd">驗證已從容器系統移除所有容器實例。</span> <pre class="codeblock"><code>docker-compose ps</code></pre>
</li>
<li class="step stepexpand">選擇性的： <span class="cmd">刪除 <span class="ph filepath">docker-compose.yml</span> 檔案。</span> <div class="note tip"><span class="tiptitle">提示：</span> 如果您要重複使用這個檔案，請將它儲存到來源控制系統，而不要刪除它。</div>


<pre class="codeblock"><code>rm <span class="ph filepath">docker-compose.yml</span></code></pre>
</li>
<li class="step stepexpand">選擇性的： <span class="cmd">刪除 Docker Compose 專案目錄。</span> <pre class="codeblock"><code>cd &amp;&amp; rmdir composetutorial</code></pre>
</li>
</ol>
<div class="section result">您已順利移除多容器部署，並已充分利用您的配額。</div></div>
</article><article class="topic concept nested2" role="article" aria-labelledby="d75631e5080" lang="zh-tw" id="container_compose_yml"><h3 class="topictitle3" id="d75631e5080"><span class="ph filepath">docker-compose.yml</span> 檔案中支援的選項</h3>
<div class="body conbody"><p class="shortdesc"></p>
<div>檢閱 <span class="keyword">IBM
Bluemix Container Service</span> 中所支援的 <span class="ph filepath">docker-compose.yml</span> 檔案選項。<ul><li><a href="container_single_ui.html#container_compose_yml__environment">environment</a></li>
<li><a href="container_single_ui.html#container_compose_yml__expose">expose</a></li>
<li><a href="container_single_ui.html#container_compose_yml__image">映像檔</a></li>
<li><a href="container_single_ui.html#container_compose_yml__links">鏈結</a></li>
<li><a href="container_single_ui.html#container_compose_yml__mem">mem_limit</a></li>
<li><a href="container_single_ui.html#container_compose_yml__ports">ports</a></li>
<li><a href="container_single_ui.html#container_compose_yml__volumes">磁區</a></li>
</ul>
</div><section role="region" aria-labelledby="d75631e5170" id="container_compose_yml__environment"><h4 class="sectiontitle" id="d75631e5170"><span class="ph"><samp class="ph codeph">environment</samp></span></h4>使用 <span class="ph uicontrol">environment</span> 參數來設定環境變數，或將 <span class="keyword">Bluemix</span> 服務或應用程式連結至 Docker Compose 服務。<div class="steps note"><span class="notetitle">註：</span>  如果您要將 <span class="keyword">Bluemix</span> 服務新增至多容器部署，則必須在空間中建立此服務的實例。如需相關資訊，請參閱 <a href="container_integrations.html#container_integrations_binding" title="IBM Bluemix 具有一份服務清單，且會代表應用程式開發者管理它們。若要新增 Bluemix 服務供您的容器使用，您必須要求此服務的實例，並將服務連結至容器。">從 Bluemix GUI 連結服務</a>。<p>某些服務不支援將服務直接連結至容器。在此情況下，您必須建立 Cloud Foundry 應用程式。如需相關資訊，請參閱<a href="container_troubleshoot.html#ts_bridge_app">Bluemix 服務不會直接連結至容器</a>。</p>
</div>
<ul><li><span class="keyword option">連結 Bluemix 服務</span><p>若要連結服務，請使用 <span class="ph uicontrol">CCS_BIND_SRV</span> 索引鍵。將 <var class="keyword varname">&lt;service_instance_name&gt;</var> 取代為您已在專用 <span class="keyword">Bluemix</span> 映像檔登錄中建立之服務實例的名稱。</p>
<pre class="codeblock"><code>environment: 
  - "CCS_BIND_SRV=<var class="keyword varname">&lt;service_instance_name&gt;</var>"</code></pre>
</li>
<li><span class="keyword option">連結 Cloud Foundry 應用程式</span><p>若要連結應用程式，請使用 <span class="ph uicontrol">CCS_BIND_APP</span> 索引鍵。將 <var class="keyword varname">&lt;app_name&gt;</var> 取代為您已在專用 <span class="keyword">Bluemix</span> 映像檔登錄中建立之 Cloud Foundry 應用程式的名稱。</p>
<pre class="codeblock"><code>environment:
  - "CCS_BIND_APP=<var class="keyword varname">&lt;app_name&gt;</var>"</code></pre>
</li>
</ul>
<dl><dt class="dlterm">範例</dt>
<dd>下列範例顯示範例 <span class="ph filepath">docker-compose.yml</span> 檔案，它會將名為 <var class="keyword varname">containerbridge</var> 的 Cloud Foundry 應用程式連結至 lets-chat 服務，並將名為 <var class="keyword varname">tmp_folder</var> 的環境變數新增至 lets-chat 服務。<pre class="codeblock"><code>#Name of your service
lets-chat: 
  #Container image that is used to run the lets-chat service. Replace <var class="keyword varname">&lt;my_namespace&gt;</var> with the name of your namespace.
  image: registry.<span class="keyword" data-hd-keyref="DomainName">DomainName</span>/<var class="keyword varname">&lt;my_namespace&gt;</var>/lets-chat  
  #Use <span class="ph uicontrol">CCS_BIND_SRV</span> to bind a <span class="keyword">Bluemix</span> service or <span class="ph uicontrol">CCS_BIND_APP</span> to bind a Cloud Foundry app to your Docker Compose service. 
  environment:
   - "CCS_BIND_APP=containerbridge"
   - "tmp_folder=/tmp"</code></pre>
</dd>
</dl>
</section><section role="region" aria-labelledby="d75631e5289" id="container_compose_yml__expose"><h4 class="sectiontitle" id="d75631e5289"><span class="ph"><samp class="ph codeph">expose</samp></span></h4>只將埠公開至專用網路。所有鏈結的服務都可以存取此埠。<dl><dt class="dlterm">範例</dt>
<dd>下列範例顯示範例 <span class="ph filepath">docker-compose.yml</span> 檔案，它只會將埠 8080 公開至內部網路。鏈結的 mongo 容器使用此埠，將要求傳送至 lets-chat 容器。
<pre class="codeblock"><code>lets-chat: 
  #Container image that is used to run the lets-chat service. Replace <var class="keyword varname">&lt;my_namespace&gt;</var> with the name of your namespace.
  image: registry.<span class="keyword" data-hd-keyref="DomainName">DomainName</span>/<var class="keyword varname">&lt;my_namespace&gt;</var>/lets-chat  
  #Make a port available to the private network only. 
  expose:
   - "8080"
  links: 
    - mongo
mongo:
  image: registry.<span class="keyword" data-hd-keyref="DomainName">DomainName</span>/<var class="keyword varname">&lt;my_namespace&gt;</var>/mongo</code></pre>
</dd>
</dl>
</section><section role="region" aria-labelledby="d75631e5321" id="container_compose_yml__image"><h4 class="sectiontitle" id="d75631e5321"><span class="ph"><samp class="ph codeph">image</samp></span></h4>定義您要用來執行 Docker Compose 服務的基礎映像檔。映像檔必須先位在專用 <span class="keyword">Bluemix</span> 登錄中，您才能在 <span class="ph filepath">docker-compose.yml</span> 檔案中使用它。<p>若要定義映像檔，請使用下列格式的專用 <span class="keyword">Bluemix</span> 登錄的完整路徑：registry.<span class="keyword" data-hd-keyref="DomainName">DomainName</span>/<var class="keyword varname">&lt;my_namespace&gt;</var>/<var class="keyword varname">&lt;image&gt;</var>:<var class="keyword varname">&lt;tag&gt;</var>。</p>
<dl><dt class="dlterm">範例</dt>
<dd>下列範例顯示範例 <span class="ph filepath">docker-compose.yml</span> 檔案，它會將 lets-chat 映像檔定義為 lets-chat 服務的基礎。<pre class="codeblock"><code>#Name of your service
lets-chat: 
  #Container image that is used to run the lets-chat service. Replace <var class="keyword varname">&lt;my_namespace&gt;</var> with the name of your namespace.
  image: registry.<span class="keyword" data-hd-keyref="DomainName">DomainName</span>/<var class="keyword varname">&lt;my_namespace&gt;</var>/lets-chat
  </code></pre>
</dd>
</dl>
</section><section role="region" aria-labelledby="d75631e5372" id="container_compose_yml__links"><h4 class="sectiontitle" id="d75631e5372"><span class="ph"><samp class="ph codeph">links</samp></span></h4>將容器鏈結至針對另一個服務所啟動的所有容器。鏈結會決定服務之間的相依關係，進而決定在您執行
<samp class="ph codeph">docker-compose up</samp> 指令時，容器啟動的順序。若要鏈結服務，請輸入服務名稱。<dl><dt class="dlterm">範例</dt>
<dd>下列範例顯示範例 <span class="ph filepath">docker-compose.yml</span> 檔案，它會將 nginx 容器鏈結至針對 lets-chat 服務所啟動的所有容器。
<pre class="codeblock"><code>#Name of your service
nginx:
  #Container image that is used to run the nginx service. Replace <var class="keyword varname">&lt;my_namespace&gt;</var> with the name of your namespace.
  image: registry.<span class="keyword" data-hd-keyref="DomainName">DomainName</span>/<var class="keyword varname">&lt;my_namespace&gt;</var>/nginx  
  #Enter the name of the service that you want to link. 
  links: 
    - lets-chat
lets-chat: 
  image: registry.<span class="keyword" data-hd-keyref="DomainName">DomainName</span>/<var class="keyword varname">&lt;my_namespace</var>/lets-chat  </code></pre>
</dd>
</dl>
</section><section role="region" aria-labelledby="d75631e5407" id="container_compose_yml__mem"><h4 class="sectiontitle" id="d75631e5407"><span class="ph"><samp class="ph codeph">mem_limit</samp></span></h4>設定容器實例的大小。容器大小定義容器在執行時可在運算主機上取得的記憶體及磁碟空間數量上限。指派容器大小之後，即無法變更其值。<p>在 <span class="keyword">IBM
Bluemix Container Service</span> 中選擇下列其中一個大小。</p>
<ul data-hd-audience="yellow"><li>極微小（64 MB 記憶體，4 GB 磁碟空間）</li>
<li>極微（128 MB 記憶體，8 GB 磁碟空間）</li>
<li>微小（256 MB 記憶體，16 GB 磁碟空間）</li>
<li>極小（512 MB 記憶體，32 GB 磁碟空間）</li>
<li>小（1024 MB 記憶體，64 GB 磁碟空間）</li>
<li>中（2048 MB 記憶體，128 GB 磁碟空間）</li>
<li>大（4096 MB 記憶體，256 GB 磁碟空間）</li>
<li>特大（8192 MB 記憶體，512 GB 磁碟空間）</li>
<li>超大（16384 MB 記憶體，1 TB 磁碟空間）</li>
</ul>
輸入您要的大小 (MB)，不含 <samp class="ph codeph">'M'</samp> 單位標籤。如果您未指定大小，則預設會使用<span class="ph uicontrol">微小</span>大小來建立所有容器。<dl><dt class="dlterm">範例</dt>
<dd>下列範例顯示範例 <span class="ph filepath">docker-compose.yml</span> 檔案，它會將 lets-chat 服務的容器大小設為 512 MB。<pre class="codeblock"><code>#Name of your service
lets-chat: 
  #Container image that is used to run the lets-chat service. Replace <var class="keyword varname">&lt;my_namespace&gt;</var> with the name of your namespace.
  image: registry.<span class="keyword" data-hd-keyref="DomainName">DomainName</span>/<var class="keyword varname">&lt;my_namespace&gt;</var>/lets-chat  
  #Enter the size you want in megabytes
  mem_limit: 512</code></pre>
</dd>
</dl>
</section><section role="region" aria-labelledby="d75631e5469" id="container_compose_yml__ports"><h4 class="sectiontitle" id="d75631e5469"><span class="ph"><samp class="ph codeph">ports</samp></span></h4>使用 <span class="ph uicontrol">ports</span> 選項，以公開針對服務所啟動的每個容器的公用埠。請選擇下列其中一個配置。<ul><li><span class="keyword option">要求公用 IP 位址</span><div class="p">此配置會要求空間的新公用 IP 位址，並將埠 8080 公開給大眾使用，然後將所要求的 IP 位址連結至容器。<div class="steps note"><span class="notetitle">註：</span> 您必須要有足夠的公用 IP 位址配額，才能將新的 IP 位址配置給空間。</div>
</div>
<pre class="codeblock"><code>ports:
  - "request:8080:8080"</code></pre>
</li>
<li><span class="keyword option">公開公用埠</span><p>使用此配置，會將埠 8080 公開給大眾使用。不會將 IP 位址連結至容器。為了能夠從網際網路存取您的應用程式，請在建立容器之後<a href="container_single_ui.html#container_cli_ips" title="在 Bluemix 中，要求公用 IP 位址，並將其連結至容器。">連結公用 IP 位址</a>。</p>
<pre class="codeblock"><code>ports:
  - "8080"</code></pre>
</li>
<li><span class="keyword option">連結現有公用 IP 位址</span><div class="p">使用此配置，會將埠 8080 公開給大眾使用，並在建立容器之後，將現有公用 IP 位址自動連結至容器。<div class="steps note"><span class="notetitle">註：</span> 您使用的 IP 位址必須配置給空間且可供使用。如果 IP 位址已連結至容器，則必須先將它<a href="container_single_ui.html#container_cli_ips_unbind" title="您可以從容器取消連結公用 IP 位址，但是其他容器仍然可以使用該 IP 位址，且它仍然會計入組織的公用 IP 配額。">取消連結</a>。</div>
</div>
<pre class="codeblock"><code>ports:
  - "<var class="keyword varname">IP_ADDRESS</var>:8080:8080"</code></pre>
</li>
</ul>
</section><section role="region" aria-labelledby="d75631e5521" id="container_compose_yml__volumes"><h4 class="sectiontitle" id="d75631e5521"><span class="ph"><samp class="ph codeph">volumes</samp></span></h4>使用 <span class="ph uicontrol">volumes</span> 參數來將現有磁區新增至您的服務。<div class="steps note"><span class="notetitle">註：</span> 您必須先建立磁區，才能將它新增至 <span class="ph filepath">docker-compose.yml</span> 檔案中的服務定義。如需相關資訊，請參閱<a href="container_volumes_ov.html#container_volumes_cli" title="磁區是一個持續性的儲存位置，用來存放應用程式所建立的資料，或是應用程式執行所需的檔案。 您可以從指令行建立容器的磁區。">使用指令行 (CLI) 建立磁區</a>主題。若要先將資料移入磁區中，再將磁區裝載至容器，請參閱<a href="container_volumes_ov.html#container_volumes_mount" title="在建立磁區之後，您可以將磁區裝載至容器，並新增磁區裝載至其中的任何容器可以存取的檔案。">使用指令行介面 (CLI) 將檔案新增至磁區</a>。</div>
<dl><dt class="dlterm">範例</dt>
<dd>下列範例顯示範例 <span class="ph filepath">docker-compose.yml</span> 檔案，它會將名為 <var class="keyword varname">my_volume</var> 的外部磁區新增至 lets-chat 服務。磁區會裝載至具有讀寫權的 <span class="ph filepath">/tmp/data</span> 資料夾。
<pre class="codeblock"><code>version: '2'
#Name of your service
lets-chat: 
  #container image that is used to run the lets-chat service. Replace &lt;my_namespace&gt; with the name of your namespace.
  image: registry.<span class="keyword" data-hd-keyref="DomainName">DomainName</span>/<var class="keyword varname">&lt;my_namespace&gt;</var>/lets-chat  
  #You need to first create your volume before you can add it 
  volumes:
   - <var class="keyword varname">my_volume</var>:<span class="ph filepath">/tmp/data</span>:rw
#declare volume as external
volumes:
  my_volume:
    external: true</code></pre>
</dd>
</dl>
</section></div>
</article><article class="topic concept nested2" role="article" aria-labelledby="d75631e5579" lang="zh-tw" id="container_compose_faq"><h3 class="topictitle3" id="d75631e5579">Docker Compose 常見問題 (FAQ)</h3>
<div class="body conbody"><p class="shortdesc">檢閱這些關於 Docker Compose 的常見問題。</p>
<div class="p"><dl><dt class="dlterm">如何設定我的 Docker Compose 用戶端，讓它指向 IBM Containers 服務？</dt>
<dd>登入 <span class="keyword">IBM
Bluemix Container Service</span> CLI 時，您可以選擇執行 <span class="keyword">IBM
Bluemix Container Service</span> (<span class="ph"><samp class="ph codeph">bx ic</samp></span>) 指令或是設定環境變數，以使用原生 Docker 指令 (<samp class="ph codeph">docker</samp>)。若要對 <span class="keyword">IBM
Bluemix Container Service</span> 執行 Docker Compose 指令，您必須將環境變數設為對 <span class="keyword">IBM
Bluemix Container Service</span> 執行原生 Docker 指令。如需相關資訊，請參閱<a href="container_cli_cfic_install.html#container_cli_login" title="在安裝 CLI 之後，請登入以使用它。">登入 IBM Bluemix Container Service CLI 外掛程式 (bx ic)</a>。</dd>
<dt class="dlterm">如何使用可擴充容器群組與 Docker Compose 搭配？</dt>
<dd>Docker Compose 不支援 <span class="keyword">IBM
Bluemix Container Service</span> 群組概念，其中已包含多個容器實例之間的工作負載平衡。如果您要在容器實例之間平衡工作負載，則需要新增另一個執行負載平衡器的容器，並將它鏈結至容器實例。</dd>
<dt class="dlterm"><span class="keyword">IBM
Bluemix Container Service</span> 支援哪一個版本的 <span class="ph filepath">docker-compose.yml</span> 檔案格式？</dt>
<dd><span class="keyword">IBM
Bluemix Container Service</span> 只支援第 1 版的 <span class="ph filepath">docker-compose.yml</span> 檔案格式。目前不支援第 2 版。</dd>
<dt class="dlterm">如何在連接模式下執行 Docker Compose 指令？</dt>
<dd>在連接模式下執行 <samp class="ph codeph">docker-compose up</samp> 指令時，可能會發生錯誤。目前僅支援 Docker Compose 在分離模式下搭配 <span class="keyword">IBM
Bluemix Container Service</span> 執行。請使用 <samp class="ph codeph">-d</samp> 選項，以避免卡在容器的主控台輸出中，而無法分離。</dd>
<dt class="dlterm">如何存取在我的多容器部署中執行之每一個容器實例的日誌？</dt>
<dd><span class="keyword">IBM
Bluemix Container Service</span> 目前不支援 <samp class="ph codeph">docker-compose logs</samp> 指令。</dd>
<dt class="dlterm"><span class="ph filepath">docker-compose.yml</span> 檔案中支援的參數選項為何？</dt>
<dd>若要檢閱所支援參數選項的清單，請參閱<a href="container_single_ui.html#container_compose_yml">docker-compose.yml 檔案中支援的選項</a>。</dd>
</dl>
</div>
</div>
</article></article></article></div></main></body></html>